<apex:page standardStylesheets="false" lightningStylesheets="true" showHeader="false" sidebar="false" controller="PrePaymentSummaryController">

    <head>

        <!-- added by nishi: 27-aug-2020: for if center is Ossia then we show ossiaLogo otherwise Aureus logo-->
        <apex:outputPanel rendered="{!If(isOssia, true, false)}">
            <title> Ossia Academy – Prepayment Summary</title>
        </apex:outputPanel>
        <apex:outputPanel rendered="{!If(isOssia, FALSE, TRUE)}">
            <title> Aureus Academy – Prepayment Summary</title>
        </apex:outputPanel>

        <!-- added by nishi: 27-aug-2020: for if center is Ossia then we show ossiaLogo otherwise Aureus logo-->

        <!--<apex:slds /> -->
        <!-- IntlInputPhone CSS -->
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <apex:includeScript value="{!URLFOR($Resource.Jquery_plugin, '/Jquery_plugin/jquery/jquery.js')}" />
        <apex:includeScript value="{!URLFOR($Resource.Jquery_plugin, '/Jquery_plugin/jquery-ui.js')}" />

        <script src="https://js.stripe.com/v3/"></script>

        <link rel="stylesheet" href="{!URLFOR($Resource.Signature,'Signature/signature-pad.css')}" />
        <script src="{!URLFOR($Resource.Signature,'Signature/signature_pad.js')}"></script>

    </head>

    <apex:slds />
    <div class="content">
        <apex:form id="frm">
            <apex:actionFunction name="completePrepayment" action="{!completePrepayment}" oncomplete="checkError('{!isErrorOnSave}','{!errorMessage}');return false;"
                reRender="frm" status="spinner">
                <apex:param name="arg" value="" assignTo="{!base64SignImg}" />
            </apex:actionFunction>
            <!--checkError()-->
            <apex:actionFunction name="processAttach" action="{!newAttachInsert}" />

            <apex:actionStatus id="spinner">
                <apex:facet name="start">
                    <apex:outputPanel id="backdrop" styleClass="popupBackground">
                        <div role="status" class="slds-spinner slds-spinner_brand slds-spinner_large">
                            <div class="slds-spinner__dot-a"></div>
                            <div class="slds-spinner__dot-b"></div>
                        </div>
                    </apex:outputPanel>
                </apex:facet>
            </apex:actionStatus>



            <div class="slds-scope mainContainer">
                <div class="slds-panel slds-size_medium slds-panel_docked slds-panel_docked-left slds-is-open content-box" style="width:100%;border-radius:10px;box-shadow:1px 2px 10px #f79c1a"
                    aria-hidden="false">
                    <div class="slds-grid slds-wrap slds-grid--align-center">
                        <div class="slds-col">
                            <div class="header slds-col">
                                <div class="slds-col">
                                    <a href="#" class="logo">
                                        <!--<img src="https://aureusacademy.com/wp-content/uploads/2017/03/cropped-Aureus-Logo-Small.png"/>-->
                                        <!-- added by nishi: 27-aug-2020: for if center is Ossia then we show ossiaLogo otherwise Aureus logo-->
                                        <apex:outputPanel rendered="{!If(isOssia, true, false)}">
                                            <apex:image url="{!$Resource.Osia_Logo}" />
                                        </apex:outputPanel>
                                        <apex:outputPanel rendered="{!If(isOssia, FALSE, TRUE)}">
                                            <apex:image url="{!$Resource.Aureus_logo}" />
                                        </apex:outputPanel>
                                        <!-- added by nishi: 27-aug-2020: for if center is Ossia then we show ossiaLogo otherwise Aureus logo-->
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="slds-panel__header">
                        <div class="slds-col ">
                            <span class="main-title">Pre Payment Summary</span>
                        </div>
                    </div>
                    <apex:outputPanel rendered="{!NOT(isExpired)}">
                        <div class="content-body slds-col">
                            <div class="slds-form-element">
                                <div class="slds-form-element">
                                    <div class="slds-grid slds-wrap ">
                                        <label class="slds-form-element__label field-title slds-col slds-size_1-of-1 slds-p-horizontal_medium">
                                            <b>Enrolment Details</b>
                                        </label>
                                        <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-p-horizontal_medium">
                                            <div class="slds-form-element">
                                                <label class="slds-form-element__label f-title">Student Name
                                                    <abbr class="slds-required"></abbr>
                                                </label>
                                                <div class="slds-form-element__control">
                                                    <input type="text" class="slds-input inputtxt" value="{!enrolment.Student__r.Name}" disabled="true" />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-p-horizontal_medium">
                                            <div class="slds-form-element">
                                                <label class="slds-form-element__label f-title">Parent Name
                                                    <abbr class="slds-required"></abbr>
                                                </label>
                                                <div class="slds-form-element__control">
                                                    <input type="text" class="slds-input inputtxt" value="{!enrolment.Parent__r.Name}" disabled="true" />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-p-horizontal_medium">
                                            <div class="slds-form-element">
                                                <label class="slds-form-element__label f-title">Mobile
                                                    <abbr class="slds-required"></abbr>
                                                </label>
                                                <div class="slds-form-element__control">
                                                    <input type="text" class="slds-input inputtxt" value="{!enrolment.Parent__r.PersonMobilePhone}" disabled="true" />
                                                </div>
                                            </div>
                                        </div>

                                        <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-p-horizontal_medium">
                                            <div class="slds-form-element">
                                                <label class="slds-form-element__label f-title">Email
                                                    <abbr class="slds-required"></abbr>
                                                </label>
                                                <div class="slds-form-element__control">
                                                    <input type="text" class="slds-input inputtxt" value="{!enrolment.Parent__r.PersonEmail}" disabled="true" />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-p-horizontal_medium">
                                            <div class="slds-form-element">
                                                <label class="slds-form-element__label f-title">Centre
                                                    <abbr class="slds-required"></abbr>
                                                </label>
                                                <div class="slds-form-element__control">
                                                    <input type="text" class="slds-input inputtxt" value="{!enrolment.Center__r.Name}" disabled="true" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Section 2 Start -->
                                <div class="slds-form-element">
                                    <div class="slds-grid slds-wrap ">
                                        <label class="slds-form-element__label field-title slds-col slds-size_1-of-1 slds-p-horizontal_medium">
                                            <b>Prepayment Period</b>
                                        </label>
                                        <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-p-horizontal_medium">
                                            <div class="slds-form-element">
                                                <label class="slds-form-element__label f-title">Prepayment Start Date
                                                    <abbr class="slds-required"></abbr>
                                                </label>
                                                <div class="slds-form-element__control">
                                                    <apex:outputText value="{0, date, MMMM d','  yyyy}" styleclass="slds-input" html-disabled="true">
                                                        <apex:param value="{!firstDate}" />
                                                    </apex:outputText>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-p-horizontal_medium">
                                            <div class="slds-form-element">
                                                <label class="slds-form-element__label f-title">Prepayment End Date
                                                    <abbr class="slds-required"></abbr>
                                                </label>
                                                <div class="slds-form-element__control">
                                                    <apex:outputText value="{0, date, MMMM d','  yyyy}" styleclass="slds-input" html-disabled="true">
                                                        <apex:param value="{!lastDate}" />
                                                    </apex:outputText>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-p-horizontal_medium">
                                            <div class="slds-form-element">
                                                <label class="slds-form-element__label f-title">Next Bill Date
                                                    <abbr class="slds-required"></abbr>
                                                </label>
                                                <div class="slds-form-element__control">
                                                    <apex:outputText value="{0, date, MMMM d','  yyyy}" styleclass="slds-input" html-disabled="true">
                                                        <apex:param value="{!nextBillDate}" />
                                                    </apex:outputText>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-p-horizontal_medium">
                                            <div class="slds-form-element">
                                                <label class="slds-form-element__label f-title">Prepayment Duration(In Months)
                                                    <abbr class="slds-required"></abbr>
                                                </label>
                                                <div class="slds-form-element__control">
                                                    <input type="text" class="slds-input inputtxt" value="{!prepayPackage.Promotion_period_In_months__c}" disabled="true" />

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Section 2 End -->
                                <!-- Section 3 Start -->
                                <div class="slds-form-element" style="margin-top: 15px;">
                                    <label class="slds-form-element__label field-title slds-col slds-size_1-of-1 slds-p-horizontal_medium">
                                        <b>Charges Summary</b>
                                    </label>
                                    <div class="summaryContainer">
                                        <table id="chargeSummaryTbl" class="slds-table slds-table_cell-buffer slds-table_bordered">
                                            <thead>
                                                <tr class="slds-line-height_reset">
                                                    <th class="" scope="col">
                                                        <div class="slds-truncate" title="Invoice Date">Invoice Month</div>
                                                    </th>
                                                    <th class="" scope="col">
                                                        <div class="slds-truncate" title="Package Name">Package Name</div>
                                                    </th>
                                                    <th class="" scope="col">
                                                        <div class="slds-truncate" title="Amount">Amount</div>
                                                    </th>
                                                   <!--commented by nishi: 15-Sep-2020: for change Netsuite requirement we add new line items for discount amount
                                                        <th class="" scope="col">
                                                        <div class="slds-truncate" title="Discount">Discount</div>
                                                    </th>-->
                                                    <th class="" scope="col">
                                                        <div class="slds-truncate" title="Discount">Net Amount</div>
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody id="billSummaryTblBody">
                                                <apex:repeat value="{!listOfSummary}" var="value">
                                                    <tr class="slds-line-height_reset">
                                                        <td class="" scope="col">
                                                            <div class="slds-truncate" title="Invoice Date">
                                                                <apex:outputText value="{0, date, MMM','  yyyy}">
                                                                    <apex:param value="{!value.invoiceDate}" />
                                                                </apex:outputText>

                                                            </div>
                                                        </td>
                                                        <td class="" scope="col">
                                                            <div class="slds-truncate" title="Package Name">
                                                                <apex:outputText value="{!value.packageName}"></apex:outputText>
                                                            </div>
                                                        </td>
                                                        <td class="" scope="col">
                                                            <div class="slds-truncate" title="Amount">
                                                                <apex:outputText value="{0, number, $###,###,###.00}"><apex:param value="{!value.totalAmount}" /></apex:outputText>  
                                                                <!-- <apex:outputText value="${!ROUND(value.totalAmount,2)}"></apex:outputText> -->
                                                            </div>
                                                        </td>
                                                        <!--<td class="" scope="col">
                                                            <div class="slds-truncate" title="Discount">
                                                                <apex:outputText value="${!ROUND(value.discount,2)}"></apex:outputText>
                                                            </div>
                                                        </td>-->
                                                        <td class="" scope="col">
                                                            <div class="slds-truncate" title="Net Amount">
                                                                <apex:outputText value="{0, number, $###,###,###.00}"><apex:param value="{!value.netAmount}" /></apex:outputText>  
                                                                <!-- <apex:outputText value="${!ROUND(value.netAmount,2)}"></apex:outputText> -->
                                                            </div>
                                                        </td>
                                                    </tr>
                                                </apex:repeat>
                                                <!--added by nishi: 15-Sep-2020:start for change Netsuite requirement we add new line items for discount amount-->
                                                <tr>
                                                    <apex:outputPanel rendered="{!IF(totalPackageAmount != 0, TRUE, FALSE)}">
                                                        <td></td>
                                                        <td></td>
                                                        <!-- <td></td> -->
                                                        <td>
                                                            <b>Sub Total</b>
                                                        </td>
                                                        <td>
                                                            <b>
                                                                <apex:outputText value="{0, number, $###,###,###.00}"><apex:param value="{!totalPackageAmount}" /></apex:outputText>  
                                                            </b>
                                                        </td>
                                                    </apex:outputPanel>
                                                </tr>
                                                <tr>
                                                    <apex:outputPanel rendered="{!IF(discountAmount != 0, TRUE, FALSE)}">
                                                        <td></td>
                                                        <td></td>
                                                        <!-- <td></td> -->
                                                        <td>
                                                            <b>Discount</b>
                                                        </td>
                                                        <td>
                                                            <b>
                                                                <apex:outputText value="{0, number, $###,###,###.00}"><apex:param value="{!discountAmount}" /></apex:outputText>  
                                                            </b>
                                                        </td>
                                                    </apex:outputPanel>
                                                </tr>
                                                <!--added by nishi: 15-Sep-2020:start for change Netsuite requirement we add new line items for discount amount-->
                                                <tr>
                                                    <apex:outputPanel rendered="{!IF(amountAfterDiscount != 0, TRUE, FALSE)}">
                                                        <td></td>
                                                        <td></td>
                                                        <!-- <td></td> -->
                                                        <td>
                                                            <b>Total Amount</b>
                                                        </td>
                                                        <td>
                                                            <b>
                                                                <apex:outputText value="{0, number, $###,###,###.00}"><apex:param value="{!amountAfterDiscount}" /></apex:outputText>  
                                                            </b>
                                                        </td>
                                                    </apex:outputPanel>
                                                </tr>
                                                <!--Commented by nishi: 15-Sep-2020:start for change Netsuite requirement we add new line items for discount amount
                                                <tr>
                                                    <td colspan="2" style="text-align:right;">
                                                        <b>Total</b>
                                                    </td>
                                                    <td>
                                                        <b>
                                                            <apex:outputText value="${!ROUND(totalPackageAmount,2)}"></apex:outputText>
                                                        </b>
                                                    </td>
                                                   <td>
                                                        <b>
                                                            <apex:outputText value="${!ROUND(prepayPackage.Promotion_Discount__c,2)}"></apex:outputText>
                                                        </b>
                                                    </td>
                                                    <td>
                                                        <b>
                                                            <apex:outputText value="${!ROUND(amountAfterDiscount,2)}"></apex:outputText>
                                                        </b>
                                                    </td>
                                                </tr> -->
                                                <tr>
                                                    <apex:outputPanel rendered="{!IF(gstAmount > 0, TRUE, FALSE)}">
                                                        <td></td>
                                                        <td></td>
                                                        <!-- <td></td> -->
                                                        <td>
                                                            <b>GST</b>
                                                        </td>
                                                        <td>
                                                            <b>
                                                                <apex:outputText value="{0, number, $###,###,###.00}"><apex:param value="{!gstAmount}" /></apex:outputText>  
                                                            </b>
                                                        </td>
                                                    </apex:outputPanel>
                                                </tr>
                                                <tr>
                                                    <td></td>
                                                    <td></td>
                                                    <!-- <td></td> -->
                                                    <td>
                                                        <b>Final Amount</b>
                                                    </td>
                                                    <td>
                                                        <b>
                                                            <apex:outputText value="{0, number,$###,###,###.00}"><apex:param value="{!finalAmount}" /></apex:outputText>  
                                                            <!-- <apex:outputText value="${!ROUND(finalAmount,2)}"></apex:outputText> -->
                                                        </b>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <!-- Section 3 End -->
                                <!-- Student policy start-->
                                <div class="slds-col slds-size_1-of-1  slds-p-horizontal_medium">
                                    <div class="slds-form-element">
                                        <div class="slds-form-element__control">
                                            <label class="slds-form-element__label  field-title">Student Policies </label>
                                            <div class="slds-checkbox">
                                                <input type="checkbox" name="options" id="checkbox-3" value="checkbox-3" class="inputchk" />
                                                <label class="slds-checkbox__label" for="checkbox-3">
                                                    <span class="slds-checkbox_faux"></span>
                                                    <span class="slds-form-element__label">By checking this box and enrolling into {!IF(isOssia==true,'Ossia','Aureus')}
                                                        Academy you agree to all of our policies and accept that they may
                                                        be subject to change. To see our full student policies, please

                                                        <a href="{!IF(isOssia==true,'/apex/Ossiaprepayment_terms','/apex/prepayment_terms')}" target="_blank" style="text-decoration: underline !important;">click here</a>
                                                    </span>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="slds-form-element__help slds-hide errortxt">This field is required</div>
                                    </div>
                                </div>
                                <!-- Student policy end-->
                                <!-- terms and condition start-->
                                <apex:outputPanel rendered="{!If(isOssia, true, false)}">
                                    <div class="slds-col slds-size_1-of-1 slds-p-horizontal_medium">
                                        <div class="slds-form-element">
                                            <label class="slds-form-element__label  field-title">Terms and Conditions</label>
                                            <div class="slds-form-element__control">
                                                <div class="terms-info">
                                                    <h4 class="f-title">
                                                        <u>Promotion Validity</u>
                                                    </h4>
                                                    <p>The promotion is valid for customers at all of our facilities of Ossia
                                                        Music School.
                                                    </p>

                                                    <h4 class="f-title">
                                                        <u>No Refunds</u>
                                                    </h4>
                                                    <p>
                                                        <b>
                                                            <u>There will be strictly no refunds under any circumstances.</u>
                                                        </b>
                                                        The Pre-Payment is a special promotion and it is not compulsory, so customers can decide to participate in this promotion
                                                        or not.
                                                    </p>

                                                    <h4 class="f-title">
                                                        <u>Make Up Lessons</u>
                                                    </h4>
                                                    <p>Policy of makeup lesson will be same as stated in student policy. If
                                                        any termination of enrolment has been made, any make up lessons will
                                                        need to be completed before the end of your last lesson.
                                                    </p>

                                                    <h4 class="f-title">
                                                        <u>Packages Upgrade/ Downgrade</u>
                                                    </h4>
                                                    <p>As this is a promotional package, unfortunately we will not be allowing
                                                        any downgrading (i.e. from 45 to 30-min lesson packages) of classes.
                                                        However, for lesson advancements, customers will simply have to pay
                                                        the deposit top up + difference in lesson fees for the remaining
                                                        months. The formula will be 60 / 45 mins lesson fee - our standard
                                                        prices. We will not be calculating the top up from the discounted
                                                        fees that the customer has already paid (so they continue to enjoy
                                                        a discount).
                                                    </p>

                                                    <h4 class="f-title">
                                                        <u>Relocation</u>
                                                    </h4>
                                                    <p>We understand customers might not have control over this. We will do
                                                        our best to find a solution, but our pre-payment plan is a promotion
                                                        so we will be unable to refund any unused lessons under any circumstances.
                                                    </p>

                                                    <h4 class="f-title">Change of instructor</h4>
                                                    <p>Ossia does not change teachers very often as we have a minimal turnover
                                                        of our staff. If we change the teacher as a staff member leaves,
                                                        we will have a transition where the new teacher will sit in the lessons
                                                        with the existing teacher before taking over. <b>However, there will
                                                        be no refunds should you want to cease lessons due to change of instructor.</b>
                                                        
                                                    </p>


                                                    <h4 class="f-title">
                                                        <u>The prepayment promotion cannot be combined with other ongoing offers
                                                            or previous historical discounts.
                                                        </u>
                                                    </h4>

                                                    <p>Aureus Group Pte Ltd reserves the right to amend above terms and conditions
                                                        without prior notice.
                                                    </p>

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </apex:outputPanel>
                                <apex:outputPanel rendered="{!If(isOssia, false, true)}">
                                    <div class="slds-col slds-size_1-of-1 slds-p-horizontal_medium">
                                        <div class="slds-form-element">
                                            <label class="slds-form-element__label  field-title">Terms and Conditions</label>
                                            <div class="slds-form-element__control">
                                                <div class="terms-info">
                                                    <h4 class="f-title">
                                                        <u>Promotion Validity</u>
                                                    </h4>
                                                    <p>The promotion is valid for customers at all of our facilities as well
                                                        as Home Lessons, and not for Aureus Academy’s contract programmes/international
                                                        schools
                                                    </p>

                                                    <h4 class="f-title">
                                                        <u>No Refunds</u>
                                                    </h4>
                                                    <p>
                                                        <b>
                                                            <u>There will be strictly no refunds under any circumstances.</u>
                                                        </b>
                                                        The Pre-Payment is a special promotion in conjunction with GSS 2019 and it is not compulsory, so customers can decide to
                                                        participate in this promotion or not. </p>

                                                    <h4 class="f-title">
                                                        <u>Make Up Lessons</u>
                                                    </h4>
                                                    <p>Similar to regular lessons, as long as you continue after the pre-payment
                                                        period is complete, any pending make up lessons will still be valid
                                                        for 4 months, as per student policy. If any termination of enrolment
                                                        has been made, any make up lessons will need to be completed before
                                                        the end of your last lesson.</p>

                                                    <h4 class="f-title">
                                                        <u>Packages Upgrade/ Downgrade</u>
                                                    </h4>
                                                    <p>As this is a promotional package, unfortunately we will not be allowing
                                                        any downgrading (i.e. from 45 to 30-min lesson packages) of classes.
                                                        However, for lesson advancements, customers will simply have to pay
                                                        the deposit top up + difference in lesson fees for the remaining
                                                        months. The formula will be 60 / 45 mins lesson fee - our fixed prices
                                                        corresponding with the previous package (i.e. 45 mins is either $349
                                                        or $320, 30 mins is either $235 or $213). We will not be calculating
                                                        the top up from the discounted fees that the customer has already
                                                        paid (so they continue to enjoy a discount).</p>

                                                    <h4 class="f-title">
                                                        <u>Relocation</u>
                                                    </h4>
                                                    <p>We understand customers might not have control over this. We will do
                                                        our best to find a solution, but our pre-payment plan is a promotion
                                                        so we will be unable to refund any unused lessons under any circumstances.</p>

                                                    <h4 class="f-title">Change of instructor</h4>
                                                    <p>Aureus does not change teachers very often as we have a minimal turnover
                                                        of our staff. If we change the teacher as a staff member leaves,
                                                        we will have a transition where the new teacher will sit in the lessons
                                                        with the existing teacher before taking over.
                                                        <b>However, there will be no refunds should you want to cease lessons
                                                            due to change of instructor. </b>
                                                    </p>

                                                    <h4 class="f-title">
                                                        <u>Location Change</u>
                                                    </h4>
                                                    <p>Customers from centres with a lower fee structure who wish to switch
                                                        to a centre with higher fee structure will have to top up the difference
                                                        in fees. We will be calculating the top up fees from the fixed Aureus
                                                        price corresponding with their package and not from the discounted
                                                        fees that they had prepaid. We will not be able to refund the difference
                                                        for customers moving from a higher fee centre to a lower fee centre.</p>

                                                    <h4 class="f-title">
                                                        <u>The prepayment promotion cannot be combined with other ongoing offers
                                                            or previous historical discounts.</u>
                                                    </h4>

                                                    <p>Aureus Group Pte Ltd reserves the right to amend above terms and conditions
                                                        without prior notice.</p>

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </apex:outputPanel>
                                <!-- terms and condition end-->
                                <!-- signature start-->
                                <div class="slds-col slds-size_1-of-1 slds-p-horizontal_medium">
                                    <div class="slds-form-element">
                                        <label class="slds-form-element__label  field-title">Signature</label>
                                        <div class="slds-form-element__control">
                                            <div id="signature-pad" class="m-signature-pad">
                                                <div class="m-signature-pad--body">
                                                    <canvas></canvas>
                                                </div>
                                                <div class="m-signature-pad--footer">
                                                    <div class="description">Sign above</div>
                                                    <button type="button" class="button clear {!IF(isOssia==true,'backgroundcolor_ossia','')}" data-action="clear">Clear</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- signature end-->
                                <!-- stripe section start-->
                                <!--<apex:outputPanel rendered="{!isAlreadyStripCstmr}">-->
                                <div class="slds-form-element">
                                    <label class="slds-form-element__label field-title slds-size_1-of-1 slds-p-horizontal_medium" for="form-element-help-01">Card Details</label>
                                    <div class="slds-grid slds-wrap slds-p-horizontal_medium" style="margin-top: 5px;">
                                        <div class="slds-col dark-bg billig-info slds-grid">
                                            <ul class="slds-grid slds-wrap slds-size_1-of-1">
                                                <li class="slds-size_1-of-1 slds-medium-size_6-of-12 slds-p-horizontal_medium">
                                                    <strong>Card Info</strong>&nbsp;
                                                    <apex:outputText value="{!cardImage}" escape="false" /> x{!cardNumber}&nbsp;
                                                    <a href="/apex/UpdateCustomerCard?id={!enrolment.Parent__c}" target="_blank">Add New Card</a>
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="slds-notify_container slds-is-relative slds-hide paymentCmpErrDiv">
                                            <div class="slds-notify slds-notify_toast slds-theme_error slds-m-left_none slds-m-right_medium" role="status">
                                                <div class="slds-notify__content">
                                                    <h2 class="slds-text-heading_small contentPaymentCmpErrDiv"></h2>
                                                </div>

                                                <div class="slds-notify__close">
                                                    <button class="slds-button slds-button_icon slds-button_icon-inverse" onclick=" $('.paymentCmpErrDiv').addClass('slds-hide');return false;"
                                                        title="Close">
                                                        X
                                                        <span class="slds-assistive-text">Close</span>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="slds-grid slds-wrap slds-grid--align-spread slds-size_1-of-1">
                                            <div class="slds-col slds-size_1-of-1  slds-p-horizontal_medium">
                                                <a class="slds-button {!IF(isOssia==true,'backgroundcolor_ossia','custom-btn')}" id="payBtn" onclick="paymentNow();return false;">Pay Now
                                                    <span class="slds-icon_container slds-icon-utility-announcement" title="Description of icon when needed">
                                                        <svg class="slds-icon slds-icon_xx-small" aria-hidden="true">
                                                            <use fill="White" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS, 'assets/icons/utility-sprite/svg/symbols.svg#chevronright')}"
                                                            />
                                                        </svg>
                                                    </span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!--</apex:outputPanel>-->
                                <!-- stripe section end-->
                            </div>
                        </div>
                    </apex:outputPanel>
                    <apex:outputPanel rendered="{!isExpired}">


                        <div class="slds-align_absolute-center slds-p-around_x-small">
                            <strong>We cannot process your request at the moment as you are already on a pre-payment package. Please
                                contact centre admin for further assistance.
                            </strong>
                        </div>
                    </apex:outputPanel>
                </div>
            </div>
        </apex:form>
    </div>

    <style>
        .color_ossia {
            color: #ed1c24;
        }

        .backgroundcolor_ossia {
            background: #ed1c24 !important;
            padding: 5px 10px 3px !important;
            color: #fff !important;
            font-size: 16px !important;
            text-transform: uppercase;
            line-height: 20px !important;
            margin: 15px 0 20px;
            float: right;
            height: 40px;
        }

        .backgroundcolor {
            background-color: #f6901e;
        }

        body {
            background-image: url("{!$Resource.music}") !important;
            background-size: 100% 100% !important;
            background-repeat: no-repeat !important;
            background-position: left !important;
        }

        span.main-title {
            color: #200a28;
            font-size: 24px;
            border-radius: 0;
            font-weight: bold;
            margin-bottom: 10px;
            display: block;
            line-height: 30px;
            padding-bottom: 10px;
            text-align: center;
        }

        .content-box {
            margin: 50px 0;
            width: 90%;
            background: rgba(255, 255, 255, 1);
            border-radius: 10px;
        }

        .outstanding {
            padding: 20px;
        }

        .custom-btn {
            padding: 5px 10px 3px !important;
            color: #fff !important;
            background: #f79c1a !important;
            font-size: 16px !important;
            text-transform: uppercase;
            line-height: 20px !important;
            margin: 15px 0 20px;
            float: right;
            height: 40px;
        }

        .terms-info p {
            margin-bottom: 10px;
        }

        .terms-info h4.f-title {
            font-weight: bold;
            font-size: 14px !important;
        }

        .terms-info {
            border: 15px solid #f2f2f2;
            background: #f2f2f2;
            height: 145px;
            overflow-y: scroll;
            outline: 1px solid #eee;
        }

        div#signature-pad {
            position: relative;
            top: 0;
            margin: auto;
            left: 0;
            width: 100%;
            margin-top: 10px;
            box-shadow: none;
            background: #f2f2f2;
            border-radius: 0;
        }

        .m-signature-pad--body canvas {
            border: 1px solid #ccc;
            background: #fff;
        }

        .dark-bg {
            background: #f2f2f2;
            width: 100%;
        }

        .m-signature-pad--footer .button.clear {
            background: #f79c1a;
            border: 0 !important;
            padding: 5px 15px;
            color: #fff;
            text-transform: uppercase;
            left: auto;
            right: 0;
        }

        .popupBackground {
            background-color: lightgrey;
            opacity: 0.80;

            position: fixed;
            padding: 0;
            margin: 0;

            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 9998;
            border-radius: 5px;
        }

        .mainContainer {
            width: 50%;
            margin: auto;
            margin-top: 50px;
        }

        @media (min-width: 320px) and (max-width: 580px) {
            .mainContainer {
                width: 100%;
                margin: auto;
                margin-top: 0px;
            }
            .summaryContainer {
                width: 90%;
                overflow-x: scroll;
                background: #000;
            }
            .content-box {
                margin: 0px 0;
            }
            .m-signature-pad--body canvas {
                height: 80%;
            }

            ::-webkit-scrollbar-thumb:horizontal {
                border-radius: 5px;
                background-color: red;
                background-image: -webkit-gradient(linear, 40% 0%, 75% 84%, from(#ff6da2), to(#7983f8), color-stop(.6, #7983f8));
                height: 10px;
            }
            ::-webkit-scrollbar {
                width: 18px;
                background-color: #d1d1d1;

            }



        }
    </style>
    <script>
        //----------------------Signature script
        var wrapper = document.getElementById("signature-pad"),
            clearButton = wrapper.querySelector("[data-action=clear]"),
            saveButton = wrapper.querySelector("[data-action=completeEnrl]"),
            canvas = wrapper.querySelector("canvas"),
            signaturePad;

        function resizeCanvas() {
            // When zoomed out to less than 100%, for some very strange reason,
            // some browsers report devicePixelRatio as less than 1
            // and only part of the canvas is cleared then.
            var ratio = Math.max(window.devicePixelRatio || 1, 1);
            canvas.width = canvas.offsetWidth * ratio;
            canvas.height = canvas.offsetHeight * ratio;
            //canvas.width = 615;
            //canvas.height = 300;
            canvas.getContext("2d").scale(ratio, ratio);
        }

        window.onresize = resizeCanvas;
        resizeCanvas();

        signaturePad = new SignaturePad(canvas);

        clearButton.addEventListener("click", function (event) {
            signaturePad.clear();
        });

        function paymentNow() {
            $("#payBtn").css('pointer-events', 'none');
            var checkErr = checkErrorOnSummaryPage();

            if (!checkErr) {
                //completeEnrolment(signaturePad.toDataURL(), '',concatePhoneNo);
                completePrepayment(signaturePad.toDataURL());
            } else {
                $("#payBtn").css('pointer-events', '');
            }
        }

        function checkErrorOnSummaryPage() {
            var isErr = false;

            if (signaturePad.isEmpty()) {
                alert("Please provide signature first.");
                isErr = true;
            } else {
                $('.inputchk').each(function () {

                    if (!$(this).prop('checked')) {
                        $(this).parent().parent().parent().addClass('slds-has-error');
                        $(this).parent().parent().next().removeClass('slds-hide');
                        isErr = true;
                    } else {
                        $(this).parent().parent().parent().removeClass('slds-has-error');
                        $(this).parent().parent().next().addClass('slds-hide');
                    }
                });
            }
            return isErr;
        }

        function checkError(isErrOnSave, errorMessage) {
            var isOssia = '{!isOssia}';
            //var isErrOnSave = '{!isErrorOnSave}';
            console.log('isErrOnSave', isErrOnSave);
            console.log('errorMessage', errorMessage);
            if (isErrOnSave == 'true') {
                $("#payBtn").css('pointer-events', '');
                $('.paymentCmpErrDiv').removeClass('slds-hide');
                $('.contentPaymentCmpErrDiv').html(errorMessage);
            } else {
                $('.paymentCmpErrDiv').addClass('slds-hide');
                window.location.href = "/apex/thankyoupage?isOssia=" + isOssia;
                //processAttach();
            }
        }
    </script>
</apex:page>