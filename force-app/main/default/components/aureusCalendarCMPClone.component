<apex:component controller="AureusCalendarClone" allowDML="true">
    <html xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
        <style>
            a[name="skiplink"] { 
            display:none;
            }
            .dv_load{
            top: 45%;
            margin-left: 40%;
            padding: 15px;
            z-index: 20000;
            position: fixed;
            width: 250px;
            background-color: #ccd8e7;
            border: 5px solid #afc3e0;
            color: #394057;
            }
            .selectBox{
            width: 100%;
            }
            .pointerForClick{
            cursor:pointer;
            }
            
            .button-shadow{
                box-shadow: 2px 2px 5px #888888;
            }
            .fc-state-default, .fc-state-hover{
            padding-left: 1rem !important;
            padding-right: 1rem !important;
            text-align: center !important;
            vertical-align: middle !important;
            border: 1px solid rgb(221, 219, 218) !important;
            transition: border .15s linear !important;
            background-color: rgba(255, 255, 255, 1.0) !important;
            border-color: rgb(177, 166, 166) !important;
            color: rgb(0, 0, 0) !important;
            background-image: none !important;
            text-transform: uppercase !important;
            }
            .fc-widget-header table thead tr{
            background: #F7F7F7;
            font-weight:800;
            }
            .fc-time, .fc-axis {
            text-transform: uppercase !important;
            font-size: 12px;
            font-weight: 800;
            background: whitesmoke;
            }
            .fc-event-container .fc-time , .fc-event-container .fc-title{
            font-size: 12px;
            font-weight: 600;
            background: transparent;
            }
            .fc-title{
            font-size: 12px !important;
            }
            
            .fc-toolbar{
            padding: 5px 1rem !important;
            margin: 0 !important;
            display: flex;      
            flex-wrap: wrap;        
            width: 100%;        
            justify-content: space-between;     
            align-items: center;        
            background:#e9e9e9;     
            }       
            div#statusOnPage {      
            left: 0;        
            top: 0;     
            }  
            .fc-scroller {
            height: auto !important;
            overflow: hidden !important;
            }     
            .fc-toolbar .fc-right {     
            order: 1;       
            }       
            .fc-toolbar .fc-clear {     
            display: none;      
            }       
            th.fc-resource-cell {       
            padding: 1px;      
            }       
            
            .fc-resource-cell:hover, .fc-day-header:hover { 
                color: #0000FF;
                cursor: pointer;
            }
            
            th.fc-day-header {      
            padding: 1px;  /*10px */    
            }       
             .fc-time-grid .fc-slats td {        
                height: 0.9rem;                   
            }
           
            .fc-widget-content{
             height: 1.3rem !important;
            }
            .fc-slats td.fc-widget-content:nth-child(2){
            border: 1px solid #2123261a;
            border-radius: 3px;
            opacity: 0.5;
            }
            /*.fc-time-grid .fc-slats, .fc-time-grid>hr {
            position: relative;
            z-index: 2;
            top: 43px;
            }*/
            .fc-scroller>.fc-day-grid, .fc-scroller>.fc-time-grid{
            top:42px;
            }
            
            .teacherWorkingHours{
            background: #fff;
            border: 1px solid #fff;
            opacity: 1;
            }
            
            .bookingNotAvailable{               
            background: rgb(215, 162, 162)  !important;
            opacity: 1 !important;
            pointer-events: none;
            bottom: auto !important;
            color: #b95f5f !important;
            border: 1px solid #b95f5f !important;
            left: -2px !important;
            width: 100%;
            }
            .fc-event {
            
            display: block;
            align-items: center;
            justify-content: center;
            padding: 10px;
            /*left: -2px !important;
            width: 100%;*/
            }
            .slds-scope .slds-page-header{
            padding: 5px;
            }
            .slds-page-header {
            border-radius: 0 !important;
            }
            .fc-event-container{
            width: 100%;
            }
            .fc-state-active{
            background: rgb(221, 219, 218) !important;
            }
            .fc-button-group, .fc-toolbar button{
            font-size: 14px !important;
            text-transform: capitalize !important;
            height: 2.4em !important;
            }
            .fc-resource-cell{
            word-wrap: break-word;
            padding: 3px;
            }
            .fc-widget-header thead .fc-resource-cell, .fc-widget-header thead .fc-day-header{
            text-align: center !important;
            }
            .eventHistory{
            border-top: 1px solid #ddd;
            border-bottom: 1px solid #ddd;
            padding: 15px 5px;
            }
            #eventIcons{
            position: absolute;
            top: 3px;
            right: 0px;
            }
            .closeon a{
            color: #5a5959;
            }
            #retweet svg{
            transform: rotate(90deg);
            }
            .historyBy{
            color: #afa5a5;
            font-size: 16px;
            vertical-align: text-top;
            }
            #calendar{
            background: #fff;
            }
            .slds-scope a.slds-tabs--default__link {
            color: rgb(0, 109, 204) !important;
            text-decoration: none !important;
            transition: color .1s linear;
            }
            .slds-tabs--default__item.slds-is-active{
            font-weight: unset !important;
            }
            .headerTitle{
            font-size: .8125rem !important;
            font-weight: unset !important;
            }
            #ToastMessage{
            position: absolute !important;
            }
            .slds-scope .slds-is-relative{
            position: fixed !important;
            }
            .slds-button-group{
            width: 100%;
            }
            .slds-button-group .slds-button{
            width: 40%;
            }
            .btnWidth{
            width: 54% !important;
            }
            .btnBlue{
            background: #00b3f0 !important;
            border-color: #0fa6da !important;
            }
            .customTable th{
            text-align: right;
            font-weight: bold !important;
            }
            .editCustomer{
            position: absolute;
            top: 0px;
            right: 0;
            }
            .recurrence .slds-select, .recurrence .slds-input{
            width: unset !important;
            }
            .editCustomerDetails{
            z-index: 9999;
            position: absolute;
            top: 9%;
            right: 0px;
            }
            .editCustomerDetails section{
            padding: 15px;
            }
            #popoverTitle{
            font-size: 15px;
            font-weight: 600;
            }
            .customInput{
            width: 97% !important;
            margin-left: 4px !important;
            }
            .customPadding{
            padding-left: 0px !important; 
            padding-right: 0px !important;
            }
            .customHeader{
            background: #F8B52F;
            color: white;
            height: 50px;
            padding: 15px;
            }
            .slds-scope .slds-radio_button [type=radio]:checked+.slds-radio_faux, .slds-scope .slds-radio_button [type=radio]:checked+.slds-radio--faux, .slds-scope .slds-radio_button [type=radio]:checked~.slds-radio_faux, .slds-scope .slds-radio_button [type=radio]:checked~.slds-radio--faux, .slds-scope .slds-radio_button [type=radio]:checked+.slds-radio_button__label, .slds-scope .slds-radio_button [type=radio]:checked+.slds-radio--button__label, .slds-scope .slds-radio--button [type=radio]:checked+.slds-radio_faux, .slds-scope .slds-radio--button [type=radio]:checked+.slds-radio--faux, .slds-scope .slds-radio--button [type=radio]:checked~.slds-radio_faux, .slds-scope .slds-radio--button [type=radio]:checked~.slds-radio--faux, .slds-scope .slds-radio--button [type=radio]:checked+.slds-radio_button__label, .slds-scope .slds-radio--button [type=radio]:checked+.slds-radio--button__label{
            background-color: #e6e6e6 !important;
            color: #000 !important;
            }
            #services{
            width: 100px;
            }
            .bookingStatus{
            width: 30% !important;
            }
            .slds-template__container {
            background: #f9b758 !important;
            }
            body{
            background: #f9b758 !important;
            }
            .close-btn {
            position: absolute !important;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            }
            .pop-header {
            position: relative;
            }
            a.editCustomer {
            background: #333;
            color: #fff !important;
            display: inline-block;
            padding: 10px 10px;
            top: 4px;
            text-decoration:none; 
            }
            .popupDetails .pop-header span,.popupDetails .pop-header a,.popupDetails .pop-header svg {
            color: #fff !important;
            }  
            td.fc-widget-content:not(:nth-child(1)) {
            background: #858585;
            opacity: 0.5;
            }
            .custBtn{
            width: 130px;
            background: #f9f3f3 !important;
            color: #000 !important;
            font-weight: bold !important;
            }
            .custmBTN{
            width: 200px;
            background: #f9f3f3 !important;
            color: #000 !important;
            }
            .studentImg{
            width: 200px !important;
            height: 200px !important;
            }
            .fc-ltr .fc-axis{
            font-weight: 500;
            }
            .black{
            border-top: 2px solid #21232645 !important;
            }
            .slds-scope{
            overflow: hidden;
            }
            .fc-header-toolbar{
                position: fixed;
                z-index: 100;
                top: 68px;
            }
            @media only screen and (min-device-width: 720px) and (max-device-width: 1300px) {
                .fc-header-toolbar{
                    position: fixed;
                    z-index: 100;
                    top: 56px;
                }
            }
            .fc-head-container{
            position: -webkit-sticky;
            position: sticky;
            z-index: 999;
            top: 43px;
            }
            #calendar{
            height: calc(100vh - 13vh);
            overflow-y:auto;
            }
            
            td.fc-widget-content:not(:nth-child(1)) {
                background: #fff;
                //opacity: 0.5;
            }
            .fc-nonbusiness {
                    background: #858585 !important;
                    opacity: 0.5;
            }
            .fc-center{
                margin-left: -204px;
                font-size: large;
                font-weight: 600;
            }
            .editBookingDetailBody{
                height: 140px;
                overflow-y: auto;
                overflow-x: hidden;
            }
           .hyphens-none-fix{
                    hyphens:none !important;
           }
                
            .another-box {      
                background: rgba(255, 255, 255, 0.5);       
                width: calc(100% - 30px);       
                margin: 0 15px 15px;        
                padding: 10px 0 20px;       
            }       
            .custom-calendar .calc {        
                border: 1px solid rgb(221, 219, 218);       
                border-radius: .25rem;      
                padding: .25rem 0;      
                background: rgb(255, 255, 255);     
                box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.16);        
                width: 100%;        
            }       
            .date-list {        
                padding: 0 10px !important;     
            }       
                                
            .date-list label {      
                padding: 0 5px;     
            }       
                    
                    
             /*  Date picker css   */       
            #datepicker > .ui-datepicker {      
            width: 17em;        
            padding: 0;     
            display: none;      
            background:#846733;         
            }       
            #datepicker > .ui-datepicker .ui-datepicker-title {     
            margin: 0;      
            line-height: 36px;      
            text-align: center;     
            }       
            #datepicker > .ui-datepicker table {        
            background:#fff;            
            }       
            #datepicker > .ui-datepicker td {       
            padding: 0px;       
            border: 1px solid #eee;     
            font-size: .75rem;      
            position: relative;     
            width: 2rem;        
            min-height: 2rem;       
            line-height: 2.5rem;        
                    
            }       
            #datepicker > .ui-datepicker td span,       
            #datepicker > .ui-datepicker td a {     
            display: block;     
            padding: 0em;       
            text-align: center;     
            text-decoration: none;      
            }       
            #datepicker,        
            #datepicker > .ui-datepicker,       
            #datepicker > .ui-datepicker-header,        
            #datepicker > .ui-datepicker-calendar {     
            width: 100%;        
            }       
            #datepicker > .loc-maps span {      
            width: 100%;        
            }       
            #datepicker > .ui-datepicker td span, #datepicker > .ui-datepicker td a {       
                    
            background: #fff !important;        
            border:2px solid #fff !important;       
            }       
            #datepicker > .ui-state-highlight, #datepicker > .ui-widget-content .ui-state-highlight,#datepicker > .ui-widget-header .ui-state-highlight {       
            background: rgb(236, 235, 234) !important;      
            border-color: rgb(236, 235, 234) !important;        
            border-width: 2px !important;       
            border-style: solid !important      
            }       
            #datepicker > .ui-datepicker table{     
            margin:0 !important;        
            }       
            #datepicker > .ui-widget.ui-widget-content {        
            border: none;       
            }       
                    
            #datepicker > table.ui-datepicker-calendar thead {      
            border: 1px solid #eee;     
            }       
            #datepicker > .ui-datepicker .ui-datepicker-header{     
            border-radius:0;        
            }       
            #datepicker > .ui-datepicker td a.ui-state-active {     
            background: #fff!important;     
            border: 2px solid #f6911d !important;       
            color: #f6911d !important;      
            }       
            #datepicker > .ui-datepicker td a:before, #datepicker > .ui-datepicker td span:before {     
            content: "";        
            position: absolute;     
            max-width: 12px;        
            height: 5px;        
            background: #eee;       
            bottom: 5px;        
            left: 4px;      
            width: 100%;        
            }       
            #datepicker > .ui-datepicker td a:after, #datepicker > .ui-datepicker td span:after {       
            content: "";        
            position: absolute;     
            max-width: 12px;        
            height: 5px;        
            background: #eee;       
            bottom: 5px;        
            right: 4px;     
            width: 100%;        
            }       
            #datepicker > .ui-datepicker .ui-datepicker-prev span, #datepicker > .ui-datepicker .ui-datepicker-next span {      
            display: block;     
            position: absolute;     
            left: 50%;      
            margin-left: -8px;      
            top: 15%;       
            margin-top: 0;      
            transform: translateY(50%);     
            }       
                    
            #datepicker > .day-availability--morning .ui-state-default:before, #datepicker > .ui-widget-content .day-availability--morning .ui-state-default:before, #datepicker > .ui-widget-header .day-availability--morning .ui-state-default:before {      
                background: #61c461;        
            }       
            #datepicker > .day-availability--afternoon .ui-state-default:after, #datepicker > .ui-widget-content .day-availability--afternoon .ui-state-default:after, #datepicker > .ui-widget-header .day-availability--afternoon .ui-state-default:after {       
                background: #61c461;        
            }       
            #datepicker > .ui-datepicker .ui-datepicker-next, #datepicker > .ui-datepicker .ui-datepicker-prev{     
            height: 100%;       
            }           
                    
            .time-list span.slds-button.slds-radio_button {     
            width: 100%;        
            margin-bottom: 5px;     
            border: 1px solid #eee;     
            }       
                    
            .time-list label.slds-radio_button__label {     
            width: 100%;        
            text-align: center;     
            }       
                    
            .time-list {        
            background: #f7f7f7;        
            padding: 15px 15px 5px;     
            border: 1px solid #eee;     
            width: calc(100% - 15px);       
            margin: 0 auto 10px;        
            }       
                    
            .afternoon .time-list {     
            float: right;       
            }       
            .calc > div fieldset {      
            overflow: hidden;       
            }       
                    
            .errortxt{      
                color: red;     
            }
            .margin-top5px{
                margin-top:5px;
            }; 
        </style>
        <apex:form >
            <div class="demo-only demo--inverse slds-hide" id="enrolProcessLoader" style="height:100%;width:100%;z-index:200;position:fixed">
                <div class="slds-spinner_container" style="height:100%;width:100%;">        
                    <div role="status" style="position: absolute;top:45%;left:45%">     
                        <img src="{!$Resource.animatedmusic}"/>         
                    </div>      
                </div>      
            </div>
            <apex:actionStatus id="status" styleClass="status">
                <apex:facet name="start">
                    <div class="demo-only demo--inverse " style="height:100%;width:100%;z-index:200;position:fixed">
                        <div class="slds-spinner_container" style="height:100%;width:100%;">
                            <div role="status" class="slds-spinner slds-spinner_large slds-spinner_brand">
                                <span class="slds-assistive-text">Loading</span>
                                <div class="slds-spinner__dot-a"></div>
                                <div class="slds-spinner__dot-b"></div>
                            </div>
                        </div>
                    </div>
                </apex:facet>
            </apex:actionStatus>
            <apex:actionFunction name="centerName" reRender="teachersName,resourceName" action="{!getTeacherByCenter}" status="status" oncomplete="initChange();teacherChange();"/>
                
            <div class="slds-scope slds-calender-page">
                <!-- Toast -->
                <div class="demo-only slds-hide" style="height: 4rem;" id='ToastMessage'>
                    <div class="slds-notify_container slds-is-relative">
                        <div class="slds-notify slds-notify_toast slds-theme_success toastclass" role="alert">
                            <span class="slds-assistive-text">success</span>
                            <span class="slds-icon_container slds-icon-utility-success slds-m-right_small slds-no-flex slds-align-top" title="Description of icon when needed">
                                <svg class="slds-icon slds-icon_small" aria-hidden="true">
                                    <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS, 'assets/icons/utility-sprite/svg/symbols.svg#success')}" />
                                </svg>
                            </span>
                            <div class="slds-notify__content">
                                <h2 class="slds-text-heading_small" id="toastMsg"></h2>
                            </div>
                            <button class="slds-button slds-button_icon slds-notify__close slds-button_icon-inverse" title="Close" onclick='toastLaunch()'>
                                <svg class="slds-button__icon slds-button__icon_large" aria-hidden="true">
                                    <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS, 'assets/icons/utility-sprite/svg/symbols.svg#close')}" />
                                </svg>
                                <span class="slds-assistive-text">Close</span>
                            </button>
                        </div>
                    </div>
                </div>
                <!-- Toast -->
                
                <!-- loader start -->
                <div id="statusOnPage" class="demo-only demo--inverse" style="display:none;height:100%;width:100%;z-index:200;position:fixed">
                    <div class="slds-spinner_container" style="height:100%;width:100%;">
                        <div role="status" class="slds-spinner slds-spinner_large slds-spinner_brand">
                            <span class="slds-assistive-text">Loading</span>
                            <div class="slds-spinner__dot-a"></div>
                            <div class="slds-spinner__dot-b"></div>
                        </div>
                    </div>
                </div>
                <!-- loader end -->
                <apex:outputPanel id="op"></apex:outputPanel>
                <div class="slds-page-header">
                    <div class="slds-page-header__row">
                        <div class="slds-page-header__col-title">
                            <div class="slds-media">
                                <div class="slds-media__body">
                                    <div class="slds-grid slds-gutters">
                                        <div class="slds-col slds-size_2-of-12">
                                            <div class="slds-form-element">
                                                <label class="slds-form-element__label">Centre</label>
                                                <div class="slds-form-element__control">
                                                    <apex:selectList value="{!centerName}" id="centers"  size="1" onchange="centerName();getCenter($(this).val());return false;" styleClass="slds-select selectBox centerList">
                                                        <apex:selectOptions value="{!Centers}"/>
                                                    </apex:selectList>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="slds-col slds-size_2-of-12">
                                            <div class="slds-form-element">
                                                <apex:outputPanel id="teachersName">
                                                <apex:pageMessages ></apex:pageMessages>
                                                    <label class="slds-form-element__label">Teacher</label>
                                                    <div class="slds-form-element__control">
                                                        <apex:selectList value="{!teacherName}" size="1" id="teachers" styleClass="slds-select selectBox teachers">
                                                            <apex:selectOptions value="{!Teachers}"/>
                                                        </apex:selectList>
                                                    </div>
                                                </apex:outputPanel>
                                            </div>
                                        </div>
                                        <div class="slds-col slds-size_2-of-12">
                                            <div class="slds-form-element">
                                                <label class="slds-form-element__label">Instrument</label>
                                                <div class="slds-form-element__control">
                                                    <select id="instruments" size="1" class="slds-select selectBox instrument" onchange="getInstrument($(this).val());return false;">
                                                    </select>                              
                                                </div>
                                            </div>
                                        </div>
                                        <div class="slds-col slds-size_2-of-12">
                                            <div class="slds-form-element">
                                                <apex:outputPanel id="resourceName">
                                                    <label class="slds-form-element__label">Resources</label>
                                                    <div class="slds-form-element__control">
                                                        <apex:selectList value="{!resourceId}" id="resources" size="1" styleClass="slds-select selectBox" onchange="getResource($(this).val());return false;">
                                                            <apex:selectOptions value="{!Resources}"/>
                                                        </apex:selectList>
                                                    </div>
                                                </apex:outputPanel>    
                                                
                                            </div> 
                                        </div>
                                        <div class="slds-col slds-size_4-of-12" style="padding-top: 24px;">
                                            <div class="slds-grid slds-gutters">
                                              <div class="slds-col slds-size_1-of-2">
                                                <button class="slds-button slds-button_neutral"  title="Refresh" onclick="refreshCalendar();return false;">
                                                  <svg class="slds-button__icon slds-icon_x-small" aria-hidden="true">
                                                    <use xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/action-sprite/svg/symbols.svg#refresh')}"></use>
                                                  </svg>
                                                </button> 
                                            </div>
                                              <div class="slds-col slds-size_1-of-2">
                                                <!--<button class="slds-button slds-button_neutral"  title="Show/Hide Menu" onclick="showHideMenu();return false;">
                                                  <svg class="slds-button__icon slds-icon_x-small" aria-hidden="true">
                                                    <use xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/action-sprite/svg/symbols.svg#refresh')}"></use>
                                                  </svg>
                                                  Show/Hide Menu
                                                </button>-->
                                              </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="calendar"></div>
                
                <!-- booking detail popup end--> 
                <div class="editDetails slds-hide">
                    <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
                        <div class="slds-modal__container" style="width: 65%;">
                            <div class="slds-modal__content" id="modal-content-id-1" style="min-height: 385px; max-height: 440px;overflow-y: hidden; ">
                                <div class="slds-grid slds-wrap customHeader" style="background: #303a42;">
                                    <div class="slds-col slds-size_10-of-12">
                                        <h1>
                                            <span class="slds-page-header__title slds-truncate" id="detailPopupTitle">
                                                Appointment Details
                                            </span>
                                        </h1>
                                    </div>
                                    <div class="slds-col slds-size_2-of-12 slds-text-align_right">
                                        <a  class="slds-button slds-button_icon" id="closeRescheduleIconButton" title="Close" style="color: white;" href="javascript:void(0);" onclick="cancelRescheduling();return false;">
                                            <svg class="slds-button__icon slds-icon_x-small" aria-hidden="true">
                                                <use xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/action-sprite/svg/symbols.svg#close')}"></use>
                                            </svg>
                                            <span class="slds-assistive-text">Close</span>
                                        </a>
                                    </div>
                                    
                                </div>
                                <div class="slds-m-around--large" style="margin-bottom: 0px" role="group">
                                    <div class="slds-tabs--default">
                                        <div style="float:right;">
                                            <label><b>Status: </b></label>
                                            <label id="statusLabelOnEdit"></label>
                                            <span id="statusIconOnEdit"></span>
                                        </div>
                                        
                                        <ul class="slds-tabs--default__nav customTabs" role="tablist">
                                            
                                            <li class="slds-tabs--default__item slds-text-heading--label slds-active" title="Details" role="presentation">
                                                <a class="slds-tabs--default__link" href="javascript:void(0);" role="tab" tabindex="0" aria-selected="true" aria-controls="tab-default-1" id="tab-default-1__item">
                                                    Details
                                                </a>
                                            </li>
                                            <li class="slds-tabs--default__item slds-text-heading--label" title="Notes" role="presentation">
                                                <a class="slds-tabs--default__link" href="javascript:void(0);" role="tab" tabindex="-1" aria-selected="true" aria-controls="tab-default-2" id="tab-default-2__item">                                                    
                                                    Notes
                                                </a>
                                            </li>
                                            <li class="slds-tabs--default__item slds-text-heading--label" title="History" role="presentation">
                                                <a class="slds-tabs--default__link" href="javascript:void(0);" role="tab" tabindex="-1" aria-selected="true" aria-controls="tab-default-3" id="tab-default-3__item">
                                                    History
                                                </a>
                                            </li>
                                            <li class="slds-tabs--default__item slds-text-heading--label slds-hide" title="Advance Actions" role="presentation" id="advanceDetailsSection">
                                                <a class="slds-tabs--default__link" href="javascript:void(0);" role="tab" tabindex="-1" aria-selected="true" aria-controls="tab-default-4" id="tab-defaul-4__item">
                                                    Adv. Actions
                                                </a>
                                            </li>
                                            <li class="slds-tabs--default__item slds-text-heading--label slds-hide" title="Enrolment" role="presentation" id="enrolmentDetailSection">
                                                <a class="slds-tabs--default__link" href="javascript:void(0);" role="tab" tabindex="-1" aria-selected="true" aria-controls="tab-default-5" id="tab-defaul-5__item">
                                                    Enrolment
                                                </a>
                                            </li>
                                        </ul>
                                        <div id="tab-default-1" class="slds-tabs--default__content slds-show" role="tabpanel" aria-labelledby="tab-default-1__item">
                                            <div class="slds-grid slds-wrap slds-p-around_xx-small">
                                                
                                                <div class="slds-col slds-size_1-of-1">
                                                <div class="editBookingDetailBody">
                                                    <div class="slds-grid slds-gutters">
                                                        <div class="slds-col slds-size_5-of-12">
                                                            <span class="slds-form-element__label slds-text-align_right"><b>Location:</b></span>
                                                            <!--<span id="centerName"></span>-->
                                                            <span><a id="centerName" href="" target="_blank"></a></span>
                                                        </div>
                                                        <div class="slds-col slds-size_7-of-12">
                                                            <span class="slds-form-element__label slds-text-align_right"><b>Student:</b></span>
                                                            <!--<span id="name1"></span>-->
                                                            <span><a id="name1" target="_blank" href="#"></a></span>
                                                        </div>
                                                    </div>
                                                    <div class="slds-grid slds-gutters">
                                                        <div class="slds-col slds-size_5-of-12">
                                                            <span class="slds-form-element__label slds-text-align_right"><b>Teacher Name:</b></span>
                                                            <!--<span id="teacherNameEditPopup"></span>-->
                                                            <span><a id="teacherNameEditPopup" target="_blank" href="#"></a></span>
                                                        </div>
                                                        
                                                        <div class="slds-col slds-size_7-of-12">
                                                            <span class="slds-form-element__label slds-text-align_right"><b>Parent:</b></span>
                                                            <!--<span id="parentname1"></span>-->
                                                            <span><a id="parentname1" target="_blank" href="#"></a></span>
                                                        </div>
                                                        
                                                    </div>
                                                    <div class="slds-grid slds-gutters">
                                                        <div class="slds-col slds-size_5-of-12">
                                                            <span class="slds-form-element__label slds-text-align_right"><b>Date:</b></span>
                                                            <span id="date"></span>
                                                           
                                                        </div>
                                                        
                                                        <div class="slds-col slds-size_7-of-12">
                                                            <span class="slds-form-element__label slds-text-align_right"><b>Phone:</b></span>
                                                            <span><a id="phone" target="_blank" href="#"></a></span>
                                                        </div>
                                                    </div>
                                                    <div class="slds-grid slds-gutters">
                                                        <div class="slds-col slds-size_5-of-12">
                                                            <span class="slds-form-element__label slds-text-align_right"><b>Time:</b></span>
                                                            <span id="serviceTime"></span>
                                                           
                                                        </div>
                                                        
                                                        <div class="slds-col slds-size_7-of-12" style="margin-right: 0px;padding-right: 0PX;">
                                                            <span class="slds-form-element__label slds-text-align_right"><b>Email:</b></span>
                                                            <span id="email"></span>
                                                        </div>
                                                    </div>
                                                    <div class="slds-grid slds-gutters">
                                                        <div class="slds-col slds-size_5-of-12">
                                                            <span class="slds-form-element__label slds-text-align_right"><b>Package:</b></span>
                                                            <span id="servicePackagName"></span>
                                                        </div>
                                                        <div class="slds-col slds-size_7-of-12">
                                                            <span class="slds-form-element__label slds-text-align_right"><b>Duration:</b></span>
                                                            <span id="serviceDuration"></span>
                                                        </div>
                                                        
                                                    </div>
                                                 </div>
                                                    <hr style="margin-bottom: 0px;" id="hr-editAppointment"/>
                                                    <div class="slds-grid slds-gutters slds-m-top_large" >
                                                        <div class="slds-col slds-size_5-of-12" id="button_Group_reschedule" style="padding-left:0px;padding-right:0px;">
                                                            <div class="slds-button-group" role="group" >
                                                                <button class="slds-button slds-button_icon slds-button_icon-border-filled button-shadow" title="No-show" aria-pressed="false" id="noShowBooking">No-show
                                                                <svg class="slds-button__icon" aria-hidden="true">
                                                                  <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#close')}" />
                                                                </svg>
                                                                <span class="slds-assistive-text">No-show</span>
                                                              </button>
                                                               <button class="slds-button slds-button_icon slds-button_icon-border-filled button-shadow" title="Completed" aria-pressed="false" id="completeBooking">Completed
                                                                <svg class="slds-button__icon" aria-hidden="true">
                                                                  <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#check')}" />
                                                                </svg>
                                                                <span class="slds-assistive-text">Complete</span>
                                                              </button>
                                                            </div>
                                                        </div>
                                                        
                                                        <div class="slds-col slds-size_5-of-12" style="padding-left:0px;padding-right:0px;">
                                                            <div class="slds-button-group" role="group">
                                                                <button class="slds-button slds-button_icon slds-button_icon-border-filled button-shadow" title="Cancel" aria-pressed="false" id="cancelBooking">Cancel
                                                                <svg class="slds-button__icon" aria-hidden="true">
                                                                  <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#clear')}" />
                                                                </svg>
                                                                <span class="slds-assistive-text">Cancelled</span>
                                                              </button>
                                                               <button class="slds-button slds-button_icon slds-button_icon-border-filled editBooking button-shadow" title="Reschedule" aria-pressed="false" id="rescheduleBookingOnlyResource">Reschedule
                                                                <svg class="slds-button__icon" aria-hidden="true">
                                                                  <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#edit')}" />
                                                                </svg>
                                                                <span class="slds-assistive-text">Reschedule</span>
                                                              </button>
                                                            </div>
                                                        </div>
                                                        <div class="slds-col slds-size_2-of-12" id="button_Group_EditDetails" style="padding-left:0px;padding-right:0px;">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div id="tab-default-2" class="slds-tabs--default__content slds-hide" role="tabpanel" aria-labelledby="tab-default-2__item">
                                            <div class="slds-col slds-size_1-of-1">
                                                <div>
                                                    <a href="javascript:void(0);" class="slds-button slds-button_brand" id="newBookingNote">
                                                        <svg class="slds-button__icon slds-icon_x-small" aria-hidden="true">
                                                            <use xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#add')}"></use>
                                                        </svg>
                                                        Add New Booking Note
                                                    </a>
                                                </div>
                                            </div>
                                            <div class="slds-grid"> 
                                                <div class="slds-col slds-size_3-of-3 slds-m-top_small slds-wrap slds-scrollable_x" style="height: 200px;overflow-y: auto;">
                                                    <h1>
                                                        <span class="slds-page-header__title slds-truncate">
                                                            Booking Notes:
                                                        </span>
                                                    </h1>
                                                    <table class="slds-table slds-no-row-hover slds-table_bordered slds-wrap slds-scrollable_x">
                                                        <thead>
                                                            <tr class="slds-line-height_reset">
                                                                <th class="" scope="col">
                                                                    <div class="slds-truncate">Title</div>
                                                                </th>
                                                                <th class="" scope="col">
                                                                    <div class="slds-truncate">Body</div>
                                                                </th>
                                                                <th class="" scope="col">
                                                                    <div class="slds-truncate">Date-Time</div>
                                                                </th>
                                                                <th class="" scope="col">
                                                                    <div class="slds-truncate">Created By</div>
                                                                </th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="bookingNotesTBody"></tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                        <div id="tab-default-3" class="slds-tabs--default__content slds-hide" role="tabpanel" aria-labelledby="tab-default-3__item" style="max-height: 300px;overflow-y: auto;">
                                            <p id="bookingHistory" class="slds-m-top_small"></p>
                                        </div>
                                        
                                        <div id="tab-default-5" class="slds-tabs--default__content" role="tabpanel" aria-labelledby="tab-default-5__item" style="max-height: 300px;overflow-y: auto;">
                                            <div class="slds-col slds-size_1-of-1 slds-align_absolute-center">      
                                                <span>      
                                                    <!--<button class="slds-button slds-button_neutral" style="width:350px" id="enrollNowProcess" onclick="enrollNowProcessFunc();return false;">       
                                                        Enrol now       
                                                    </button> -->      
                                                </span>     
                                            </div>
                                            <div class="slds-col slds-size_1-of-1 slds-p-around_small slds-align_absolute-center">
                                                <span>
                                                    <button class="slds-button slds-button_neutral" style="width:350px" id="sendTrialEnrollmentLink" onclick="sendTrialEnrollment($(this).attr('data-id'));return false;">
                                                        Send Enrolment Link
                                                    </button>
                                                </span>
                                            </div>
                                            <div class="slds-col slds-size_1-of-1 slds-p-around_small slds-align_absolute-center">
                                                <span>
                                                    <a class="slds-button slds-button_neutral" style="width:350px;pointer-events:none;" disabled="true" id="completeTrialEnrollmentLink" onclick="$('#trialBookingClickModal').addClass('slds-hide');">
                                                        Complete Enrolment and Send Payment Link
                                                    </a>
                                                </span>
                                            </div>
                                        </div>
                                        <!-- tab 4 start -->
                                        <div id="tab-default-4" class="slds-tabs--default__content slds-hide" role="tabpanel" aria-labelledby="tab-default-4__item">
                                            <div class="slds-form-element__control">
                                                     <div class="slds-grid slds-gutters">
                                                        <div class="slds-col slds-size_5-of-12">
                                                            <span class="slds-form-element__label slds-text-align_right"><b>Package Process Type:</b></span>
                                                            <span id="processTypeEdit"></span>
                                                        </div>
                                                        <div class="slds-col slds-size_7-of-12">
                                                            <span class="slds-form-element__label slds-text-align_right"><b>New Package(If any):</b></span>
                                                            <span><a id="newPackageEdit" target="_blank" href="#"></a></span>
                                                        </div>
                                                    </div>                                                        
                                                    <div class="slds-grid slds-gutters">
                                                        <div class="slds-col slds-size_5-of-12">
                                                            <span class="slds-form-element__label slds-text-align_right"><b>Request Date:</b></span>
                                                            <span id="requestDateEdit"></span>
                                                        </div>
                                                        <div class="slds-col slds-size_7-of-12">
                                                            <span class="slds-form-element__label slds-text-align_right"><b>Effective Date:</b></span>
                                                            <span id="effectiveDateEdit"></span>
                                                        </div>
                                                    </div>
                                                    <div class="slds-grid slds-gutters">
                                                        <div class="slds-col slds-size_5-of-12">
                                                            <span class="slds-form-element__label slds-text-align_right"><b>Notice Period Start:</b></span>
                                                            <span id="noticeStartEdit"></span>
                                                        </div>
                                                        <div class="slds-col slds-size_7-of-12">
                                                            <span class="slds-form-element__label slds-text-align_right"><b>Notice Period End:</b></span>
                                                            <span id="noticeEndEdit"></span>
                                                        </div>
                                                    </div>
                                                    <div class="slds-grid slds-gutters">
                                                        <div class="slds-col slds-size_5-of-12">
                                                            <span class="slds-form-element__label slds-text-align_right"><b>Created By:</b></span>
                                                            <span id="advanceActionRequestedBy"></span>
                                                        </div>
                                                        <div class="slds-col slds-size_7-of-12">
                                                        </div>
                                                    </div>
                                                  </div>
                                            </div>
                                        </div>
                                        <!-- tab 4 ends && tab 5 starts -->
                                        
                                        <!-- tab 5 ends-->
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
                
                
                <div class="editCustomerDetails slds-hide">
                    <section aria-describedby="dialog-body-id-3" aria-labelledby="dialog-heading-id-3"  role="dialog">
                        <button class="slds-button slds-button_icon slds-button_icon-small slds-float_right slds-popover__close" title="Close dialog" onclick="$('.editCustomerDetails').addClass('slds-hide'); return false;">
                            <svg class="slds-button__icon" aria-hidden="true">
                                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/_slds/icons/utility-sprite/svg/symbols.svg#close" />
                            </svg>
                            <span class="slds-assistive-text">Close dialog</span>
                        </button>
                        <header class="slds-popover__header" style="background: #F8B52F; color: #fff">
                            <h2 class="slds-text-heading_small"><b>Editing</b> <span id="popoverTitle"></span></h2>
                        </header>
                        <div class="slds-popover__body slds-form-element slds-form-element_compound" id="dialog-body-id-3">
                            <div class="slds-form-element__control">
                                <div class="slds-form-element__row">
                                    <div class="slds-size_1-of-2">
                                        <div class="slds-form-element customPadding">
                                            <div class="slds-form-element__control">
                                                <input type="text" id="fname" class="slds-input" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="slds-size_1-of-2">
                                        <div class="slds-form-element">
                                            <div class="slds-form-element__control">
                                                <input type="text" id="lname" class="slds-input" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="slds-form-element__row slds-m-top_large">
                                    <div class="slds-size_1-of-2">
                                        <div class="slds-form-element__control slds-input-has-icon slds-input-has-icon_left">
                                            <svg class="slds-icon slds-input__icon slds-input__icon_left slds-icon-text-default" aria-hidden="true">
                                                <use xlink:href="/_slds/icons/utility-sprite/svg/symbols.svg#call"></use>
                                            </svg>
                                            <input id="telephone" class="slds-input" type="text" value="" />
                                        </div>
                                    </div>
                                    <div class="slds-size_1-of-2">
                                        <div class="slds-form-element__control slds-input-has-icon slds-input-has-icon_left">
                                            <svg class="slds-icon slds-input__icon slds-input__icon_left slds-icon-text-default" aria-hidden="true">
                                                <use xlink:href="/_slds/icons/utility-sprite/svg/symbols.svg#search"></use>
                                            </svg>
                                            <input id="parentsms" class="slds-input customInput" type="text" value="" />
                                        </div>
                                    </div>
                                </div>
                                <div class="slds-form-element__row slds-m-top_large">
                                    <div class="slds-size_1-of-1">
                                        <div class="slds-form-element__control slds-input-has-icon slds-input-has-icon_left">
                                            <svg class="slds-icon slds-input__icon slds-input__icon_left slds-icon-text-default" aria-hidden="true">
                                                <use xlink:href="/_slds/icons/utility-sprite/svg/symbols.svg#email"></use>
                                            </svg>
                                            <input id="parentEmail" class="slds-input" type="text" value="" />
                                        </div>
                                    </div>
                                </div>
                                <div class="slds-form-element__row slds-m-top_large">
                                    <div class="slds-form-element__row">
                                        <div class="slds-size_1-of-2">
                                            <div class="slds-form-element customPadding">
                                                <div class="slds-form-element__control">
                                                    <input type="text" id="parentfname" class="slds-input" />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="slds-size_1-of-2">
                                            <div class="slds-form-element">
                                                <div class="slds-form-element__control">
                                                    <input type="text" id="parentlname" class="slds-input" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="slds-form-element__row slds-m-top_large">
                                    <div class="slds-size_1-of-1">
                                        <div class="slds-form-element__control">
                                            <select class="slds-select">
                                                <option>New Customer</option>
                                                <option>Returning Customer</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="slds-form-element__row slds-m-top_large">
                                    <div class="slds-size_1-of-2">
                                        <div class="slds-form-element__control">
                                            <a class="slds-button slds-button_neutral" style="width: 97%; margin-right: 10px" href="javascript:void(0);" onclick="$('.editCustomerDetails').addClass('slds-hide'); return false;">Cancel</a>
                                        </div>
                                    </div>
                                    <div class="slds-size_1-of-2">
                                        <div class="slds-form-element__control">
                                            <a class="slds-button slds-button_brand" style="width: 97%; margin-left: 10px" href="javascript:void(0);" onclick="updateCustomer();return false;">Update</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
                
                <div class="cancellationReasonPopup slds-hide">
                    <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
                        <div class="slds-modal__container" style="width: 35%;">
                            <div class="slds-modal__content" id="modal-content-id-1">
                                <div style="background:#303a42;  color:white;">
                                    <div class="slds-grid slds-wrap">
                                        <div class="slds-col slds-size_11-of-12 slds-large-size_11-of-12">
                                            <h2 id="reasonPopupText" class="slds-text-heading_medium slds-hyphenate slds-p-around_medium">Cancel appointment</h2>
                                        </div>
                                        <div class="slds-col slds-size_1-of-12 slds-large-size_1-of-12 slds-p-top_medium">
                                            <span class="pointerForClick" onclick="$('.cancellationReasonPopup').addClass('slds-hide'); return false;">
                                                <svg class="slds-button__icon slds-button__icon_left" aria-hidden="true">
                                                    <use xlink:href="/_slds/icons/utility-sprite/svg/symbols.svg#close"></use>
                                                </svg>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="popupBody">
                                    <div class="slds-p-around_small notMakeupHoursShow">
                                        <b>The following services will be cancelled:</b>
                                        <ul style="padding-left:25px;list-style:disc">
                                            <li><span id="lessonOnCancel"></span> with <span id="teacherOnCancel"></span> on <span id="dateAndTimeOnCancel"></span></li>
                                        </ul>
                                    </div>
                                    <div class="slds-p-around_small slds-hide makeupTitle">
                                        <b>You are cancelling this event within 24 hours. Do you want to give make up credit for this booking:</b>
                                        <div class="slds-p-around_small">
                                            <button class="slds-button slds-button_neutral" id="no-makeup"> 
                                                <svg class="slds-button__icon slds-button__icon_left" aria-hidden="true">
                                                    <use xlink:href="/_slds/icons/utility-sprite/svg/symbols.svg#close"></use>
                                                </svg>
                                                No
                                            </button>
                                            <button class="slds-button slds-button_brand" id="yes-makeup"> 
                                                <svg class="slds-button__icon slds-button__icon_left" aria-hidden="true">
                                                    <use xlink:href="/_slds/icons/utility-sprite/svg/symbols.svg#check"></use>
                                                </svg>
                                                Yes
                                            </button>
                                        </div>
                                    </div>
                                    <div class="slds-p-around_small reasonSection">
                                        <b class="reasonText">Reason for Cancellation</b>
                                        <select class="slds-select" id="cancelReason" onchange="showMessageForCancellation();return false;">
                                            
                                        </select>
                                        <p id="errorMsgReason" style="color:red;"></p>
                                    </div>
                                    
                                    <div class="slds-p-around_small slds-hide makeupCredit">
                                        <b>Remark for Make-up credit</b>
                                        <textarea id="remarkForCancellation" placeholder="Please Enter Reason for Make-up Credit" class="slds-textarea"></textarea>
                                        <p id="errorMsgRemark" style="color:red;"></p>
                                    </div>
                                    
                          
                                </div>
                            </div>
                            <footer class="slds-modal__footer">
                                <button class="slds-button slds-button_neutral close-popup" onclick="$('.cancellationReasonPopup').addClass('slds-hide'); return false;">
                                    <svg class="slds-button__icon slds-button__icon_left" aria-hidden="true">
                                        <use xlink:href="/_slds/icons/utility-sprite/svg/symbols.svg#close"></use>
                                    </svg>
                                    Close
                                </button>
                                
                                <button class="slds-button slds-button_neutral slds-button_destructive" href="javascript:void(0);" id="cancelBookingWithReason">
                                    <svg class="slds-button__icon slds-button__icon_left" aria-hidden="true">
                                        <use xlink:href="/_slds/icons/utility-sprite/svg/symbols.svg#delete"></use>
                                    </svg>
                                    Cancel Appointment
                                </button>
                                <button class="slds-button slds-button_neutral slds-hide" href="javascript:void(0);" id="cancelBookingWithMakeupBtn">
                                    Give Makeup Credit Hours
                                </button>
                            </footer>
                        </div>
                    </section>
                    <div class="slds-backdrop slds-backdrop_open"></div>
                </div>
                <div class="confirmModal slds-hide" id="confirmModal">
                    <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
                        <div class="slds-modal__container" style="width: 35%;">
                            <header class="slds-modal__header" style="background: #303a42; color: white;">
                                <h2 id="confirmHeader" class="slds-text-heading_medium slds-hyphenate"></h2>
                            </header>
                            <div class="slds-modal__content slds-p-around_medium" id="confirmBody"></div>
                            <footer class="slds-modal__footer">
                                <button class="slds-button slds-button_neutral revert" id="confirmModalNo" onclick="$('.confirmModal').addClass('slds-hide'); return false;">No</button>
                                <button class="slds-button slds-button_brand yesClass" id="confirmModalYes">Yes</button>
                            </footer>
                        </div>
                    </section>
                    <div class="slds-backdrop slds-backdrop_open"></div>
                </div>
               
                <!--New Booking Click Modal-->
                <div class="slds-hide" id="newBookingModal">
                    <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
                        <div class="slds-modal__container" style="width: 30%;">
                            <header class="slds-modal__header" style="background: #303a42; color: white;">
                                <h2 id="newBookingHeader" class="slds-text-heading_medium slds-hyphenate"></h2>
                                <a href="javascript:void(0);" class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick="$('#newBookingModal').addClass('slds-hide'); return false;">
                                    <svg class="slds-button__icon slds-button__icon_large" aria-hidden="true">
                                        <use xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#close')}"></use>
                                    </svg>
                                    <span class="slds-assistive-text">Close</span>
                                </a>
                            </header>
                            <div class="slds-modal__content slds-p-around_medium" id="newBookingBody">
                                <div class="slds-grid slds-wrap">
                                    <div class="slds-col slds-size_1-of-1 slds-align_absolute-center">
                                        <span>
                                            <button class="slds-button slds-button_neutral" style="width:250px" id="addNewBooking" onclick="newAppointmentPopup($(this).attr('data-centerid'), $(this).attr('data-teacherid'), $(this).attr('data-date'));return false;">
                                                <svg class="slds-button__icon slds-button__icon_left" aria-hidden="true">
                                                    <use xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#event')}"></use>
                                                </svg>Add Appointment
                                            </button>
                                        </span>
                                    </div>
                                    <div class="slds-col slds-size_1-of-1 slds-align_absolute-center">
                                        <span>
                                            <button class="slds-button slds-button_neutral" style="width:250px" id="addBusyTime" onclick="addBusyTimeFunc();return false;">
                                                <svg class="slds-button__icon slds-button__icon_left" aria-hidden="true">
                                                    <use xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#error')}"></use>
                                                </svg>Add busy time
                                            </button>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            
                        </div>
                    </section>
                    <div class="slds-backdrop slds-backdrop_open"></div>
                </div>
                
                <!--Trial Booking Click Modal-->
                <div class="slds-hide" id="trialBookingClickModal">
                    <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
                        <div class="slds-modal__container" style="width: 35%;">
                            <header class="slds-modal__header" style="background: #303a42; color: white;">
                                <h2 id="trialBookingClickModalHeader" class="slds-text-heading_medium slds-hyphenate">Trial Booking</h2>
                                <a href="javascript:void(0);" class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick="$('#trialBookingClickModal').addClass('slds-hide'); return false;">
                                    <svg class="slds-button__icon slds-button__icon_large" aria-hidden="true">
                                        <use xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#close')}"></use>
                                    </svg>
                                    <span class="slds-assistive-text">Close</span>
                                </a>
                            </header>
                            <div class="slds-modal__content slds-p-around_medium" id="trialBookingClickModalBody">
                                <div class="slds-grid slds-wrap">
                                    <div class="slds-col slds-size_1-of-1 slds-align_absolute-center">
                                        <span>
                                            <button class="slds-button slds-button_neutral" style="width:350px" id="rescheduleTrialBooking" onclick="rescheduleTrialBookingfunc($(this).attr('data-id'), $(this).attr('data-date'));return false;">
                                                Reschedule Trial Appointment
                                            </button>
                                        </span>
                                    </div>
                                    <div class="slds-col slds-size_1-of-1 slds-align_absolute-center">
                                        <span>
                                            <button class="slds-button slds-button_neutral" style="width:350px" id="sendTrialEnrollmentLink" onclick="sendTrialEnrollment($(this).attr('data-id'));return false;">
                                                Send Enrolment Link
                                            </button>
                                        </span>
                                    </div>
                                    <div class="slds-col slds-size_1-of-1 slds-align_absolute-center">
                                        <span>
                                            <button class="slds-button slds-button_neutral" style="width:350px;pointer-events:none;" id="completeTrialEnrollmentLink" disabled="true" onclick="$('#trialBookingClickModal').addClass('slds-hide');">
                                                Complete Enrolment and Send Payment Link!
                                            </button>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            
                        </div>
                    </section>
                    <div class="slds-backdrop slds-backdrop_open"></div>
                </div>
                <!--New Booking Note popup-->
                <div class="addNotes slds-hide" style="height: 640px;">
                    <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open slds-modal_small">
                        <div class="slds-modal__container" style="width: 50%;">
                            <header class="slds-modal__header" style="background: #303a42;">
                                <a href="javascript:void(0);" class="slds-button slds-button_icon close-btn" title="Close" onclick="$('.addNotes').addClass('slds-hide'); return false;" style="color:#fff;">
                                    <svg class="slds-button__icon slds-button__icon_large" aria-hidden="true">
                                        <use xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#close')}"></use>
                                    </svg>
                                    <span class="slds-assistive-text">Close</span>
                                </a>
                                <h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate" style="text-align: left; color: #fff; font-weight: 600;">Add New Booking Note</h2>
                            </header>
                            <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                                <div id="addBookingNoteSection">
                                    <div class="slds-box slds-m-top_small">
                                        <div class="slds-form-element">
                                            <label class="slds-form-element__label">Title</label>
                                            <div class="slds-form-element__control">
                                                <input type="text" id="title" class="slds-input" required="true" />
                                            </div>
                                        </div>
                                        <div class="slds-form-element">
                                            <label class="slds-form-element__label">Body</label>
                                            <div class="slds-form-element__control">
                                                <textarea id="note" class="slds-textarea"></textarea>
                                            </div>
                                        </div>
                                        <div class="slds-form-element slds-text-align_right slds-m-top_small">
                                            <a href="javascript:void(0);" class="slds-button slds-button_brand" id="saveBookingNote" onclick="saveBookingNote(); return false;">
                                                Save
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                    <div class="slds-backdrop slds-backdrop_open"></div>
                </div>
                
                <!-- New Appointment create popup -->
                <div class="slds-hide" id="newBookingDetails">
                    <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
                        <div class="slds-modal__container" style="padding: 10px;">
                            <header class="slds-modal__header" style="background: #303a42; color: white;">
                                <h2 id="newBookingDetailsHeader" class="slds-text-heading_medium slds-hyphenate">Create Appointment</h2>
                                <a href="javascript:void(0);" class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick="$('#newBookingDetails').addClass('slds-hide');refreshNewBookingPopup(); return false;">
                                    <svg class="slds-button__icon slds-button__icon_large" aria-hidden="true">
                                        <use xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#close')}"></use>
                                    </svg>
                                    <span class="slds-assistive-text">Close</span>
                                </a>
                            </header>
                            <div class="slds-modal__content slds-p-around_medium" id="newBookingDetailsBody" style="overflow-y: auto;height:600px">
                                 <div class="slds-grid slds-wrap slds-p-around_xx-small">
                                 
                                    <div class="slds-col slds-size_1-of-1">
                                        <div class="slds-grid slds-gutters">
                                            <div class="slds-col slds-size_1-of-12">
                                                <label class="slds-form-element__label hyphens-none-fix" style="hyphens:none" for="centerNameLabel"><b>Location:</b></label>
                                            </div>
                                            <div class="slds-col slds-size_4-of-12">
                                                <div class="slds-form-element__control" style="top: 3px;padding-left:10px;">
                                                    <label id="centerNameLabel"></label>
                                                </div>
                                            </div>
                                            <div class="slds-col slds-size_1-of-12">
                                                <label class ="slds-form-element__label hyphens-none-fix" for="studentInput"><b>Student:</b></label> 
                                            </div>
                                             <div class="slds-col slds-size_6-of-12" style="padding-left:20px;">
                                                <div class="slds-form-element__control">
                                                    <div class="slds-combobox_container">
                                                        <div class="slds-combobox slds-dropdown-trigger slds-dropdown-trigger_click " aria-expanded="false" aria-haspopup="listbox" role="combobox" id="studentSelectContainer">
                                                            <div class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon_right" role="none">
                                                                <input class="slds-input slds-combobox__input" id="studentInput" aria-autocomplete="list" aria-controls="listbox-id-1" autocomplete="off" role="textbox" type="text" placeholder="Student Name" value="" />
                                                                
                                                            </div>
                                                            <div id="listbox-id-1" class="slds-dropdown slds-dropdown_length-with-icon-7 slds-dropdown_fluid" role="listbox" style="max-height: 160px;">
                                                                <ul class="slds-listbox slds-listbox_vertical" role="presentation" id="studentSearchList">
                                                                    
                                                                </ul>
                                                            </div>
                                                        </div>
                                                    </div>
                                                 </div>
                                            </div>
                                        </div>
                                        
                                        <div class="slds-grid slds-gutters">
                                            <div class="slds-col slds-size_1-of-12" style="padding-top:10px;">
                                               <label class="slds-form-element__label hyphens-none-fix" for="dateLabel"><b>Date:</b></label>
                                            </div>
                                            <div class="slds-col slds-size_4-of-12" style="padding-top:14px;">
                                                <div class="slds-form-element__control" style="padding-left:10px;">
                                                    <label class="slds-form- element__label" id="dateLabel"></label>
                                                </div>
                                            </div>
                                            <div class="slds-col slds-size_1-of-12" style="padding-top:10px;">
                                                    <label class="slds-form-element__label hyphens-none-fix" for="parentInput"><b>Parent:</b></label>
                                            </div>
                                            <div class="slds-col slds-size_6-of-12" style="padding-top:10px;">
                                                <div class="slds-form-element__control" style="padding-left:9px;">
                                                    <input id="parentInput" placeholder="Parent Name" class="slds-input" type="text" value="" />  
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="slds-grid slds-gutters">
                                            <div class="slds-col slds-size_1-of-12" style="padding-top:10px;">
                                               <label class="slds-form-element__label" for="timeLabel"><b>Time:</b></label> 
                                            </div>
                                            <div class="slds-col slds-size_4-of-12" style="padding-top:14px;">
                                               <div class="slds-form-element__control" style="padding-left:10px;">
                                                    <label id="timeLabel"></label>
                                                </div>     
                                            </div>
                                            <div class="slds-col slds-size_1-of-12" style="padding-top:10px;">
                                               <label class="slds-form-element__label" for="phoneInput"><b>Phone:</b></label> 
                                            </div>
                                            <div class="slds-col slds-size_6-of-12" style="padding-top:10px;">
                                                <div class="slds-form-element__control" style="padding-left:9px;">
                                                    <input id="phoneInput" placeholder="Phone" class="slds-input" type="text" value="" /> 
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="slds-grid slds-gutters">
                                            <div class="slds-col slds-size_1-of-12" style="padding-top:10px;">
                                               <label class="slds-form-element__label" for="makeupHoursLabel"><b>AMM:</b></label> 
                                            </div>
                                            <div class="slds-col slds-size_4-of-12" style="padding-top:14px;">
                                               <div class="slds-form-element__control" style="padding-left:10px;">
                                                    <label id="makeupHoursLabel"></label><br/>
                                                    <label class="" id="makeupHoursErrorMsg" style="color:red;"></label>
                                                </div>     
                                            </div>
                                            <div class="slds-col slds-size_1-of-12" style="padding-top:10px;">
                                               <label class="slds-form-element__label" for="emailInput"><b>Email:</b></label>  
                                            </div>
                                            <div class="slds-col slds-size_6-of-12" style="padding-top:10px;">
                                                <div class="slds-form-element__control" style="padding-left:9px;">
                                                   <input id="emailInput" placeholder="Email" class="slds-input" type="text" value="" /> 
                                                </div>
                                            </div>
                                            
                                        </div>
                                        
                                        <div class="slds-grid slds-gutters">
                                            <div class="slds-col slds-size_1-of-12" style="padding-top:10px;">
                                               <label class ="slds-form-element__label hyphens-none-fix" for="durationLabel"><b>Duration:</b></label> 
                                            </div>
                                            <div class="slds-col slds-size_4-of-12" style="padding-top:14px;">
                                               <div class="slds-form-element__control" style="padding-left:10px;">
                                                    <label id="durationLabel"></label>
                                                </div>     
                                            </div>
                                            <div class="slds-col slds-size_1-of-12" style="padding-top:10px;">
                                               <label class="slds-form-element__label hyphens-none-fix" for="packageSelect"><b>Package:</b></label> 
                                            </div>
                                            <div class="slds-col slds-size_6-of-12" style="padding-top:10px;">
                                               <div class="slds-form-element__control" style="padding-left:9px;">
                                                <div class="slds-combobox_container">
                                                  <div class="slds-combobox slds-dropdown-trigger slds-dropdown-trigger_click" id="getPackageId" aria-expanded="true" aria-haspopup="listbox" role="combobox">
                                                    <div class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon_right" role="none">
                                                      <input type="text" class="slds-input slds-combobox__input slds-has-focus" id="packageSelect" aria-controls="listbox-id-3" autoComplete="off" role="textbox" placeholder="Select Package" readonly="true" />
                                                      <span class="slds-icon_container slds-icon-utility-down slds-input__icon slds-input__icon_right">
                                                        <svg class="slds-icon slds-icon slds-icon_x-small slds-icon-text-default" aria-hidden="true">
                                                          <use xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#down')}"></use>
                                                        </svg>
                                                      </span>
                                                    </div>
                                                    <div id="selectPackageListSection" class="slds-dropdown slds-dropdown_fluid slds-dropdown_length-5" role="listbox">
                                                          
                                                    </div>
                                                  </div>
                                                </div> 
                                               </div>
                                            </div>
                                        </div>
                                        
                                        <div class="slds-grid slds-gutters">
                                            <div class="slds-col slds-size_1-of-1" style="padding-top:10px;">
                                                <div class="slds-form__row slds-hide" id="recurringSection">
                                                    <div class="slds-form__item" role="listitem" style="padding-left: 5px;">
                                                        <div class="slds-form-element slds-form-element_horizontal slds-is-editing">
                                                           <table class="slds-table slds-no-row-hover recurrence ">
                                                                <tr>
                                                                    <th>Repeat</th>
                                                                    <td>
                                                                        <select class="slds-select" id="repeatSelect" onchange="repeatSelectFunc($(this).val());return false;">
                                                                            <option value="">None</option>
                                                                            <option value="Weeks">Weekly</option>
                                                                        </select>
                                                                    </td>
                                                                </tr>
                                                                <tr class="repeatSelection slds-hide">
                                                                    <th>Repeat Every</th>
                                                                    <td>
                                                                        <select class="slds-select" id="repeatWeek">
                                                                            
                                                                        </select>
                                                                        <span id="repeatValue">Week</span>
                                                                    </td>
                                                                </tr>
                                                                <tr class="repeatSelection slds-hide">
                                                                    <th>Ends</th>
                                                                    <td>
                                                                        <p>
                                                                            <span>
                                                                                <input name="radio" type="radio" id="afterRadio" checked="true"/>
                                                                            </span>&nbsp;&nbsp; After
                                                                            <select class="slds-select" id="recurrenceOccure">
                                                                                
                                                                            </select>&nbsp;&nbsp;
                                                                            <span>occurrencess</span>
                                                                        </p>
                                                                        <p class="slds-m-top_xxx-small">
                                                                            <span>
                                                                                <input name="radio" type="radio" id="onRadio"/>
                                                                            </span>&nbsp;&nbsp; on 
                                                                            <input class="slds-input" type="text" placeholder="Pick a Date" label="Date Picker Label" id="onSelectedDate"/>
                                                                        </p>
                                                                        
                                                                    </td>
                                                                </tr>
                                                            </table>
                                                        </div>
                                                    </div>
                                                    <div class="slds-form__item" role="listitem"> 
                                                        
                                                    </div>
                                                </div>
                                    
                                            </div>
                                        </div>
                                    </div>
                                 </div>
                            </div>   
                            <footer class="slds-modal__footer">
                                <button class="slds-button slds-button_neutral" onclick="$('#newBookingDetails').addClass('slds-hide');refreshNewBookingPopup(); return false;">No</button>
                                <button class="slds-button slds-button_brand" id="saveNewBooking" onclick="createBooking();return false;">Save</button>
                            </footer>  
                        </div>
                    </section>
                    <div class="slds-backdrop slds-backdrop_open"></div>
                </div>
                
                <!-- Send Email -->
                <div class="sendEmail slds-hide">
                    <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open slds-modal_small">
                        <div class="slds-modal__container" style="width: 50%;">
                            <header class="slds-modal__header" style="background: #303a42; color: white;">
                                <a href="javascript:void(0);" class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick="$('.sendEmail').addClass('slds-hide'); return false;">
                                    <svg class="slds-button__icon slds-button__icon_large" aria-hidden="true">
                                        <use xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#close')}"></use>
                                    </svg>
                                    <span class="slds-assistive-text">Close</span>
                                </a>
                                <h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">Send Email</h2>
                            </header>
                            <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                                <c:sendemailcomp />
                            </div>
                            <footer class="slds-modal__footer">
                                <a href="javascript:void(0);" class="slds-button slds-button_neutral" id="sendEmailNo" onclick="$('.sendEmail').addClass('slds-hide'); return false;">Close</a>
                                <a href="javascript:void(0);" class="slds-button slds-button_brand" id="sendEmailYes" onclick="sendEmail(); $('.confirmModal').addClass('slds-hide'); $('.sendEmail').addClass('slds-hide'); return false">Send E-Mail</a> 
                            </footer>
                        </div>
                    </section>
                    <div class="slds-backdrop slds-backdrop_open"></div>
                </div>
            </div>
            
            <!--case container message-->
            <div class="slds-notify_container slds-hide" id="caseContainerMessage">
                <div class="slds-notify slds-notify--alert slds-theme_alt-inverse" role="alert" style="justify-content: right;text-align: left; padding:0px;">
                    <button class="slds-button slds-notify__close slds-button--icon-inverse" id="caseContainerClose" title="Close" onclick="closeCaseContainer();return false;">
                        <svg aria-hidden="true" class="slds-button__icon">
                            <use xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#close')}"></use>
                        </svg>
                        <span class="slds-assistive-text">Close</span>
                    </button>
                    <div class="slds-grid slds-wrap" style="flex-wrap: inherit;">
                        <div class="slds-col slds-size_12-of-12">
                            <span class="slds-form-element__label" style="color: #fff;"><b>Parent Name: </b></span>
                            <span>
                                <a href="#" id="caseParentName" target="_blank"></a>
                            </span>
                        </div>
                        <div class="slds-col slds-size_12-of-12">
                            <span class="slds-form-element__label" style="color: #fff;"><b>Case No: </b></span>
                            <span>
                                <a href="#" id="caseNo" target="_blank"></a>
                            </span>
                        </div>
                        <div class="slds-col slds-size_12-of-12">
                            <span class="slds-form-element__label" style="color: #fff;"><b>Type: </b></span>
                            <span id="caseType">
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            <!--case container message end -->
            
            <!-- container message -->
            <div class="slds-notify_container slds-hide" id="containerMessage">
                <div class="slds-notify slds-notify--alert slds-theme_alt-inverse" style="padding:0px;" role="alert">
                    <button class="slds-button slds-notify__close slds-button--icon-inverse" id="rescheduleClose" title="Close" onclick="closeContainerMessage();">
                        <svg aria-hidden="true" class="slds-button__icon">
                            <use xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#close')}"></use>
                        </svg>
                        <span class="slds-assistive-text">Close</span>
                    </button>
                    <span class="slds-assistive-text">Info</span>
                    <h2>Select Time To Reschedule Appointment</h2>
                </div>
            </div>
            <!-- container message end -->
            <div class="slds-hide" id="newAdhocDetailPopup">
                    <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open slds-modal_medium">
                        <div class="slds-modal__container">
                            <header class="slds-modal__header" style="background: #303a42; color: white;">
                                <h2 id="newAdhocDetailHeader" class="slds-text-heading_medium slds-hyphenate">New Appointment Detail</h2>
                                <a href="javascript:void(0);" class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick="$('#newAdhocDetailPopup').addClass('slds-hide');refreshNewBookingPopup(); return false;">
                                    <svg class="slds-button__icon slds-button__icon_large" aria-hidden="true">
                                        <use xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#close')}"></use>
                                    </svg>
                                    <span class="slds-assistive-text">Close</span>
                                </a>
                            </header>
                            <div class="slds-modal__content slds-p-around_medium" id="newAdhocDetailBody">
                                <div class="slds-form__row">
                                        <div class="slds-form__item" role="listitem">
                                            <div class="slds-form-element slds-form-element_horizontal slds-is-editing">
                                                <label class="slds-form-element__label" for="studentNameadhoc"><b>Student Name:</b></label>  
                                                <div class="slds-form-element__control">
                                                    <label class="slds-form- element__label" id="studentNameadhoc"></label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="slds-form__item" role="listitem">
                                            <div class="slds-form-element slds-form-element_horizontal slds-is-editing">
                                                <label class="slds-form-element__label" for="centerNameadhoc"><b>Center Name:</b></label> 
                                                <div class="slds-form-element__control">
                                                    <label class="slds-form- element__label" id="centerNameadhoc"></label>                                                   
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="slds-form__row">
                                        <div class="slds-form__item" role="listitem">
                                            <div class="slds-form-element slds-form-element_horizontal slds-is-editing">
                                                <label class="slds-form-element__label" for="teacherNameAdhoc"><b>Teacher Name:</b></label>  
                                                <div class="slds-form-element__control">
                                                    <label class="slds-form- element__label" id="teacherNameAdhoc"></label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="slds-form__item" role="listitem">
                                            <div class="slds-form-element slds-form-element_horizontal slds-is-editing">
                                                <label class="slds-form-element__label" for="packageDurationadhoc"><b>Package Duration:</b></label> 
                                                <div class="slds-form-element__control">
                                                    <label class="slds-form- element__label" id="packageDurationadhoc"></label>                                                   
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    
                                    <div class="slds-p-around_medium">
                                        <table class="slds-table slds-table_cell-buffer slds-table_bordered">
                                  <thead>
                                    <tr class="slds-line-height_reset">
                                      <th class="" scope="col">
                                        <div class="slds-truncate" title="Sr.No">Sr No</div>
                                      </th>
                                      <th class="" scope="col">
                                        <div class="slds-truncate" title="Package Name">Package Name</div>
                                      </th>
                                      <th class="" scope="col">
                                        <div class="slds-truncate" title="Package Time">Booking Time</div>
                                      </th>
                                      <th class="" scope="col">
                                        <div class="slds-truncate" title="Package Unit Price">Package Unit Price</div>
                                      </th>
                                      
                                    </tr>
                                  </thead>
                                  <tbody id="countOfBookingTableBody">
                                       
                                   
                                  </tbody>
                                </table>

                                    
                                    </div>
                                    

                            </div>   
                            <footer class="slds-modal__footer">
                                <a href="javascript:void(0);" class="slds-button slds-button_brand" id="createAdhocBookingBtn" onclick="createAdhocBookings();return false;">Create booking and generate invoice</a>
                            </footer>  
                        </div>
                    </section>
                    <div class="slds-backdrop slds-backdrop_open"></div>
                </div>
                
                <!--Advance Option Button Click Popup-->
                <div class="slds-hide" id="advanceOptionPopup">
                    <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open slds-modal_medium">
                        <div class="slds-modal__container" style="width: 60%;">
                            <header class="slds-modal__header" style="background: #303a42; color: white;">
                                <h2 id="advanceOptionPopupHeader" class="slds-text-heading_medium slds-hyphenate">Advance Options</h2>
                                <a href="javascript:void(0);" class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick="$('#advanceOptionPopup').addClass('slds-hide');refreshAdvancePopup(); return false;">
                                    <svg class="slds-button__icon slds-button__icon_large" aria-hidden="true">
                                        <use xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#close')}"></use>
                                    </svg>
                                    <span class="slds-assistive-text">Close</span>
                                </a>
                            </header>
                            <div class="slds-modal__content slds-p-around_medium" id="advanceOptionPopupBody">
                                <div class="slds-col slds-size_1-of-1">
                                    <div class="slds-grid slds-gutters">
                                        <div class="slds-col slds-size_1-of-2">
                                            <span class="slds-form-element__label slds-text-align_right"><b>Package Name: </b></span>
                                            <span id="packageNameAdvance"></span>
                                        </div>
                                        <div class="slds-col slds-size_1-of-2">
                                            <span class="slds-form-element__label slds-text-align_right"><b>Subscription Start Date: </b></span>
                                            <span id="subscriptionDateAdvance"></span>
                                        </div>
                                    </div>
                                    <div class="slds-grid slds-gutters">
                                        <div class="slds-col slds-size_1-of-2">
                                            <span class="slds-form-element__label slds-text-align_right"><b>Frequency: </b></span>
                                            <span id="frequencyAdvance"></span>
                                        </div>
                                        <div class="slds-col slds-size_1-of-2">
                                            <span class="slds-form-element__label slds-text-align_right"><b>Timeslot: </b></span>
                                            <span id="timeslotAdvance"></span>
                                        </div>
                                    </div>
                                    
                                </div>
                                <div class="slds-col slds-size_1-of-1 slds-p-around_medium">
                                    <div class="slds-button-group" role="group">
                                      <button class="slds-button slds-button_icon slds-button_icon-border-filled button-shadow" title="Withdrawal" aria-pressed="false" id="cancelSubscriptionBtn" onclick="cancelSubscription();return false;">Withdrawal
                                        <svg class="slds-button__icon" aria-hidden="true">
                                            <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#close')}" />
                                        </svg>
                                        <span class="slds-assistive-text">Withdrawal</span>
                                      </button>
                                      <button class="slds-button slds-button_icon slds-button_icon-border-filled button-shadow" title="Advancement" aria-pressed="false" id="upgradeSubscriptionBtn" onclick="upgradeSubscription();return false;">Advancement
                                          <svg class="slds-button__icon" aria-hidden="true">
                                            <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#arrowup')}" />
                                          </svg>
                                          <span class="slds-assistive-text">Advancement</span>
                                      </button>
                                      <button class="slds-button slds-button_icon slds-button_icon-border-filled button-shadow" title="Downgrade" aria-pressed="false" id="downgradeSubscriptionBtn" onclick="downgradeSubscription();return false;">Downgrade
                                          <svg class="slds-button__icon" aria-hidden="true">
                                            <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#arrowdown')}" />
                                          </svg>
                                          <span class="slds-assistive-text">Downgrade</span>
                                      </button>
                                      <button class="slds-button slds-button_icon slds-button_icon-border-filled button-shadow" title="Change Enrolment" aria-pressed="false" id="updateEnrolmentBtn" onclick="updateEnrolment();return false;">Change Enrolment
                                          <svg class="slds-button__icon" aria-hidden="true">
                                            <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#edit')}" />
                                          </svg>
                                          <span class="slds-assistive-text">Change Enrolment</span>
                                      </button>
                                      <button class="slds-button slds-button_icon slds-button_icon-border-filled button-shadow" title="Pre Payment" aria-pressed="false" onclick="showPrePaymentModal();return false;" id="prePaymentId">Pre Payment
                                          <svg class="slds-button__icon" aria-hidden="true">
                                              <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#moneybag')}" />
                                          </svg>
                                          <span class="slds-assistive-text">Pre Payment</span>
                                      </button>
                                    </div>
                                </div>
                            </div>  
                        </div>
                    </section>
                    <div class="slds-backdrop slds-backdrop_open"></div>
                </div>
                
                 <!--Upgrade Subscriptions-->
                <div class="slds-hide" id="gradeSubscriptionPopup">
                    <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open slds-modal_medium">
                        <div class="slds-modal__container" style="width: 30%;">
                            <header class="slds-modal__header" style="background: #303a42; color: white;">
                                <h2 id="gradeSubscriptionPopupHeader" class="slds-text-heading_medium slds-hyphenate"><b>Upgrade Subscription</b></h2>
                                <a href="javascript:void(0);" class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick="$('#gradeSubscriptionPopup').addClass('slds-hide'); return false;">
                                    <svg class="slds-button__icon slds-button__icon_large" aria-hidden="true">
                                        <use xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#close')}"></use>
                                    </svg>
                                    <span class="slds-assistive-text">Close</span>
                                </a>
                            </header>
                            <div class="slds-modal__content slds-p-around_medium" id="gradeSubscriptionPopupBody">
                                <div class="slds-grid slds-wrap">
                                    <div class="slds-col slds-size_6-of-12">
                                        <span class="slds-form-element__label slds-text-align_right"><b>Current Package: </b></span>
                                        <span id="currentPackageName"></span>
                                     </div>
                                     <div class="slds-col slds-size_6-of-12">
                                        <span class="slds-form-element__label slds-text-align_right"><b>Requested Package: </b></span>
                                        <span>
                                            <select class="slds-select" id="selectRequestedPackage" style="width: 177px;" onchange="availTimeSlots('upgrade');return false;">
                                            </select>
                                        </span>
                                        <label style="color:red;padding-left: 122px;" id="upgradePackageSelectError"></label>
                                      </div>
                                      <div class="slds-col slds-size_6-of-12">
                                          <div class="slds-grid slds-gutters">
                                              <div class="slds-col slds-size_4-of-12" style="padding-right: 0px;">
                                                <span class="slds-form-element__label slds-text-align_right"><b>Effective Date: </b></span>
                                              </div>
                                              <div class="slds-col slds-size_8-of-12" style="margin-left: -15px;">
                                                <span><!--<input class="slds-input" type="text" placeholder="Pick a Date" label="Date Picker Label" id="effectiveDateInput" onchange="availTimeSlots('upgrade');return false;"/>-->
                                                    <select class="slds-select" id="effectiveDateInput" style="width: auto;" onchange="availTimeSlots('upgrade');return false;">
                                                    </select>
                                                </span>
                                                <label style="color:red;padding-left: 3px;" id="effectiveDateError"></label>
                                              </div>
                                        </div>
                                     </div>
                                     <div class="slds-col slds-size_6-of-12">
                                         <div class="slds-grid slds-gutters">
                                              <div class="slds-col slds-size_4-of-12" style="padding-right: 0px;">
                                                <span class="slds-form-element__label slds-text-align_right"><b>Available Slots: </b></span>
                                              </div>
                                              <div class="slds-col slds-size_8-of-12">
                                                <select class="slds-select" id="availableTimeSlots" style="width: auto;" disabled="true">
                                                    <option>Select Time Slot</option>  
                                                </select>
                                                <label style="color:red;padding-left: 3px;" id="availableTimeSlotsError"></label>
                                              </div>
                                        </div>
                                     </div>
                                     <div class="slds-col slds-size_4-of-12">
                                         <!--<button class="slds-button button-shadow" title="Summary Request" onclick="upgradeSummary('upgrade');return false;" aria-pressed="false">Summary
                                             <svg class="slds-button__icon" aria-hidden="true">
                                                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#summary')}" />
                                             </svg>
                                             <span class="slds-assistive-text">Summary</span>
                                         </button>-->
                                     </div>
                                     <div class="slds-col slds-size_4-of-12">
                                         <button class="slds-button button-shadow" title="Next" aria-pressed="false" id="submitUpgradeRequest" onclick="showUpgradeDowngradeSummary('upgrade');return false;">Next
                                             <svg class="slds-button__icon" aria-hidden="true">
                                                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#check')}" />
                                             </svg>
                                             <span class="slds-assistive-text">Next</span>
                                         </button>
                                     </div>
                                      <div class="slds-col slds-size_4-of-12">
                                         <button class="slds-button button-shadow" title="Cancel" aria-pressed="false" id="cancelUpgradeRequest" onclick="$('#gradeSubscriptionPopup').addClass('slds-hide'); return false;">Cancel
                                             <svg class="slds-button__icon" aria-hidden="true">
                                                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#close')}" />
                                             </svg>
                                             <span class="slds-assistive-text">Cancel</span>
                                         </button>
                                       </div>
                                     </div>
                                  </div>
                                  
                            </div>
                    </section>
                    <div class="slds-backdrop slds-backdrop_open"></div>
                </div>
                
                <!--Cancel subscription Modal-->
                <div class="slds-hide" id="canelSubscriptionPopup">
                    <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open slds-modal_medium">
                        <div class="slds-modal__container" style="width: 30%;">
                            <header class="slds-modal__header" style="background: #303a42; color: white;">
                                <h2 id="canelSubscriptionPopupHeader" class="slds-text-heading_medium slds-hyphenate"><b>Cancel Subscription</b></h2>
                                <a href="javascript:void(0);" class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick="$('#canelSubscriptionPopup').addClass('slds-hide'); return false;">
                                    <svg class="slds-button__icon slds-button__icon_large" aria-hidden="true">
                                        <use xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#close')}"></use>
                                    </svg>
                                    <span class="slds-assistive-text">Close</span>
                                </a>
                            </header>
                            <div class="slds-modal__content slds-p-around_medium" id="canelSubscriptionPopupBody">
                                <div class="slds-grid slds-wrap">
                                    <!--Row 1 -->
                                    <!--<div class="slds-col slds-size_3-of-12 slds-p-vertical_x-small">
                                    </div>
                                    <div class="slds-col slds-size_5-of-12 slds-p-vertical_x-small">
                                        <span class="slds-radio">
                                        <input type="radio" id="cancelByRequestDate" name="cancelByOptions" onchange="cancelBy();return false;"/>
                                        <label class="slds-radio__label" for="cancelByRequestDate">
                                          <span class="slds-radio_faux"></span>
                                          <span class="slds-form-element__label">By Cancellation Request Date</span>
                                        </label>
                                      </span>
                                     </div>
                                     <div class="slds-col slds-size_4-of-12 slds-p-vertical_x-small">
                                        <span class="slds-radio">
                                        <input type="radio" id="cancelByLessonEndDate" name="cancelByOptions" onchange="cancelBy();return false;"/>
                                        <label class="slds-radio__label" for="cancelByLessonEndDate">
                                          <span class="slds-radio_faux"></span>
                                          <span class="slds-form-element__label">By Lesson End Date</span>
                                        </label>
                                      </span>
                                     </div>-->
                                     <!--Row 2 -->
                                     <div class="slds-col slds-size_1-of-12 slds-p-vertical_x-small">
                                     </div>
                                     <div class="slds-col slds-size_6-of-12 slds-p-vertical_x-small">
                                         <span class="slds-form-element__label slds-text-align_right"><b>Notice Period End Date</b></span>
                                         <span>
                                             <input class="slds-input" id="cancelRequestEndDate" style="width:130px;" onchange="getCancelRequestDateFunc();return false;"/>
                                         </span>
                                     </div>
                                     <div class="slds-col slds-size_5-of-12 slds-p-vertical_x-small">
                                         <span class="slds-form-element__label slds-text-align_right"><b>Last Lesson Date</b></span>
                                         <span>
                                             <span id="lastLessonDate"></span>
                                             <!--<input class="slds-input" id="lastLessonDate" style="width:130px;" onchange="getLastLessonDateFunc();return false;"/>-->
                                         </span>
                                     </div>
                                     <!--Row 3 -->
                                     <!--<div class="slds-col slds-size_2-of-12 slds-p-vertical_x-small">
                                     </div>
                                      <div class="slds-col slds-size_5-of-12 slds-p-vertical_x-small">
                                        <span class="slds-form-element__label slds-text-align_right"><b>Notice Period Start: </b></span>
                                        <span id="noticePeriodStart"></span>
                                     </div>
                                     <div class="slds-col slds-size_5-of-12 slds-p-vertical_x-small">
                                        <span class="slds-form-element__label slds-text-align_right"><b>Notice Period End: </b></span>
                                        <span id="noticePeriodEnd"></span>
                                     </div>-->
                                     <!--Row 4-->
                                     <div class="slds-col slds-size_4-of-12 slds-p-vertical_x-small">
                                         <!--<button class="slds-button button-shadow" title="Summary Request" onclick="withdrawSummary();return false;" aria-pressed="false">Summary
                                             <svg class="slds-button__icon" aria-hidden="true">
                                                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#summary')}" />
                                             </svg>
                                             <span class="slds-assistive-text">Summary</span>
                                         </button>-->
                                     </div>
                                     <div class="slds-col slds-size_4-of-12 slds-p-vertical_x-small">
                                             <button class="slds-button button-shadow" title="Confirm Withdrawal" aria-pressed="false" id="submitCancelRequest" onclick="getWithdrawSummary();return false;">Next
                                                 <svg class="slds-button__icon" aria-hidden="true">
                                                    <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#check')}" />
                                                 </svg>
                                                 <span class="slds-assistive-text">Next</span>
                                             </button>
                                     </div>
                                      <div class="slds-col slds-size_4-of-12 slds-p-vertical_x-small">
                                             <button class="slds-button button-shadow" title="Cancel" aria-pressed="false" id="cancelUpgradeRequest" onclick="$('#canelSubscriptionPopup').addClass('slds-hide');return false;">Cancel
                                                 <svg class="slds-button__icon" aria-hidden="true">
                                                    <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#close')}" />
                                                 </svg>
                                                 <span class="slds-assistive-text">Cancel</span>
                                             </button>
                                       </div>
                                </div>
                                  
                            </div>
                        </div>
                    </section>
                    <div class="slds-backdrop slds-backdrop_open"></div>
                </div>
               <!-- Cancel subscription popup closed -->
               <!-- Summary for withdrawl popup start-->
                <div class="slds-hide" id="summaryPopForAdvanceAction">
                    <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open slds-modal_medium">
                        <div class="slds-modal__container" style="width: 30%;">
                            <header class="slds-modal__header" style="background: #303a42; color: white;">
                                <h2 id="summaryPopForAdvanceActionHeader" class="slds-text-heading_medium slds-hyphenate"><b>Summary</b></h2>
                                <a href="javascript:void(0);" class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick="$('#summaryPopForAdvanceAction').addClass('slds-hide');$('#canelSubscriptionPopup').removeClass('slds-hide'); return false;">
                                    <svg class="slds-button__icon slds-button__icon_large" aria-hidden="true">
                                        <use xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#close')}"></use>
                                    </svg>
                                    <span class="slds-assistive-text">Close</span>
                                </a>
                            </header>
                            <div class="slds-modal__content slds-p-around_medium" id="summaryPopForAdvanceActionBody">
                                <div class="slds-grid slds-wrap">
                                     <!--Row 1 -->
                                      <div class="slds-col slds-size_6-of-12 slds-p-vertical_x-small">
                                        <span class="slds-form-element__label slds-text-align_right"><b>Request Date: </b></span>
                                        <span id="summaryRequestDate"></span>
                                     </div>
                                     <div class="slds-col slds-size_6-of-12 slds-p-vertical_x-small">
                                        <span class="slds-form-element__label slds-text-align_right"><b>Last Lesson Date: </b></span>
                                        <span id="summaryLastLessonDate"></span>
                                     </div>
                                     <!--Row 2 -->
                                     <div class="slds-col slds-size_6-of-12 slds-p-vertical_x-small">
                                        <span class="slds-form-element__label slds-text-align_right"><b>Notice Period Start Date: </b></span>
                                        <span id="summaryNoticeStartDate"></span>
                                     </div>
                                     <div class="slds-col slds-size_6-of-12 slds-p-vertical_x-small">
                                        <span class="slds-form-element__label slds-text-align_right"><b>Notice Period End Date: </b></span>
                                        <span id="summaryNoticeEndDate"></span>
                                     </div>
                                     <div class="slds-col slds-size_6-of-12 slds-p-vertical_x-small">
                                        <span class="slds-form-element__label slds-text-align_right"><b>Lesson To Be Adjusted Against Deposit Fee: </b></span>
                                        <span id="summaryNoOfLessonFromDeposit"></span>
                                     </div>
                                     <!--Row 3 -->
                                     <!--Row 4-->
                                </div>
                            </div>
                        </div>
                    </section>
                    <div class="slds-backdrop slds-backdrop_open"></div>
                </div>
                 
               <!-- Summary for withdrawl popup end-->
                
                <!-- Summary for downgrade/upgrade popup start-->
                <div class="slds-hide" id="summaryPopForUpDown">
                    <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open slds-modal_medium">
                        <div class="slds-modal__container" style="width: 30%;">
                            <header class="slds-modal__header" style="background: #303a42; color: white;">
                                <h2 id="summaryPopForUpDownHeader" class="slds-text-heading_medium slds-hyphenate"><b>Summary</b></h2>
                                <a href="javascript:void(0);" class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" id="updownsummaryclose" title="Close" onclick="closeUpDownSummary();return false;">
                                    <svg class="slds-button__icon slds-button__icon_large" aria-hidden="true">
                                        <use xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#close')}"></use>
                                    </svg>
                                    <span class="slds-assistive-text">Close</span>
                                </a>
                            </header>
                            <div class="slds-modal__content slds-p-around_medium" id="summaryPopForUpDownBody">
                                <div class="slds-grid slds-wrap slds-hide" id="downgradeDetailsSection">
                                     <!--row1-->
                                     <div class="slds-col slds-size_6-of-12 slds-p-vertical_x-small">
                                        <span class="slds-form-element__label slds-text-align_right"><b>Request Date: </b></span>
                                        <span id="summaryRequestDate1"></span>
                                     </div>
                                     <div class="slds-col slds-size_6-of-12 slds-p-vertical_x-small">
                                        <span class="slds-form-element__label slds-text-align_right"><b>Effective Date: </b></span>
                                        <span id="summaryEffectiveLessonDate"></span>
                                     </div>
                                         <!--Row 2 -->
                                     <div class="slds-col slds-size_6-of-12 slds-p-vertical_x-small">
                                        <span class="slds-form-element__label slds-text-align_right"><b>Notice Period Start Date: </b></span>
                                        <span id="summaryNoticeStartDate1"></span>
                                     </div>
                                     <div class="slds-col slds-size_6-of-12 slds-p-vertical_x-small">
                                        <span class="slds-form-element__label slds-text-align_right"><b>Notice Period End Date: </b></span>
                                        <span id="summaryNoticeEndDate1"></span>
                                     </div>
                                 </div>
                                 <div class="slds-grid slds-wrap">
                                
                                     <!--Row 3 -->
                                     <div class="slds-col slds-size_6-of-12 slds-p-vertical_x-small">
                                        <span class="slds-form-element__label slds-text-align_right"><b>Old Pakcage </b></span>
                                        <span id="oldPackageName"></span>
                                     </div>
                                     <div class="slds-col slds-size_6-of-12 slds-p-vertical_x-small">
                                        <span class="slds-form-element__label slds-text-align_right"><b>New Package</b></span>
                                        <span id="newPackageName"></span>
                                     </div>
                                     <!--Row 4-->
                                     <div class="slds-col slds-size_6-of-12 slds-p-vertical_x-small">
                                        <span class="slds-form-element__label slds-text-align_right"><b>No Of Lesson With Old Package: </b></span>
                                        <span id="lessonWithOldPackage"></span>
                                     </div>
                                     <div class="slds-col slds-size_6-of-12 slds-p-vertical_x-small">
                                        <span class="slds-form-element__label slds-text-align_right"><b>No Of Lesson With new Package:</b></span>
                                        <span id="lessonWithNewPackage"></span>
                                     </div>
                                </div>
                            </div>
                        </div>
                    </section>
                    <div class="slds-backdrop slds-backdrop_open"></div>
                </div>
                <!-- Summary for downgrade/upgrade popup end-->
                  
                <!--Busy Time Creation Modal-->
                <div class="slds-hide" id="busyBookingCreateModal">
                    <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
                        <div class="slds-modal__container" style="padding:10px;"> <!-- width: 35%;-->
                            <header class="slds-modal__header" style="background: #303a42; color: white;">
                                <h2 id="busyBookingCreateModalHeader" class="slds-text-heading_medium slds-hyphenate">Busy Booking</h2>
                                <a href="javascript:void(0);" class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick="$('#busyBookingCreateModal').addClass('slds-hide'); return false;">
                                    <svg class="slds-button__icon slds-button__icon_large" aria-hidden="true">
                                        <use xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#close')}"></use>
                                    </svg>
                                    <span class="slds-assistive-text">Close</span>
                                </a> 
                            </header>
                            <div class="slds-modal__content slds-p-around_medium" id="busyBookingCreateModalBody">
                                <div class="slds-grid slds-wrap">
                                    <div class="slds-col slds-size_3-of-12" style="padding-left:20px;padding-top:10px;">
                                        <span><b>Location</b></span>
                                    </div>
                                    <div class="slds-col slds-size_9-of-12" style="padding-top:10px;">
                                        <span><label id="centerNameBusyCreate">Aureus Northpoint</label></span>
                                    </div>
                                     <div class="slds-col slds-size_3-of-12" style="padding-left:20px;padding-top:10px;">
                                        <span><b>Time</b></span>
                                    </div>
                                    <div class="slds-col slds-size_9-of-12" style="padding-top:10px;">
                                        <span><label id="timeSlotBusyCreate">Mon, 18 March 2019 at 10:00 AM</label></span>
                                    </div>
                                    <div class="slds-col slds-size_3-of-12" style="padding-left:20px;padding-top:5px;">
                                        <span><b id="staffResourceBusyCreate">Staff</b></span>
                                    </div>
                                    <div class="slds-col slds-size_9-of-12" style="padding-top:5px;">
                                        <span><label id="staffBusyCreate"></label></span>
                                    </div>
                                    <div class="slds-col slds-size_3-of-12" style="padding-left:20px;padding-top:10px;">
                                        <span><b>Duration</b></span>
                                    </div>
                                    
                                    <div class="slds-col slds-size_9-of-12" style="padding-top:5px;">
                                        <span>
                                            <select class="slds-select" id="durationSelectBusyCreate" style="width: auto;">
                                                
                                            </select>
                                        </span>
                                    </div>
                                    
                                    <div class="slds-col slds-size_3-of-12" style="padding-left:20px;padding-top:10px;">
                                        <span><b>Category</b></span>
                                    </div>
                                    <div class="slds-col slds-size_9-of-12" style="padding-top:5px;">
                                        <span>
                                            <select class="slds-select" id="categorySelectBusyCreate" style="width: auto;">
                                                
                                            </select>
                                        </span>
                                        <p id="categorySelectBusyCreateError" style="color:red;"></p>
                                    </div>
                                     <div class="slds-col slds-size_3-of-12" style="padding-left:20px;padding-top:10px;">
                                        <span><b>Description</b></span>
                                    </div>
                                    <div class="slds-col slds-size_9-of-12" style="padding-top:5px;">
                                        <textarea type="text" id="descriptionBusyCreate" placeholder="Enter Description" class="slds-textarea" />
                                        <p id="descriptionErrorBusyCreate" style="color:red;"></p>
                                    </div>
                                </div>
                                
                                <div class="slds-grid slds-gutters">
                                    <div class="slds-col slds-size_1-of-1" style="padding-top:10px;">
                                        <div class="slds-form__row" style="padding-left:20px;padding-top:5px;">
                                            <div class="slds-form__item" role="listitem" style="padding-left: 5px;">
                                                <div class="slds-form-element slds-form-element_horizontal slds-is-editing">
                                                   <table class="slds-table slds-no-row-hover recurrence ">
                                                        <tr>
                                                            <th>Repeat</th>
                                                            <td>
                                                                <select class="slds-select" id="repeatSelectBusy" onchange="repeatSelectFunc($(this).val());return false;">
                                                                    <option value="">None</option>
                                                                    <option value="Weeks">Weekly</option>
                                                                </select>
                                                            </td>
                                                        </tr>
                                                        <tr class="repeatSelection slds-hide">
                                                            <th>Repeat Every</th>
                                                            <td>
                                                                <select class="slds-select" id="repeatWeekBusy">
                                                                    
                                                                </select>
                                                                <span id="repeatValue">Week</span>
                                                            </td>
                                                        </tr>
                                                        <tr class="repeatSelection slds-hide">
                                                            <th>Ends</th>
                                                            <td>
                                                                <p>
                                                                    <span>
                                                                        <input name="radio" type="radio" id="afterRadioBusy" checked="true"/>
                                                                    </span>&nbsp;&nbsp; After
                                                                    <select class="slds-select" id="recurrenceOccureBusy">
                                                                        
                                                                    </select>&nbsp;&nbsp;
                                                                    <span>occurrencess</span>
                                                                </p>
                                                                <p class="slds-m-top_xxx-small">
                                                                    <span>
                                                                        <input name="radio" type="radio" id="onRadioBusy"/>
                                                                    </span>&nbsp;&nbsp; on 
                                                                    <input class="slds-input" type="text" placeholder="Pick a Date" label="Date Picker Label" id="onSelectedDateBusy"/>
                                                                </p>
                                                                
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </div>
                                            </div>
                                            <div class="slds-form__item" role="listitem"> 
                                                
                                            </div>
                                        </div>
                            
                                    </div>
                                </div>
                            </div>
                             <footer class="slds-modal__footer">
                                <div class="slds-button-group" role="group" style="display: block;">
                                    <button class="slds-button slds-button_icon slds-button_icon-border-filled button-shadow" title="Cancel" aria-pressed="false" id="cancelBusyBookingCreate" onclick="$('#busyBookingCreateModal').addClass('slds-hide'); return false;">Cancel
                                        <svg class="slds-button__icon" aria-hidden="true">
                                          <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#close')}" />
                                        </svg>
                                        <span class="slds-assistive-text">Cancel</span>
                                  </button>
                                  <button class="slds-button slds-button_icon slds-button_icon-border-filled button-shadow" title="Save" aria-pressed="false" id="saveBusyBookingCreate" onclick="saveBusyBookingFunc();return false;">Save
                                        <svg class="slds-button__icon" aria-hidden="true">
                                          <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#save')}" />
                                        </svg>
                                        <span class="slds-assistive-text">Save</span>
                                  </button>
                                </div>
                                
                            </footer> 
                        </div> 
                    </section>
                    <div class="slds-backdrop slds-backdrop_open"></div>
                </div>
                <!--Downgrade Subscriptions-->
                <div class="slds-hide" id="downgradePopup">
                    <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open slds-modal_medium">
                        <div class="slds-modal__container" style="width: 30%;">
                            <header class="slds-modal__header" style="background: #303a42; color: white;">
                                <h2 id="downgradePopupHeader" class="slds-text-heading_medium slds-hyphenate"><b>Downgrade Subscription</b></h2>
                                <a href="javascript:void(0);" class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick="$('#downgradePopup').addClass('slds-hide'); return false;">
                                    <svg class="slds-button__icon slds-button__icon_large" aria-hidden="true">
                                        <use xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#close')}"></use>
                                    </svg>
                                    <span class="slds-assistive-text">Close</span>
                                </a>
                            </header>
                            <div class="slds-modal__content slds-p-around_medium" id="downgradeSubscriptionPopupBody">
                                <div class="slds-grid slds-wrap">
                                    <div class="slds-col slds-size_6-of-12">
                                        <span class="slds-form-element__label slds-text-align_right"><b>Current Package: </b></span>
                                        <span id="currentPackageNameDowngrade"></span>
                                     </div>
                                     <div class="slds-col slds-size_6-of-12">
                                        <span class="slds-form-element__label slds-text-align_right"><b>Requested Package: </b></span>
                                        <span>
                                            <select class="slds-select" id="selectRequestedPackageDowngrade" style="width: 177px;" onchange="availTimeSlots('downgrade');return false;">
                                            </select>
                                        </span>
                                        <label style="color:red;padding-left: 122px;" id="downgradePackageSelectError"></label>
                                      </div>
                                      <div class="slds-col slds-size_6-of-12">
                                          <div class="slds-grid slds-gutters">
                                              <div class="slds-col slds-size_4-of-12" style="padding-right: 0px;">
                                                <span class="slds-form-element__label slds-text-align_right"><b>Effective Date: </b></span>
                                              </div>
                                              <div class="slds-col slds-size_8-of-12" style="margin-left: -15px;">
                                                <span><!--<input class="slds-input" type="text" placeholder="Pick a Date" label="Date Picker Label" id="effectiveDateInputDowngrade" onchange="availTimeSlots('downgrade');return false;"/>-->
                                                    <select class="slds-select" id="effectiveDateInputDowngrade" style="width: 177px;" onchange="availTimeSlots('downgrade');return false;">
                                                    </select>
                                                </span>
                                                <label style="color:red;padding-left: 3px;" id="effectiveDateErrorDowngrade"></label>
                                              </div>
                                        </div>
                                     </div>
                                     <div class="slds-col slds-size_6-of-12">
                                         <div class="slds-grid slds-gutters">
                                              <div class="slds-col slds-size_4-of-12" style="padding-right: 0px;">
                                                <span class="slds-form-element__label slds-text-align_right"><b>Available Slots: </b></span>
                                              </div>
                                              <div class="slds-col slds-size_8-of-12">
                                                <select class="slds-select" disabled="disabled" id="availableTimeSlotsDowngrade" style="width: auto;"><option>Select Time Slot</option></select><br/>
                                                <label id="availableTimeSlotsDowngradeError" style="color:red;padding-left: 3px;"></label>
                                              </div>
                                        </div>
                                     </div>
                                     <!--Row 3 
                                      <div class="slds-col slds-size_6-of-12 slds-p-bottom_x-small">
                                        <span class="slds-form-element__label slds-text-align_right"><b>Notice Period Start: </b></span>
                                        <span id="noticePeriodDowngradeStart"></span>
                                     </div>
                                     <div class="slds-col slds-size_6-of-12 slds-p-bottom_x-small">
                                        <span class="slds-form-element__label slds-text-align_right"><b>Notice Period End: </b></span>
                                        <span id="noticePeriodDowngradeEnd"></span>
                                     </div>-->
                                     <div class="slds-col slds-size_4-of-12">
                                         <!--<button class="slds-button button-shadow" title="Summary Request" onclick="upgradeSummary('downgrade');return false;" aria-pressed="false">Summary
                                             <svg class="slds-button__icon" aria-hidden="true">
                                                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#summary')}" />
                                             </svg>
                                             <span class="slds-assistive-text">Summary</span>
                                         </button>-->
                                     </div>
                                     <div class="slds-col slds-size_4-of-12">
                                         <button class="slds-button button-shadow"  title="Next" aria-pressed="false" id="submitDowngradeRequest" onclick="showUpgradeDowngradeSummary('downgrade');return false;">Next
                                             <svg class="slds-button__icon" aria-hidden="true">
                                                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#check')}" />
                                             </svg>
                                             <span class="slds-assistive-text">Next</span>
                                         </button>
                                         
                                     </div>
                                     <div class="slds-col slds-size_4-of-12">
                                         <button class="slds-button button-shadow" title="Cancel" aria-pressed="false" onclick="$('#downgradePopup').addClass('slds-hide');return false;">Cancel
                                             <svg class="slds-button__icon" aria-hidden="true">
                                                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#close')}" />
                                             </svg>
                                             <span class="slds-assistive-text">Cancel</span>
                                         </button>
                                     </div>
                                     </div>
                                  </div>
                                  
                            </div>
                    </section>
                    <div class="slds-backdrop slds-backdrop_open"></div>
                </div>
                 <!--Busy Bookings View-->
                <div class="slds-hide" id="busyBookingViewModal">
                    <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
                        <div class="slds-modal__container" style="width: 50%;">
                            <header class="slds-modal__header" style="background: #303a42; color: white;">
                                <h2 id="busyBookingViewModalHeader" class="slds-text-heading_medium slds-hyphenate">Busy Booking</h2>
                                <a href="javascript:void(0);" class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick="$('#busyBookingViewModal').addClass('slds-hide'); return false;">
                                    <svg class="slds-button__icon slds-button__icon_large" aria-hidden="true">
                                        <use xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#close')}"></use>
                                    </svg>
                                    <span class="slds-assistive-text">Close</span>
                                </a>
                            </header>
                            <div class="slds-modal__content slds-p-around_medium" id="busyBookingViewModalBody">
                                <div class="slds-grid slds-wrap">
                                    <div class="slds-col slds-size_3-of-12" style="padding-left:20px;padding-top:10px;">
                                        <span><b>Location</b></span>
                                    </div>
                                    <div class="slds-col slds-size_9-of-12" style="padding-top:10px;">
                                        <span><label id="centerNameBusyView"></label></span>
                                    </div>
                                     <div class="slds-col slds-size_3-of-12" style="padding-left:20px;padding-top:10px;">
                                        <span><b>Time</b></span>
                                    </div>
                                    <div class="slds-col slds-size_9-of-12" style="padding-top:10px;">
                                        <span><label id="timeSlotBusyView"></label></span>
                                    </div>
                                    <div class="slds-col slds-size_3-of-12" style="padding-left:20px;padding-top:10px;">
                                        <span><b>Duration</b></span>
                                    </div>
                                    <div class="slds-col slds-size_9-of-12" style="padding-top:5px;">
                                        <span>
                                            <label id="durationBusyView"></label>
                                        </span>
                                    </div>
                                    <div class="slds-col slds-size_3-of-12" style="padding-left:20px;padding-top:5px;">
                                        <span><b id="staffResourceBusyView">Staff</b></span>
                                    </div>
                                    <div class="slds-col slds-size_9-of-12" style="padding-top:5px;">
                                        <span><label id="staffBusyView"></label></span>
                                    </div>
                                    <div class="slds-col slds-size_3-of-12" style="padding-left:20px;padding-top:10px;">
                                        <span><b>Category</b></span>
                                    </div>
                                    <div class="slds-col slds-size_9-of-12" style="padding-top:10px;">
                                        <span><label id="categoryBusyView"></label></span>
                                    </div>
                                     <div class="slds-col slds-size_3-of-12" style="padding-left:20px;padding-top:10px;">
                                        <span><b>Description</b></span>
                                    </div>
                                    
                                    <div class="slds-col slds-size_9-of-12" style="padding-top:5px;">
                                        <textarea type="text" id="descriptionBusyView" placeholder="Busy Time Description" class="slds-textarea" readonly="true" style="cursor: default;"/>
                                    </div>
                                </div>
                            </div>
                             <footer class="slds-modal__footer">
                                <div class="slds-grid slds-gutters">
                                      <div class="slds-col slds-size_12-of-12" id="button_Group_reschedule" style="padding-left:0px;padding-right:0px;">
                                        <div class="slds-button-group" role="group" >
                                          <button class="slds-button slds-button_icon slds-button_icon-border-filled button-shadow addNewBookingFromBusy" aria-pressed="false" id="addNewBooking" onclick="newAppointmentPopup($(this).attr('data-centerid'), $(this).attr('data-teacherid'), $(this).attr('data-date'));return false;">Add Appointment
                                            <svg class="slds-button__icon" aria-hidden="true">
                                              <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#event')}" />
                                            </svg>
                                            <span class="slds-assistive-text">Add Appointment</span>
                                          </button>
                                          
                                            <button class="slds-button slds-button_icon slds-button_icon-border-filled button-shadow editBooking" title="Reschedule" aria-pressed="false" id="rescheduleBusyBookingView" onclick="$('#busyBookingViewModal').addClass('slds-hide'); return false;">Reschedule
                                                <svg class="slds-button__icon" aria-hidden="true">
                                                  <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#edit')}" />
                                                </svg>
                                                <span class="slds-assistive-text">Reschedule</span>
                                          </button>
                                           <button class="slds-button slds-button_icon slds-button_icon-border-filled button-shadow" title="Cancel" aria-pressed="false" id="cancelBusyBookingView" onclick="cancelBusyAppointment();return false;">Cancel
                                        <svg class="slds-button__icon" aria-hidden="true">
                                          <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#close')}" />
                                        </svg>
                                        <span class="slds-assistive-text">Cancel</span>
                                  </button>
                                        </div>
                                    </div>
                                      
                                </div>
                                
                            </footer> 
                        </div> 
                    </section>
                    <div class="slds-backdrop slds-backdrop_open"></div>
                </div>
                <!--Enrolment Process Modal-->      
                <div class="slds-hide" id="enrolProcessModal">      
                    <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open slds-modal_medium">     
                        <div class="slds-modal__container" style="width: 30%;">     
                            <header class="slds-modal__header" style="background: #303a42; color: white;">      
                                <h2 id="        
                                Header" class="slds-text-heading_medium slds-hyphenate">New Enrolment</h2>      
                                <a href="javascript:void(0);" class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick="$('#enrolProcessModal').addClass('slds-hide'); return false;">     
                                    <svg class="slds-button__icon slds-button__icon_large" aria-hidden="true">      
                                        <use xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#close')}"></use>        
                                    </svg>      
                                    <span class="slds-assistive-text">Close</span>      
                                </a>        
                            </header>       
                            <div class="slds-modal__content slds-p-around_medium" id="enrolProcessModalBody">       
                                <div class="slds-col  slds-size_1-of-1 slds-grid slds-wrap">        
                                        
                                    <div class="slds-form-element slds-size_1-of-1 slds-medium-size_6-of-12 slds-p-horizontal_medium">      
                                        <div class="slds-form-element">     
                                            <label class="slds-form-element__label f-title">Center/Location <abbr class="slds-required" title="required">* </abbr></label>      
                                            <div class="slds-form-element__control">        
                                                <div class="slds-select_container">     
                                                    <select class="slds-select" id="enrollNowCenterSelect" onchange="getAllTeachersAccordingToCenter('', $(this).val());return false;">     
                                                    </select>       
                                                </div>      
                                                <div class="slds-form-element__help slds-hide errortxt" id="centerEnrolError">This field is required</div>      
                                            </div>      
                                        </div>      
                                    </div>      
                                    <div class="slds-form-element slds-size_1-of-1 slds-medium-size_6-of-12 slds-p-horizontal_medium">      
                                       <div class="slds-form-element">      
                                            <label class="slds-form-element__label f-title">Teacher <abbr class="slds-required" title="required">* </abbr></label>      
                                            <div class="slds-form-element__control">        
                                                <div class="slds-select_container">     
                                                    <select class="slds-select" id="enrollNowTeacherSelect" onchange="getAllPlansAccordingToTeachers('', $('#enrollNowCenterSelect').val(), $(this).val());return false;">      
                                                    </select>       
                                                </div>      
                                                <div class="slds-form-element__help slds-hide errortxt" id="teacherEnrolError">This field is required</div>     
                                            </div>      
                                        </div>      
                                    </div>      
                                    <div class="slds-form-element slds-size_1-of-1 slds-medium-size_6-of-12 slds-p-horizontal_medium">      
                                        <div class="slds-form-element">     
                                            <label class="slds-form-element__label f-title">Lesson Plan <abbr class="slds-required" title="required">* </abbr></label>      
                                            <div class="slds-form-element__control">        
                                                <div class="slds-select_container">     
                                                   <select class="slds-select" id="enrollNowLessonSelect">      
                                                    </select>       
                                                </div>      
                                                <div class="slds-form-element__help slds-hide errortxt" id="planEnrolError">This field is required</div>        
                                            </div>      
                                        </div>      
                                    </div>          
                                            
                                </div>      
                                <div class="custom-calendar slds-col slds-size_1-of-1 slds-grid slds-wrap">     
                                    <label class="slds-form-element__label slds-size_1-of-1 field-title slds-p-horizontal_medium" for="form-element-help-01">Time Available</label>     
                                    <div class="slds-form-element slds-dropdown-trigger slds-dropdown-trigger_click slds-is-open  slds-size_1-of-1 slds-medium-size_6-of-12 slds-p-horizontal_medium" id="enrollDatePickerSection">     
                                        <div id="datepicker" class=""></div>        
                                    </div>      
                                            
                                        
                                        <div class="slds-grid slds-wrap slds-p-horizontal_medium  slds-size_1-of-1 slds-medium-size_6-of-12">       
                                             <apex:outputPanel id="refreshSlotPanel" style="width:100%;">       
                                            <div class="calc slds-grid slds-wrap date-list">        
                                                <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12">        
                                                    <fieldset class="slds-form-element">        
                                                      <label class="slds-form-element__label field-title time-title" for="form-element-help-01">Morning</label>     
                                                      <div class="slds-form-element__control">      
                                                        <div class="time-list morning">     
                                                             <!--All Morning Slots-->       
                                                        </div>      
                                                      </div>        
                                                    </fieldset>     
                                                </div>      
                                                <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12">        
                                                    <fieldset class="slds-form-element">        
                                                            
                                                      <div class="slds-form-element__control">      
                                                        <label class="slds-form-element__label field-title time-title" for="form-element-help-01">Afternoon</label>     
                                                        <div class="time-list afternoon">       
                                                             <!--All Afternoon Slots-->     
                                                        </div>      
                                                      </div>        
                                                    </fieldset>     
                                                </div>      
                                                        
                                            </div>      
                                            <div class="slds-form-element__help slds-hide errortxt" id="slotEnrolError">This field is required</div>        
                                         </apex:outputPanel>        
                                     </div>     
                                 </div>         
                           </div>       
                           <footer class="slds-modal__footer">      
                            <button class="slds-button slds-button_neutral" onclick="$('#enrolProcessModal').addClass('slds-hide');">Cancel</button>        
                            <button class="slds-button slds-button_brand" onclick="sendEnrolToIpad();return false;">Send to IPAD</button>       
                          </footer>     
                        </div>      
                    </section>      
                    <div class="slds-backdrop slds-backdrop_open"></div>        
                </div>
                <div class="slds-hide" id="withdrawEnrolSummaryModal">
                    
                    <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open slds-modal_large">
                        <div class="slds-modal__container" style="width: 50%;">
                            <header class="slds-modal__header" style="background: #303a42; color: white;">
                                <h2 id="withdrawEnrolSummaryModalHeader" class="slds-text-heading_medium slds-hyphenate">Withdrawal Summary</h2>
                                <a href="javascript:void(0);" class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick="$('#withdrawEnrolSummaryModal').addClass('slds-hide'); return false;">     
                                    <svg class="slds-button__icon slds-button__icon_large" aria-hidden="true">      
                                        <use xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#close')}"></use>        
                                    </svg>      
                                    <span class="slds-assistive-text">Close</span>      
                                </a>
                            </header>
                            <div class="slds-modal__content slds-p-around_medium" id="withdrawEnrolSummaryModalBody">
                                <div class="slds-form-element">
                                  <div style="font-size: 1.2em;">Enrolment Details</div>
                                  <div class="slds-form__row">
                                    <div class="slds-form__item" role="listitem">
                                      <div class="slds-form-element slds-form-element_stacked slds-is-editing">
                                        <label class="slds-form-element__label" for="stacked-form-element-id-01">Student Name</label>
                                        <div class="slds-form-element__control">
                                          <label id="withdrawSummaryStudentName"></label>
                                        </div>
                                      </div>
                                    </div>
                                     <div class="slds-form__item" role="listitem">
                                      <div class="slds-form-element slds-form-element_stacked slds-is-editing">
                                        <label class="slds-form-element__label" for="stacked-form-element-id-01">Package</label>
                                        <div class="slds-form-element__control">
                                          <label id="withdrawSummaryPackage"></label>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                  <div class="slds-form__row">
                                    <div class="slds-form__item" role="listitem">
                                      <div class="slds-form-element slds-form-element_stacked slds-is-editing">
                                        <label class="slds-form-element__label" for="stacked-form-element-id-01">Centre</label>
                                        <div class="slds-form-element__control">
                                          <label id="withdrawSummaryCentre"></label>
                                        </div>
                                      </div>
                                    </div>
                                     <div class="slds-form__item" role="listitem">
                                      <div class="slds-form-element slds-form-element_stacked slds-is-editing">
                                        <label class="slds-form-element__label" for="stacked-form-element-id-01">Lesson Day &amp; Time</label>
                                        <div class="slds-form-element__control">
                                          <label id="withdrawSummaryLessonDay"></label>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                                <hr style="margin: 0px;"/>
                                <div class="slds-form-element" style="margin-top: 15px;">
                                  <div style="font-size: 1.2em;">Withdrawal Summary</div>
                                  <div class="slds-form__row">
                                    <div class="slds-form__item" role="listitem">
                                      <div class="slds-form-element slds-form-element_stacked slds-is-editing">
                                        <label class="slds-form-element__label" for="stacked-form-element-id-01">Notice Date</label>
                                        <div class="slds-form-element__control">
                                          <label id="withdrawSummaryNoticeDate"></label>
                                        </div>
                                      </div>
                                    </div>
                                     <div class="slds-form__item" role="listitem">
                                      <div class="slds-form-element slds-form-element_stacked slds-is-editing">
                                        <label class="slds-form-element__label" for="stacked-form-element-id-01">Final Lesson Date</label>
                                        <div class="slds-form-element__control">
                                          <label id="withdrawSummaryFinalDate"></label>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                                <hr style="margin: 0px;"/>
                                <div class="slds-form-element" style="margin-top: 15px;">
                                  <div style="font-size: 1.2em;">Final 4 Lessons</div>
                                  <div>
                                      <table id="finalLessonsTbl" class="slds-table slds-table_cell-buffer slds-table_bordered">
                                          <thead>
                                            <tr class="slds-line-height_reset">
                                              <th class="" scope="col">
                                                <div class="slds-truncate" title="Lesson">Lesson</div>
                                              </th>
                                              <th class="" scope="col">
                                                <div class="slds-truncate" title="Date">Date</div>
                                              </th>
                                              <th class="" scope="col">
                                                <div class="slds-truncate" title="Time">Time</div>
                                              </th>
                                              <th class="" scope="col">
                                                <div class="slds-truncate" title="Duration">Duration</div>
                                              </th>
                                              <th class="" scope="col">
                                                <div class="slds-truncate" title="Status">Status</div>
                                              </th>
                                            </tr>
                                          </thead>
                                          <tbody id="finalLessonsTblBody">
                                            
                                          </tbody>
                                    </table> 
                                  </div>
                                </div>
                                <hr style="margin: 0px;"/>
                              <div class="slds-form-element" id="makeupSectionSummary" style="margin-top: 15px;">
                                  <div style="font-size: 1.2em;">Make-Up Lessons</div>
                                  <div>
                                      <table id="makeupLessonsTbl" class="slds-table slds-table_cell-buffer slds-table_bordered">
                                          <thead>
                                            <tr class="slds-line-height_reset">
                                              <th class="" scope="col">
                                                <div class="slds-truncate" title="Student">Student</div>
                                              </th>
                                              <th class="" scope="col">
                                                <div class="slds-truncate" title="Booking Date">Booking Date</div>
                                              </th>
                                              
                                              <th class="" scope="col">
                                                <div class="slds-truncate" title="Duration">Duration</div>
                                              </th>
                                              <th class="" scope="col">
                                                <div class="slds-truncate" title="Expiry Date">Expiry Date</div>
                                              </th>
                                              <th class="" scope="col">
                                                <div class="slds-truncate" title="New Expiry Date">New Expiry Date</div>
                                              </th>
                                            </tr>
                                          </thead>
                                          <tbody id="makeupLessonsTblBody">
                                            
                                          </tbody>
                                    </table> 
                                  </div>
                                </div>
                                <hr style="margin: 0px;"/>
                                
                                <div class="slds-form-element" style="margin-top: 15px;">
                                  <div style="font-size: 1.2em;">Deposit Balance (Final Month)</div>
                                  <div>
                                      <table id="depositBalanceTbl" class="slds-table slds-table_cell-buffer slds-table_bordered">
                                          <thead>
                                            <tr class="slds-line-height_reset">
                                              <th class="" scope="col">
                                                <div class="slds-truncate" title="Package Name">Package Name</div>
                                              </th>
                                              <th class="" scope="col">
                                                <div class="slds-truncate" title="Student">Student</div>
                                              </th>
                                              <th class="" scope="col">
                                                <div class="slds-truncate" title="Qty">Qty</div>
                                              </th>
                                              <th class="" scope="col">
                                                <div class="slds-truncate" title="Rate">Rate</div>
                                              </th>
                                              <th class="" scope="col">
                                                <div class="slds-truncate" title="Total">Total</div>
                                              </th>
                                            </tr>
                                          </thead>
                                          <tbody id="depositBalanceTblBody">
                                            
                                          </tbody>
                                    </table> 
                                  </div>
                                  <div style="font-size: 1.0em;padding: 5px;">Note: 
                                    Your final invoice will be generated on the 1st of your final lesson month. 
                                    The deposit will be applied, and if a balance is applicable, a refund will be processed thereafter.
                                    In the event you have multiple students or multiple enrolments, and refund balance presented in the 
                                    summary will be applied as a payment towards your next invoice.
                                 </div>
                                </div>
                                <hr style="margin: 0px;"/>
                                <div class="slds-form-element slds-align_absolute-center" style="margin-top: 15px;">
                                  <button class="slds-button slds-button_brand" id="confirmWithdrawal" onclick="submitCancelPackageRequest();return false;">CONFIRM WITHDRAWAL</button>
                                </div>
                              </div>
                              
                        </div>
                    </section>
                    <div class="slds-backdrop slds-backdrop_open"></div>
                </div>
                
                <!--Upgrade Downgrade Summary Popup-->
                 <div class="slds-hide" id="upgradeDowngradeSummaryModal">
                    
                    <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open slds-modal_large">
                        <div class="slds-modal__container" style="width: 35%;">
                            <header class="slds-modal__header" style="background: #303a42; color: white;">
                                <h2 id="upgradeDowngradeSummaryHeader" class="slds-text-heading_medium slds-hyphenate"></h2>
                                <a href="javascript:void(0);" class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick="$('#upgradeDowngradeSummaryModal').addClass('slds-hide'); return false;">     
                                    <svg class="slds-button__icon slds-button__icon_large" aria-hidden="true">      
                                        <use xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#close')}"></use>        
                                    </svg>      
                                    <span class="slds-assistive-text">Close</span>      
                                </a>
                            </header>
                            <div class="slds-modal__content slds-p-around_medium" id="upgradeDowngradeSummaryBody">
                                <!--<div class="slds-align_absolute-center">
                                    <apex:image url="{!$Resource.Aureus_logo}" width="150"/>
                                </div>-->
                                <div class="slds-form" role="list">
                                    <div class="slds-form__row">
                                        <!--Previous Package Name-->
                                        <div class="slds-form__item" role="listitem">
                                          <div class="slds-form-element slds-form-element_edit slds-form-element_readonly slds-form-element_stacked slds-hint-parent">
                                            <span class="slds-form-element__label">Previous Package:</span>
                                            <div class="slds-form-element__control" id="oldPackageNameSummary">
                                                  
                                            </div>
                                          </div>
                                        </div>
                                        <!--Current Package Name-->
                                        <div class="slds-form__item" role="listitem">
                                          <div class="slds-form-element slds-form-element_edit slds-form-element_readonly slds-form-element_stacked slds-hint-parent">
                                            <span class="slds-form-element__label">New Package:</span>
                                            <div class="slds-form-element__control" id="newPackageNameSummary">
                                                  
                                            </div>
                                          </div>
                                        </div>
                                    </div>
                                    <div class="slds-form__row">
                                        <!--Previous Lesson Day & Time-->
                                        <div class="slds-form__item" role="listitem">
                                          <div class="slds-form-element slds-form-element_edit slds-form-element_readonly slds-form-element_stacked slds-hint-parent">
                                            <span class="slds-form-element__label">Previous Lesson Day &amp; Time:</span>
                                            <div class="slds-form-element__control" id="previousLessonDTSummary">
                                                  
                                            </div>
                                          </div>
                                        </div>
                                        <!--New Lesson Day & Time-->
                                        <div class="slds-form__item" role="listitem">
                                          <div class="slds-form-element slds-form-element_edit slds-form-element_readonly slds-form-element_stacked slds-hint-parent">
                                            <span class="slds-form-element__label">New Lesson Day &amp; Time:</span>
                                            <div class="slds-form-element__control" id="newLessonDTSummary">
                                                  
                                            </div>
                                          </div>
                                        </div>
                                    </div>
                                    <div class="slds-form__row">
                                        <!--Current Deposit on File-->
                                        <div class="slds-form__item" role="listitem">
                                          <div class="slds-form-element slds-form-element_edit slds-form-element_readonly slds-form-element_stacked slds-hint-parent">
                                            <span class="slds-form-element__label">Current Deposit on File:</span>
                                            <div class="slds-form-element__control" id="currentDepositFileSummary">
                                                  
                                            </div>
                                          </div>
                                        </div>
                                        <!--New Package Deposit-->
                                        <div class="slds-form__item" role="listitem">
                                          <div class="slds-form-element slds-form-element_edit slds-form-element_readonly slds-form-element_stacked slds-hint-parent">
                                            <span class="slds-form-element__label">New Package Deposit:</span>
                                            <div class="slds-form-element__control" id="newPackageDepositSummmary">
                                                  
                                            </div>
                                          </div>
                                        </div>
                                    </div>
                                   
                                    <div class="slds-form__row">
                                        <!--Invoice for Current Month-->
                                        <div class="slds-form__item" role="listitem">
                                          <div class="slds-form-element slds-form-element_edit slds-form-element_readonly slds-form-element_stacked slds-hint-parent">
                                            <span class="slds-form-element__label">Invoice for Current Month:</span>
                                            <div class="slds-form-element__control" id="invoiceForCurrentMonthSummary">
                                                 
                                            </div>
                                          </div>
                                        </div>
                                        <!--Invoice Top-Up-->
                                        <div class="slds-form__item invoiceTopupItem slds-hide" role="listitem" id="invoiceTopupItem">
                                          <div class="slds-form-element slds-form-element_edit slds-form-element_readonly slds-form-element_stacked slds-hint-parent">
                                            <span class="slds-form-element__label">Total Invoice Top-Up:</span>
                                            <div class="slds-form-element__control" id="invoiceTopUpSummary">
                                                  
                                            </div>
                                          </div>
                                        </div>
                                        <!--Next Invoice-->
                                        <div class="slds-form__item slds-hide" role="listitem" id="nextInvoiceItem">
                                          <div class="slds-form-element slds-form-element_edit slds-form-element_readonly slds-form-element_stacked slds-hint-parent">
                                            <span class="slds-form-element__label">Next Payment Due for Enrolment:</span>
                                            <div class="slds-form-element__control" id="nextInvoiceItemSummary">
                                                  
                                            </div>
                                          </div>
                                        </div>
                                    </div>
                                     <!--Invoice Topup summary-->
                                    <div class="slds-form__row">
                                        <div class="slds-form__item invoiceTopupItem" role="listitem">
                                          <div class="slds-form-element slds-form-element_edit slds-form-element_readonly slds-form-element_stacked slds-hint-parent">
                                            <span class="slds-form-element__label">Deposit Adjustment:</span>
                                            <div class="slds-form-element__control" id="invoiceDepositTopupSummary">
                                                  
                                            </div>
                                          </div>
                                        </div>
                                        <!--New Package Deposit-->
                                        <div class="slds-form__item invoiceTopupItem" role="listitem">
                                          <div class="slds-form-element slds-form-element_edit slds-form-element_readonly slds-form-element_stacked slds-hint-parent">
                                            <span class="slds-form-element__label">Effective Month's Invoice:</span>
                                            <div class="slds-form-element__control" id="invoiceLessonDepositTopupSummary">
                                                  
                                            </div>
                                          </div>
                                        </div>
                                    </div>
                                    <div class="slds-form__row">
                                        <div class="slds-form__item" role="listitem">
                                          <div class="slds-form-element slds-form-element_edit slds-form-element_readonly slds-form-element_stacked slds-hint-parent">
                                            <span class="slds-form-element__label">Effective Date:</span>
                                            <div class="slds-form-element__control" id="invoiceEffectiveDate">
                                                  
                                            </div>
                                          </div>
                                        </div>
                                        <!--New Package Deposit-->
                                        <div class="slds-form__item invoiceTopupItem" role="listitem">
                                        </div>
                                    </div>
                                    <!--Confirm Enrol Button-->
                                    <div class="slds-form-element" style="margin-top: 15px;margin-left: 55%;">
                                      <button class="slds-button slds-button_neutral" onclick="$('#upgradeDowngradeSummaryModal').addClass('slds-hide'); return false;">BACK</button>
                                      <button class="slds-button slds-button_brand slds-hide" id="confirmUpgradeEnrolment" onclick="submitUpgradePackageRequest();return false;">CONFIRM UPGRADE</button>
                                      <button class="slds-button slds-button_brand slds-hide" id="confirmDowngradeEnrolment" onclick="submitDowngradePackageRequest();return false;">CONFIRM DOWNGRADE</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
               </div>
               
               <!--Update Enrolment Button Click Popup-->
                <div class="slds-hide" id="enrolmentUpdatePopup">
                    <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open slds-modal_medium">
                        <div class="slds-modal__container" style="width:55%;">
                            <header class="slds-modal__header" style="background: #303a42; color: white;">
                                <h2 id="enrolmentUpdatePopupHeader" class="slds-text-heading_medium slds-hyphenate">Update Enrolment</h2>
                                <a href="javascript:void(0);" class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick="$('#enrolmentUpdatePopup').addClass('slds-hide');">
                                    <svg class="slds-button__icon slds-button__icon_large" aria-hidden="true">
                                        <use xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#close')}"></use>
                                    </svg>
                                    <span class="slds-assistive-text">Close</span>
                                </a>
                            </header>
                            <div class="slds-modal__content slds-p-around_medium" id="enrolmentUpdatePopupBody">
                                <div class="slds-col slds-size_1-of-1">
                                    <div class="slds-grid slds-gutters">
                                        <div class="slds-col slds-size_1-of-2">
                                            <span class="slds-form-element__label slds-text-align_right"><b>Current Teacher:</b></span>
                                            <span id="currentTeacherEnrolUpdate"></span>
                                        </div>
                                        <div class="slds-col slds-size_1-of-2">
                                            <span class="slds-form-element__label slds-text-align_right"><b>Current Date And Time:</b></span>
                                            <span id="currentDateTimeEnrolUpdate"></span>
                                        </div>
                                    </div>
                                    <div class="slds-grid slds-gutters margin-top5px" style="margin-top: 20px;">
                                        <div class="slds-col slds-size_1-of-2">
                                            <span class="slds-form-element__label slds-text-align_right"><b>Current package: </b></span>
                                            <span id="currentPackageEnrolUpdate"></span>
                                        </div>
                                        <div class="slds-col slds-size_1-of-2">
                                            <span class="slds-form-element__label slds-text-align_right"><b>Select Teacher: </b></span>
                                            <select class="slds-select" id="selectTeacherEnrolUpdate" style="width:50%;margin-left:10px;" onchange="getPackageByTeacher();availTimeSlots('update');return false;">      
                                            </select><br/>
                                            <label id="teacherSelectErrorMsg" style="color:red;padding-left: 122px;"></label>
                                        </div>
                                    </div>
                                    <div class="slds-grid slds-gutters" style="margin-top: -7px;">
                                        <div class="slds-col slds-size_1-of-2">
                                            <span class="slds-form-element__label slds-text-align_right"><b>Select Package: </b></span>
                                            <select class="slds-select" id="selectPackageEnrolUpdate" style="width: 174px;margin-left: 31px;" disabled="true" onclick="availTimeSlots('update');return false;">      
                                            </select><br/>
                                            <label id="packageSelectErrorMsg" style="color:red;padding-left: 122px;"></label>
                                        </div>
                                        <div class="slds-col slds-size_1-of-2">
                                            
                                        </div>
                                    </div>
                                    <div class="slds-grid slds-gutters">
                                        <div class="slds-col slds-size_1-of-2">
                                            <span class="slds-form-element__label slds-text-align_right"><b>Select Effective Date: </b></span>
                                            <!--<input class="slds-input" id="selectEffectiveDateEnrolUpdate" onchange="availTimeSlots('update');return false;" style="width: 174px;"/>-->
                                            <select class="slds-select" id="selectEffectiveDateEnrolUpdate" style="width:50%" onchange="availTimeSlots('update');return false;">      
                                            </select><br/>
                                            <label id="effectiveDateErrorMsg" style="color:red;padding-left: 122px;"></label>
                                        </div>
                                        <div class="slds-col slds-size_1-of-2">
                                            <span class="slds-form-element__label slds-text-align_right"><b>Select TimeSlot: </b></span>
                                            <select class="slds-select" id="availableTimeSlotsUpdateEnrolment" style="width:50%" disabled="true">      
                                            </select><br/>
                                            <label id="timeSlotErrorMsg" style="color:red;padding-left: 122px;"></label>
                                        </div>
                                    </div>
                                </div>
                              
                            </div>  
                             <footer class="slds-modal__footer">      
                                <button class="slds-button slds-button_neutral" onclick="$('#enrolmentUpdatePopup').addClass('slds-hide');">Cancel</button>        
                                <button class="slds-button slds-button_brand" id="updateEnrolmentonClick" onclick="updateEnrolmentClick();return false;">Update Enrolment</button>       
                              </footer>  
                        </div>
                    </section>
                    <div class="slds-backdrop slds-backdrop_open"></div>
                </div>
                <!--Pre Payment Modal-->
                <div class="slds-hide" id="prePaymentPopup">
                    <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open slds-modal_medium">
                        <div class="slds-modal__container" style="width: 30%;">
                            <header class="slds-modal__header" style="background: #303a42; color: white;">
                                <h2 id="prePaymentPopupHeader" class="slds-text-heading_medium slds-hyphenate"><b>Pre Payment</b></h2>
                                <a href="javascript:void(0);" class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick="$('#prePaymentPopup').addClass('slds-hide'); return false;">
                                    <svg class="slds-button__icon slds-button__icon_large" aria-hidden="true">
                                        <use xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#close')}"></use>
                                    </svg>
                                    <span class="slds-assistive-text">Close</span>
                                </a>
                            </header>
                            <div class="slds-modal__content slds-p-around_medium" id="prePaymentPopupBody">
                                <div class="slds-grid slds-wrap">
                                    
                                     <div class="slds-col slds-size_1-of-12 slds-p-vertical_x-small">
                                     </div>
                                     <div class="slds-col slds-size_6-of-12 slds-p-vertical_x-small">
                                         <span class="slds-form-element__label slds-text-align_right"><b>Pre Payment Package</b></span>
                                         <span>
                                             <select id="prePaymentPackages" size="1" class="slds-select" style="width: 168px;">
                                             </select>  
                                         </span>
                                     </div>
                                     <div class="slds-col slds-size_5-of-12 slds-p-vertical_x-small">
                                         <span class="slds-form-element__label slds-text-align_right"><b>Effective Date</b></span>
                                         <span>
                                             <span id="prePaymentEffectiveDate"></span>
                                             <!--<input class="slds-input" id="lastLessonDate" style="width:130px;" onchange="getLastLessonDateFunc();return false;"/>-->
                                         </span>
                                     </div>
                                    
                                     <div class="slds-col slds-size_4-of-12 slds-p-vertical_x-small">
                                         
                                     </div>
                                     <div class="slds-col slds-size_4-of-12 slds-p-vertical_x-small">
                                             <button class="slds-button button-shadow"  title="Confirm Withdrawal" aria-pressed="false" id="prePaymentBtn" target="_blank" onclick="prePaymentFunc();return false;">Next
                                                 <svg class="slds-button__icon" aria-hidden="true">
                                                    <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#check')}" />
                                                 </svg>
                                                 <span class="slds-assistive-text">Next</span>
                                             </button>
                                       </div>
                                    <div class="slds-col slds-size_4-of-12 slds-p-vertical_x-small">
                                            <button class="slds-button button-shadow" title="Cancel" aria-pressed="false" onclick="$('#prePaymentPopup').addClass('slds-hide');return false;">Cancel
                                                 <svg class="slds-button__icon" aria-hidden="true">
                                                    <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#close')}" />
                                                 </svg>
                                                 <span class="slds-assistive-text">Cancel</span>
                                             </button> 
                                     </div>
                                </div>
                                  
                            </div>
                        </div>
                    </section>
                    <div class="slds-backdrop slds-backdrop_open"></div>
                </div>
        </apex:form>
        <div id="blank" style="display:none"></div>
        <script>
        //Global Variable for Filter
        var filter = {};
        filter.center = '';
        filter.teacher = '';
        filter.resource = '';
        filter.instrument = '';
        
        
        var bookingReschedule = {};
        bookingReschedule.Id = '';
        bookingReschedule.Type = '';
        bookingReschedule.resource = '';
        bookingReschedule.date = '';
        bookingReschedule.Individual = '';
        bookingReschedule.isRecurrence = '';
        bookingReschedule.scheduleType = '';
        
        var eventsOfCalendar = {};
        var createBookingResult = {};
        var isRecursive = true;
        var teacher = '{!teacherName}';
        var center = '{!centerName}';
        var teacherWorkingHours = {};
        var instruments = '';
        var eventId = '';
        var originalTime;
        var today = new Date();
        var dd = today.getDate();
        var mm = today.getMonth() + 1; //January is 0!
        var yyyy = today.getFullYear();
        var isReschedule = false;
        var caseId = '';
        var userDetail = '';
        if(dd < 10){
            dd = '0' + dd;
        }
        var availableSlotsWorking = {};        
        var timeSlotsOfTeacher = new Set();
        $('[id$=teachers]').val('AllRosteredStaff');
        
        filter.center =  $('[id$=centers]').val();
        filter.teacher = $('[id$=teachers]').val();
        teacher= $('[id$=teachers]').val();
        if(mm < 10){
            mm = '0' + mm;
        }
        today = [yyyy + '-' + mm + '-' + dd];
        
        var calView = $('#calendar').fullCalendar('getView').name;
        //alert(calView);
        if ( calView == '' || calView === 'undefined' || calView === 'month' || calView === undefined){
            calView = 'agendaDay';
        }
        
        var bookingData = {};
        //var j$ = jQuery.noConflict();
        //Assigning SLDS Static Resource Path To A Variable To Use It With ALJS Initialization
        var assetsLoc = '';
          
        //ALJS Initialization   
               
        $.aljsInit({
          assetsLocation: assetsLoc, //SLDS Static Resource Path
          scoped: true
        });
           
      
       $( document ).on( 'keydown', function ( e ) {
            if ( e.keyCode === 27 ) { // ESC
               closeContainerMessage();
            }
        });
        
         // 'agendaTwoDay'
        
        $(document).ready(function(){
            /*cometd = $.cometd;      
            cometd.websocketEnabled = false;*/
            caseId = '{!$currentpage.parameters.caseId}';
            getCaseDetails(caseId);
            getUserDetails();
            var profileId = '{!$Profile.Id}';
            
            var currentUser = '{!$User.Id}';        
            var fromIpad = '{!$Label.From_Ipad}';
            
            if(bookingIdToHighlight && (bookingTeacherToHighlight || bookingResourceToHighlight) && bookingCentreToHighlight && bookingDateToHighlight){
            	
            	if(bookingTeacherToHighlight){
                    //filter.center = 
                    filter.teacher = bookingTeacherToHighlight;
                    $('.teachers').val(filter.teacher);
                    initResources(bookingCentreToHighlight, filter.teacher, filter.resource, [bookingDateToHighlight.format('YYYY-MM-DD')], 'agendaDay', filter.instrument);
                }else if(bookingResourceToHighlight){
                    
                    filter.teacher = '';
                    filter.resource = bookingResourceToHighlight;
                    $('[id$=resources]').val(filter.resource);
                	initResources(bookingCentreToHighlight, filter.teacher, filter.resource, [bookingDateToHighlight.format('YYYY-MM-DD')], 'agendaDay', filter.instrument);
                }
            }else{
            	var datesArray = new Array();
                var dt = moment();
                var bookDate = dt.format('YYYY-MM-DD');
                
                datesArray.push(bookDate);
                
                var calendarDates = datesArray;
                initResources(center, teacher, filter.resource, calendarDates , 'agendaDay', filter.instrument);
            }
            
            /*$('#selectEffectiveDateEnrolUpdate').datepicker({
                initDate: moment(), //Today Date
                format: 'YYYY-MM-DD', //Date Format Of Datepicker Input Field
                onChange: function(datepicker) {
                $('#SelectedDate').html('Selected Date: <strong>'+moment(datepicker.selectedFullDate._d).format('YYYY-MM-DD')+'</strong>');
               }
            });*/
            
            $('#onSelectedDate').datepicker({
                initDate: moment(), //Today Date
                format: 'YYYY-MM-DD', //Date Format Of Datepicker Input Field
                onChange: function(datepicker) {
                $('#SelectedDate').html('Selected Date: <strong>'+moment(datepicker.selectedFullDate._d).format('YYYY-MM-DD')+'</strong>');
               }
            });
            
            $('#onSelectedDateBusy').datepicker({
                initDate: moment(), //Today Date
                format: 'YYYY-MM-DD', //Date Format Of Datepicker Input Field
            });
             var today = new Date();
             /*$('#effectiveDateInput').datepicker({
                initDate: moment(), //Today Date
                format: 'YYYY-MM-DD',
                minDate: today, //Date Format Of Datepicker Input Field
                onChange: function(datepicker) {
                $('#effectiveDateInput').html('Selected Date: <strong>'+moment(datepicker.selectedFullDate._d).format('YYYY-MM-DD')+'</strong>');
               }
            });*/
           
            /*$('#lastLessonDate').datepicker({
                initDate: moment(), //Today Date
                format: 'YYYY-MM-DD', //Date Format Of Datepicker Input Field
                onChange: function(datepicker) {
                $('#lastLessonDate').html('Selected Date: <strong>'+moment(datepicker.selectedFullDate._d).format('YYYY-MM-DD')+'</strong>');
               }
            });*/
            var downgradeRequestDate = new Date();
            downgradeRequestDate.setDate(downgradeRequestDate.getDate() + 30 );
             $('#effectiveDateInputDowngrade').datepicker({
                initDate: moment(), //Today Date
                format: 'YYYY-MM-DD', //Date Format Of Datepicker Input Field
                minDate: downgradeRequestDate,
                onChange: function(datepicker) {
                $('#selectRequestedPackageDowngrade').html('Selected Date: <strong>'+moment(datepicker.selectedFullDate._d).format('YYYY-MM-DD')+'</strong>');
               }
            }); 
          
            initChange();
            $('#repeatValue').html($('#repeats').val());
            $('.whenPencilled').hide();
            $('.whenConfirmed').hide();
            $('#autoExpireDateTime').hide();
            $('#confirm').click();
            
            // Tabs
            $('.slds-tabs--default__link,.slds-tabs--scoped__link').click(function(){
                $(this).parent().parent().find('.slds-tabs--default__link,.slds-tabs--scoped__link').attr('aria-selected','false');
                $(this).attr('aria-selected','true');
                $(this).parent().parent().find('.slds-tabs--default__link,.slds-tabs--scoped__link').attr('tabindex','-1');
                $(this).attr('tabindex','0');
                $(this).parent().addClass('slds-active').siblings().removeClass('slds-active');
                $(this).parent().parent().parent().find('.'+$(this).parent().parent().parent().find('.slds-tabs--default__content,.slds-tabs--scoped__content')[0].classList[0]).removeClass('slds-show').addClass('slds-hide');
                $(this).parent().parent().parent().find('#'+$(this).attr('aria-controls')).removeClass('slds-hide').addClass('slds-show');
            });
            // End Tabs
            /*cometd.configure({      
               url: window.location.protocol+'//'+window.location.hostname+ (null != window.location.port ? (':'+window.location.port) : '') +'/cometd/42.0/',      
               requestHeaders: { Authorization: 'OAuth {!$Api.Session_ID}'}     
        });     
        cometd.handshake();     
        $.cometd.subscribe('/event/iPad_Process_Event__e', function(message){       
            if(message){        
                if(message.data.payload.UserId__c == currentUser && message.data.payload.Direction__c == fromIpad && message.data.payload.Process_Type__c == 'Cancel'){     
                    $('#enrolProcessLoader').addClass('slds-hide');     
                }       
            }       
        });*/  
        });
         

        $('#repeats').change(function(){
            $('#repeatValue').html($('#repeats').val());
        });
        
        $('#pencilled').click(function(){
            $('.whenConfirmed').hide();
            $('.whenPencilled').show();
        });
        
        $('#confirm').click(function(){
            $('.whenPencilled').hide();
            $('.whenConfirmed').show();
        });
        
        $("#autoExire").click(function () {
            if ($(this).is(":checked")) {
                $("#autoExpireDateTime").show();
            } else {
                $("#autoExpireDateTime").hide();
            }
        });
        
        function repeatSelectFunc(val){
             $('#recurrenceOccure').empty();
             $('#recurrenceOccureBusy').empty();
             $('#repeatWeek').empty();
             $('#repeatWeekBusy').empty();
            if(val == 'None'){
                $('.repeatSelection').addClass('slds-hide');
            }else{
                var optionRecursion = '';
                for(let i = 1;i <= {!$Label.Recurring_occurrence};i++){
                    optionRecursion += '<option value="'+i+'">'+i+'</option>';
                }
                $('#recurrenceOccure').append(optionRecursion);
                $('#recurrenceOccureBusy').append(optionRecursion);
                optionRecursion = '';
                
                for(let j = 1; j<=1; j++){
                    optionRecursion += '<option value="'+j+'">'+j+'</option>';
                }
                $('#repeatWeek').append(optionRecursion);
                $('#repeatWeekBusy').append(optionRecursion);
                $('.repeatSelection').removeClass('slds-hide');
            }
        }
        
        $('#packageSelect').focusin(function() {
            $('#getPackageId').addClass('slds-is-open');
        });
        
        //Cancel Booking event 
        $('#cancelBooking').click(function(){
            var timeDeff;
            $('.editDetails').addClass('slds-hide');
            var bookingId = $(this).attr("data-id");
            var bookingDateTime = $(this).attr("data-date");
            var bookingType = $(this).attr("data-type");
            if(bookingId && bookingDateTime && bookingType && bookingType != 'Busy'){
                //Commenting this code for temporary basis need to uncomment it later.
                //if(isDateTimeInFuture(bookingDateTime)){
                    timeDeff = isDateBetween24Hours(bookingDateTime);
                    if((timeDeff > 24 || bookingType == 'Trial') && isDateTimeInFuture(bookingDateTime)){
                        Visualforce.remoting.Manager.invokeAction(
                            '{!$RemoteAction.AureusCalendarClone.getPickListValues}',
                            'Booking__c', 'Cancellation_Reason__c', 
                            function(result, event){
                                if(result){
                                    $('#cancelBookingWithReason').attr('data-id', bookingId);
                                    $('#cancelBookingWithReason').attr('data-time', timeDeff);
                                    $('#cancelBookingWithReason').attr('data-type', bookingType);
                                    $('#cancelReason').empty();
                                    var cancelReason = '<option value="">Select Cancellation Reason</option>';
                                    $(result).each(function(index, value){
                                        cancelReason += '<option value="'+value+'">'+value+'</option>'
                                    }); 
                                    $('#cancelReason').append(cancelReason);
                                    $('.cancellationReasonPopup').removeClass('slds-hide');
                                }
                            }, 
                            {escape: true}
                        );
                    }else{
                        $('.cancellationReasonPopup').addClass('slds-hide');
                        $('#cancelBookingWithMakeupBtn').attr({'data-id':bookingId, 'data-reason':'' });
                        $('#no-makeup').attr({'data-id':bookingId, 'data-reason':'' });
                        Visualforce.remoting.Manager.invokeAction(
                            '{!$RemoteAction.AureusCalendarClone.getPickListValues}',
                            'Booking__c', 'Makeup_Reason__c', 
                            function(result, event){
                                if(result){
                                    $('#cancelReason').empty();
                                    
                                    var cancelReason = '<option value="">Select Make Up Credit Reason</option>';
                                    $(result).each(function(index, value){
                                        cancelReason += '<option value="'+value+'">'+value+'</option>'
                                    }); 
                                    $('#cancelReason').append(cancelReason); 
                                    $('.reasonSection').addClass('slds-hide'); 
                                    $('#reasonPopupText').html('Make Up Credit for Booking');
                                    $('.notMakeupHoursShow').addClass('slds-hide');
                                    $('.reasonText').html('Reason For Make up Credit:');
                                    $('#cancelBookingWithReason').addClass('slds-hide');
                                    
                                    $('.makeupTitle').removeClass('slds-hide');
                                    $('.close-popup').addClass('slds-hide');
                                    
                                    $('.cancellationReasonPopup').removeClass('slds-hide');
                                    
                                }
                            }, 
                            {escape: true}
                        );
                    }
                 //Commenting this code for temporary basis need to uncomment it later.
                /*}else{
                    $('#toastMsg').html('Cannot cancel past Bookings');
                    $('.toastclass').removeClass('slds-theme_success');
                    $('.toastclass').addClass('slds-theme_error');
                    
                    toastLaunch();
                }*/
            }else{
                $('#confirmBody').html('Do you want cancel busy appointment?');
                $('#confirmHeader').html('Cancel Booking');
                $('#confirmModalYes').attr('data-id', bookingId);
                $('#confirmModalYes').attr('data-time', timeDeff);
                $('#confirmModalYes').attr('data-type', bookingType);
                $('#confirmModalYes').attr('data-origin','cancel');
                $('#confirmModalNo').removeAttr('data-origin');
                $('.confirmModal').removeClass('slds-hide');
            }
            
        });
        $('.editBooking').click(function(){
            $('.editDetails').addClass('slds-hide');
            $('#containerMessage').removeClass('slds-hide');
            bookingReschedule.Id = $(this).attr('data-id');
            bookingReschedule.Type = $(this).attr('data-type');
            bookingReschedule.Individual = $(this).attr('data-individual');
            if(bookingReschedule.Type == 'Regular'){
                isReschedule = true;
            }
            
        });
        function toJSDate( dateTime ) {
            //2019-02-09T16:15:00
            var dateTime = dateTime.split("T");//dateTime[0] = date, dateTime[1] = time
            
            var date = dateTime[0].split("-");
            var time = dateTime[1].split(":");
           
            return new Date(date[0], (date[1]-1), date[2], time[0], time[1], 0, 0);
            
        }
        function closeContainerMessage(){
            isReschedule = false;
            bookingReschedule.Id = '';
            $('#containerMessage').addClass('slds-hide');
        }
        function isDateTimeInFuture(bookingDateTime){
            var now = new Date();
            var originalDate =  toJSDate(bookingDateTime); //toJSDate(originalTime);
            isDateBetween24Hours(bookingDateTime);
            
            return (Date.parse(now) < Date.parse(originalDate ));
        }
        function isDateBetween24Hours(bookingDateTime){
            var bookingDate = toJSDate(bookingDateTime);
            var now = new Date();
            var timeDiff = Math.abs(bookingDate.getTime() - now.getTime());
            timeDiff = timeDiff/ (1000 * 3600);
            // days difference
            return timeDiff;
        }
        $('#cancelBookingWithReason').click(function(){
            
            var bookingId = $(this).attr("data-id");
            
            var bookingCancelTime = $(this).attr("data-time");
            var cancelReasonValue = $('#cancelReason').val();
            var bookingType = $(this).attr("data-type");
            if(bookingId && bookingCancelTime && bookingType){
                if(bookingCancelTime < 24 && (bookingType == 'Regular' || bookingType == 'Make-up') && cancelReasonValue){
                    $('.cancellationReasonPopup').addClass('slds-hide');
                    $('#cancelBookingWithMakeupBtn').attr({'data-id':bookingId, 'data-reason':cancelReasonValue });
                    $('#no-makeup').attr({'data-id':bookingId, 'data-reason':cancelReasonValue });
                    Visualforce.remoting.Manager.invokeAction(
                        '{!$RemoteAction.AureusCalendarClone.getPickListValues}',
                        'Booking__c', 'Makeup_Reason__c', 
                        function(result, event){
                            if(result){
                                $('#cancelReason').empty();
                                
                                var cancelReason = '<option value="">Select Make Up Credit Reason</option>';
                                $(result).each(function(index, value){
                                    cancelReason += '<option value="'+value+'">'+value+'</option>'
                                });  
                                $('#cancelReason').append(cancelReason); 
                                $('.reasonSection').addClass('slds-hide'); 
                                $('#reasonPopupText').html('Make Up Credit for Booking');
                                $('.notMakeupHoursShow').addClass('slds-hide');
                                $('.reasonText').html('Reason For Make up Credit:');
                                $('#cancelBookingWithReason').addClass('slds-hide');
                                
                                $('.makeupTitle').removeClass('slds-hide');
                                $('.close-popup').addClass('slds-hide');
                                
                                $('.cancellationReasonPopup').removeClass('slds-hide');
                                
                            }
                        }, 
                        {escape: true}
                    );
                }else if(cancelReasonValue){
                    $('.cancellationReasonPopup').addClass('slds-hide');
                    $('.confirmModal').removeClass('slds-hide');
                    $('.confirmModalYes').removeClass('slds-hide');
                    $('#confirmBody').html('Do you want to send an email?');
                    $('#confirmHeader').html('Email Confirmation');
                    $('#confirmModalYes').attr('data-origin','cancel');
                    $('#confirmModalNo').attr('data-origin','cancel');
                    $('#confirmModalYes').attr('data-id', bookingId);
                    $('#confirmModalNo').attr('data-id', bookingId);
                    $('#confirmModalYes').attr('cancelReason', $('#cancelReason').val());
                    $('#confirmModalNo').attr('cancelReason', $('#cancelReason').val());
                    
                }else{
                    $('#errorMsgReason').html('Please select the reason');
                }
                
            }
            
        });
        
        function studentFocusOut(){
            $('#studentSelectContainer').removeClass('slds-is-open');
            $('#studentSelectContainer').attr('aria-expanded', 'false');
            $('#studentSearchList').empty();
        }
        
        $('#cancelBookingWithMakeupBtn').click(function(){
            var bookingId = $(this).attr('data-id');
            var cancelReasonValue = $(this).attr('data-reason');
            var makeupReason = $('#cancelReason').val();
            var makeupCreditRemark = $('#remarkForCancellation').val();
            if(bookingId){ //&& cancelReasonValue
                if(makeupReason && (makeupReason == 'Other' || makeupReason == 'Admin/CM Exception')){
                    if(makeupCreditRemark){
                    
                        $('.cancellationReasonPopup').addClass('slds-hide');
                        $('#confirmModal').removeClass('slds-hide');
                        $('#confirmModalYes').attr('data-origin','cancel');
                        $('#confirmModalNo').attr('data-origin','cancel');
                        $('#confirmModalYes').attr({'data-id': bookingId, 'cancelReason': '', 'makeupReason': makeupReason, 'makeupRemark': makeupCreditRemark, 'redirectCase': 'true'});
                        $('#confirmModalNo').attr({'data-id': bookingId, 'cancelReason': '', 'makeupReason': makeupReason, 'makeupRemark': makeupCreditRemark, 'redirectCase': 'false'});
                        
                    }else{
                        $('#errorMsgRemark').html('Makeup Remark cannot be empty for '+makeupReason);
                    }
                }else if(makeupReason){
                        $('.cancellationReasonPopup').addClass('slds-hide');
                        $('#confirmBody').html('Do you want to send an email?');
                        $('#confirmHeader').html('Email Confirmation');
                        $('#confirmModal').removeClass('slds-hide');
                        $('#confirmModalYes').attr('data-origin','cancel');
                        $('#confirmModalNo').attr('data-origin','cancel');
                        $('#confirmModalYes').attr({'data-id': bookingId, 'cancelReason': '', 'makeupReason': makeupReason, 'redirectCase': 'true'});
                        $('#confirmModalNo').attr({'data-id': bookingId, 'cancelReason': '', 'makeupReason': makeupReason, 'redirectCase': 'false'});
                    
                }else{
                    $('#errorMsgReason').html('Please select the reason');
                }
            }
        });
        
       
        $('#no-makeup').click(function(){
            var bookingId = $(this).attr('data-id');
            
            var cancelReasonValue = $(this).attr('data-reason');
            if(bookingId){ //&& cancelReasonValue
                $('.cancellationReasonPopup').addClass('slds-hide');
                $('#confirmBody').html('Do you want to send an email?');
                $('#confirmHeader').html('Email Confirmation');
                $('#confirmModal').removeClass('slds-hide');
                $('#confirmModalYes').attr('data-origin','cancel');
                $('#confirmModalNo').attr('data-origin','cancel');
                $('#confirmModalYes').attr({'data-id': bookingId, 'cancelReason': cancelReasonValue, 'makeupReason': 'NoMakeUpForToday', 'redirectCase': 'true'});
                $('#confirmModalNo').attr({'data-id': bookingId, 'cancelReason': cancelReasonValue, 'makeupReason': 'NoMakeUpForToday', 'redirectCase': 'false'});
                
            }
        });
        
        function rescheduleTrialBookingfunc(bookingId, dateOfBooking){
            $('#confirmBody').html('Do you want to send an email?');
            $('#confirmHeader').html('Email Confirmation');
            $('#confirmModal').removeClass('slds-hide');
            $('#rescheduleTrialBooking').removeAttr('data-id');
            $('#rescheduleTrialBooking').removeAttr('data-date');
            $('#trialBookingClickModal').addClass('slds-hide');
            if(bookingId && dateOfBooking){
                initEvents(bookingId , dateOfBooking);
            }
        }
        
        $('#yes-makeup').click(function(){
            
            $('.makeupTitle').addClass('slds-hide');
            $('.reasonSection').removeClass('slds-hide');
            $('.makeupCredit').removeClass('slds-hide');
            $('#cancelBookingWithMakeupBtn').removeClass('slds-hide');
        });
        
        $('#confirmModalYes').click(function(){
            var origin = $(this).attr('data-origin');
            var bookingId = $(this).attr('data-bookingid');
            if(origin == 'email'){
                $('.sendEmail').attr('data-bookingId', bookingId);
                $('.confirmModal').addClass('slds-hide');
                $('.sendEmail').removeClass('slds-hide');
                var b = $('#calendar').fullCalendar('getDate');
                var bookDate = [b.format('YYYY-MM-DD')];
                teacher = $(".teachers").val();
                var calView = $('#calendar').fullCalendar('getView').name;
                
                var calendarDates = isWeekDay();
                if(calView == 'agendaTwoDay'){
                    initResources(center, teacher, filter.resource, calendarDates, calView, filter.instrument);
                }else{
                    initResources(center, teacher, filter.resource, bookDate, calView, filter.instrument);
                }
            }else if(origin == 'eventdrop'){
                $('.confirmModal').addClass('slds-hide');
                
                updateBooking($(this).attr('data-bookingid'), $(this).attr('data-starttime'), $(this).attr('data-endtime'), $(this).attr('data-resourceid'), $(this).attr('data-isplaceholder'));
            }else if(origin == 'bookingComplete' || origin == 'bookingNoShow'){
                completedOrNoShow($(this).attr('data-id'), $(this).attr('data-type'), $(this).attr('data-status'));
                
            }else if(origin == 'createBooking'){
                var bookingDataStr = JSON.stringify(bookingData);
            	
                Visualforce.remoting.Manager.invokeAction(
                    '{!$RemoteAction.AureusCalendarClone.createBooking}',
                    bookingDataStr, 'true', caseId,
                    function(result, event){
                        if (event.status) {
                            if(result.caseId){
                                $('.confirmModal').addClass('slds-hide');
                                redirectToCaseRecord(result.caseId);  
                                refreshNewBookingPopup();
                            }else if(result.msg == 'false'){
                                $('#newBookingDetails').addClass('slds-hide');
                                refreshNewBookingPopup();
                                refreshCalendar();
                                $('.confirmModal').addClass('slds-hide');
                                /*$('.confirmModal').removeClass('slds-hide');
                                $('#confirmBody').html('Do you want to send an email?');
                                $('#confirmHeader').html('Email Confirmation');
                                $('#confirmModalYes').attr('data-origin','email');
                                $('#confirmModalNo').attr('data-origin','email');*/
                            }else if(result.msg == 'duration'){
                                $('#saveNewBooking').css('pointer-events','');
                                $('#makeupHoursErrorMsg').text('Insufficient Makup minutes');
                            }else if(result.msg == 'existing'){
                                $('#newBookingDetails').addClass('slds-hide');
                                refreshNewBookingPopup();
                                 $('#toastMsg').html('Cannot create Booking Please Remove Existing Bookings..');
                                 $('.toastclass').removeClass('slds-theme_success');
                                 $('.toastclass').addClass('slds-theme_error');
                                 toastLaunch();
                            }
                        }
                        
                    }
                );
            }else if(origin == 'cancel'){
                bookingId = $('#confirmModalYes').attr('data-id');
                $('.confirmModal').addClass('slds-hide');
                
                /*$('.sendEmail').attr('data-bookingId', bookingId);
                $('.confirmModal').addClass('slds-hide');
                $('.sendEmail').removeClass('slds-hide');
                $('#sendEmailYes').attr({'data-origin': 'cancel', 'bookId': bookingId, 'redirectCase': 'true'});*/
                
                var cancelReason = '';
                if($('#confirmModalYes').attr('cancelReason')){
                    cancelReason  = $('#confirmModalYes').attr('cancelReason');
                }
                
                var makeupReason = '';
                if($('#confirmModalYes').attr('makeupReason')){
                    makeupReason = $('#confirmModalYes').attr('makeupReason');
                }
                var makeupRemark = '';
                if($('#confirmModalYes').attr('makeupRemark')){
                    makeupRemark = $('#confirmModalYes').attr('makeupRemark');
                }
                
                var isfuture = '';
                if($('#confirmModalYes').attr('data-future')){
                    isfuture = $('#confirmModalYes').attr('data-future');
                }
                Visualforce.remoting.Manager.invokeAction(
                '{!$RemoteAction.AureusCalendarClone.cancelBooking}',
                    bookingId, cancelReason, makeupReason, makeupRemark, 'true', caseId, isfuture, 
                    function(result, event){
                        if(result.caseId){
                            $('.confirmModal').addClass('slds-hide');
                            redirectToCaseRecord(result.caseId);
                            refreshCalendar()
                        }else{
                            refreshCalendar();
                        }
                    }, 
                    {escape: true}
                );
            }else if(origin == 'update'){
                bookingId = '';
                let start = '';
                let end = '';
                let teacherId = '';
                let isplaceholder = '';
                let isFuture = '';
                if($('#confirmModalYes').attr('data-id')){
                    bookingId = $('#confirmModalYes').attr('data-id');
                }
                if($('#confirmModalYes').attr('start')){
                    start = $('#confirmModalYes').attr('start');
                }
                if($('#confirmModalYes').attr('end')){
                    end = $('#confirmModalYes').attr('end')
                }
                if($('#confirmModalYes').attr('teacherId')){
                    teacherId = $('#confirmModalYes').attr('teacherId')
                }
                if($('#confirmModalYes').attr('isplaceholder')){
                    isplaceholder = $('#confirmModalYes').attr('isplaceholder')
                }
                if($('#confirmModalYes').attr('isFuture')){
                    isFuture = $('#confirmModalYes').attr('isFuture')
                }
                if(bookingId && start){
                    Visualforce.remoting.Manager.invokeAction(
                        '{!$RemoteAction.AureusCalendarClone.updateBooking}',
                        bookingId, start, end, teacherId, isplaceholder, isFuture, 'true', caseId, 
                        function(result, event){
                            var msg = '';
                            if (event.status) {
                                $('.editDetails').addClass('slds-hide');
                                isReschedule = false;
                                $('#confirmModalNo').html('No');
                                $('#confirmHeader').parent().removeClass('slds-text-align_left');
                                $('#confirmBody').removeClass('slds-text-align_center');
                                $('#confirmModalYes').removeClass('slds-hide');
                                $("#rescheduleClose").trigger("click");
                                if(bookingReschedule.scheduleType == 'commitEmail'){
                                    $('#confirmModalYes').attr('data-origin', 'email');
                                    $('#confirmModalYes').trigger('click');
                                }else if(bookingReschedule.scheduleType == 'commit'){
                                    $('.confirmModal').addClass('slds-hide');
                                    if(result.caseId){
                                        redirectToCaseRecord(result.caseId); 
                                        refreshCalendar()
                                    }else{
                                        refreshCalendar();
                                    }
                                }
                                bookingReschedule.Id = '';
                                bookingReschedule.Type = '';
                                bookingReschedule.resource = '';
                                bookingReschedule.date = '';
                                bookingReschedule.Individual = '';
                                bookingReschedule.isRecurrence = '';
                                bookingReschedule.scheduleType = '';
                                
                                $('#toastMsg').html('Appointment Reschedule successfully');
                                toastLaunch();
                            }
                        },
                        {buffer: false, escape: true}
                    );
                }
               
            }else if(origin == 'withdrawal'){
                    
                bookingId = $('#confirmModalYes').attr('data-id');
                var endDateStr = $('#confirmModalYes').attr('data-endDate');
                var lastLessonDate = $('#confirmModalYes').attr('data-lastLessonDate');
                Visualforce.remoting.Manager.invokeAction(
                '{!$RemoteAction.AureusCalendarClone.cancelSubscriptionRequest}',
                 bookingId, /*endDateStr*/lastLessonDate, lastLessonDate, caseId, 'true',
                    function(result, event){
                        $('#confirmModal').addClass('slds-hide');
                        if(result){
                            if(result == 'error'){
                                $('#toastMsg').html('Request failure!');
                                $('.toastclass').removeClass('slds-theme_success');
                                $('.toastclass').addClass('slds-theme_error');
                                toastLaunch();
                            }else{
                                redirectToCaseRecord(result);
                                refreshCalendar()
                            }
                             
                        }else if(!result){
                            refreshCalendar();
                        }
                        
                    }
                 );
            }else if(origin == 'change'){
                var enrolmentId, newTeacher, newPackage, effectiveDate, newTime,oldTeacher,oldPackage, oldTime, oldPackageName, newPackageName;
                enrolmentId = $('#confirmModalYes').attr('data-enrol');
                newTeacher = $('#confirmModalYes').attr('data-teacher');
                newPackage = $('#confirmModalYes').attr('data-package');
                effectiveDate = $('#confirmModalYes').attr('data-date');
                newTime = $('#confirmModalYes').attr('data-time');
                oldTeacher =  $('#confirmModalYes').attr('data-oldteacher');
                oldPackage = $('#confirmModalYes').attr('data-oldpackage');
                oldTime = $('#confirmModalYes').attr('data-oldTime');
                oldPackageName = $('#confirmModalYes').attr('data-oldPackageName'); 
                newPackageName = $('#confirmModalYes').attr('data-newPackageName'); 
                Visualforce.remoting.Manager.invokeAction(
                '{!$RemoteAction.AureusCalendarClone.updateEnrolment}',
                     enrolmentId, newTeacher, newPackage, effectiveDate, newTime, caseId, 'true', oldTime, oldPackageName, newPackageName, 
                     function(result, event){
                         if(result && result != 'error'){
                              $('.confirmModal').addClass('slds-hide');
                              redirectToCaseRecord(result);
                               refreshCalendar();
                         }else if(!result){
                              $('#enrolmentUpdatePopup').addClass('slds-hide');
                              $('#toastMsg').html('Enrolment Update Successfully');
                              $('.toastclass').removeClass('slds-theme_error');
                              $('.toastclass').addClass('slds-theme_success');
                              toastLaunch();
                              refreshCalendar();
                         }else if(result == 'error'){
                              $('#enrolmentUpdatePopup').addClass('slds-hide');
                              $('#toastMsg').html('Some Error Occurred...');
                              $('.toastclass').removeClass('slds-theme_success');
                              $('.toastclass').addClass('slds-theme_error');
                              toastLaunch();
                              refreshCalendar();
                         }
                     }
                );
            }else if(origin == 'upgrade'){
                
                $('#confirmModalYes').css('pointer-events','none');
                $('#confirmModalYes').attr('disabled');
                $('#confirmModalNo').css('pointer-events','none');
                $('#confirmModalNo').attr('disabled');
                var bookingId, effectiveDate, newPackageId, oldPackageId, timeSlot, casevalues = {};
                bookingId = $('#confirmModalYes').attr('data-id');
                effectiveDate = $('#confirmModalYes').attr('data-date');
                newPackageId = $('#confirmModalYes').attr('data-newPackage');
                oldPackageId = $('#confirmModalYes').attr('data-oldPackage');
                timeSlot = $('#confirmModalYes').attr('data-timeslot');
                
                casevalues.previousPackage = $('#confirmModalYes').attr('data-previousPackage');
                casevalues.newPackage = $('#confirmModalYes').attr('data-newPackageName');
                casevalues.previousLessonDayTime = $('#confirmModalYes').attr('data-previousLessonDayTime');
                casevalues.newLessonDayTime = $('#confirmModalYes').attr('data-newLessonDayTime');
                casevalues.currentDepositonFile = $('#confirmModalYes').attr('data-currentDepositonFile');
                casevalues.newPackageDeposit = $('#confirmModalYes').attr('data-newPackageDeposit');
                casevalues.invoiceForCurrentMonth = $('#confirmModalYes').attr('data-invoiceForCurrentMonth');
                
                Visualforce.remoting.Manager.invokeAction(
                '{!$RemoteAction.AureusCalendarClone.updatePackageOfCustomer}',
                    bookingId, effectiveDate, newPackageId, oldPackageId, timeSlot, caseId, 'true', casevalues, 
                    function(result, event){
                        
                        $('#confirmModalYes').css('pointer-events','auto');
                        $('#confirmModalYes').removeAttr('disabled');
                        $('#confirmModalNo').css('pointer-events','auto');
                        $('#confirmModalNo').removeAttr('disabled');
                        if(result){                       
                            $('#confirmModal').addClass('slds-hide');
                                redirectToCaseRecord(result);  
                        }else{
                            $('#upgradeDowngradeSummaryModal').addClass('slds-hide');
                             $('#toastMsg').html('Request failure!<br/>Please try again....');
                             $('.toastclass').removeClass('slds-theme_success');
                             $('.toastclass').addClass('slds-theme_error');
                             toastLaunch();
                        }
                        refreshCalendar();
                    }
                );
            }else if(origin == 'downgrade'){
                var bookingId, requestDate, newPackageId, oldPackageId, timeslot, amount, depositAmount, lessonFeeAmount, casevalues = {};
                bookingId = $('#confirmModalYes').attr('data-id');
                requestDate = $('#confirmModalYes').attr('data-date');
                newPackageId = $('#confirmModalYes').attr('data-newPackage');
                oldPackageId = $('#confirmModalYes').attr('data-oldPackage');
                timeslot = $('#confirmModalYes').attr('data-timeslot');
                amount = $('#confirmModalYes').attr('data-amount');
                depositAmount = $('#confirmModalYes').attr('data-deposit');
                lessonFeeAmount = Math.abs(parseFloat($('#confirmModalYes').attr('data-lessonCharge')));
                
                casevalues.previousPackage = $('#confirmModalYes').attr('data-previousPackage');
                casevalues.newPackage = $('#confirmModalYes').attr('data-newPackageName');
                casevalues.previousLessonDayTime = $('#confirmModalYes').attr('data-previousLessonDayTime');
                casevalues.newLessonDayTime = $('#confirmModalYes').attr('data-newLessonDayTime');
                casevalues.currentDepositonFile = $('#confirmModalYes').attr('data-currentDepositonFile');
                casevalues.newPackageDeposit = $('#confirmModalYes').attr('data-newPackageDeposit');
                casevalues.invoiceForCurrentMonth = $('#confirmModalYes').attr('data-invoiceForCurrentMonth');
                casevalues.positiveInvoiceAmount = $('#confirmModalYes').attr('data-positiveInvoiceAmount');
                casevalues.negativeInvoiceAmount = $('#confirmModalYes').attr('data-negativeInvoiceAmount');
                console.log('casevalues ',casevalues);
                Visualforce.remoting.Manager.invokeAction(
                '{!$RemoteAction.AureusCalendarClone.downgradeSubscriptionRequest}',
                    bookingId, requestDate, newPackageId, oldPackageId, timeslot, caseId, 'true', amount, depositAmount, lessonFeeAmount, casevalues, 
                    function(result, event){
                        $('#downgradePopup').addClass('slds-hide');
                        $('#confirmDowngradeEnrolment').css('pointer-events','auto');
                        $('#confirmDowngradeEnrolment').removeAttr('disabled');
                        $('.confirmModal').addClass('slds-hide');
                        if(result == 'error'){
                             $('#toastMsg').html('Request failure!<br/>Please try again....');
                             $('.toastclass').removeClass('slds-theme_success');
                             $('.toastclass').addClass('slds-theme_error');
                             toastLaunch();
                        }else if(!result){
                             $('#upgradeDowngradeSummaryModal').addClass('slds-hide');
                             $('#toastMsg').html('Request logged successfully');
                             $('.toastclass').removeClass('slds-theme_error');
                             $('.toastclass').addClass('slds-theme_success');
                             toastLaunch();
                        }else if(result && result != 'error'){
                            redirectToCaseRecord(result); 
                        }
                        refreshCalendar();
                    }
                );
            }
        });
        $('#confirmModalNo').click(function(){
            var origin = $(this).attr('data-origin');
            if(origin == 'email'){
                $('.confirmModal').addClass('slds-hide');
                refreshCalendar();
            }else if(origin == 'reschedule'){
                bookingReschedule.Id = '';
                bookingReschedule.Type = '';
                bookingReschedule.resource = '';
                bookingReschedule.date = '';
                isReschedule = false;
                $('#containerMessage').addClass('slds-hide');
            }else if(origin == 'createBooking'){
                var bookingDataStr = JSON.stringify(bookingData);
            
                Visualforce.remoting.Manager.invokeAction(
                    '{!$RemoteAction.AureusCalendarClone.createBooking}',
                    bookingDataStr, 'false', caseId,
                    function(result, event){
                        if (event.status) {
                            if(result.caseId){
                                redirectToCaseRecord(result.caseId);  
                                refreshCalendar();
                            }else if(result.msg == 'false'){
                                $('#newBookingDetails').addClass('slds-hide');
                                refreshNewBookingPopup();
                                refreshCalendar();
                                /*$('.confirmModal').removeClass('slds-hide');
                                $('#confirmBody').html('Do you want to send an email?');
                                $('#confirmHeader').html('Email Confirmation');
                                $('#confirmModalYes').attr('data-origin','email');
                                $('#confirmModalNo').attr('data-origin','email');*/
                            }else if(result.msg == 'duration'){
                                $('#saveNewBooking').css('pointer-events','');
                                $('#makeupHoursErrorMsg').text('Insufficient Makup minutes');
                            }else if(result.msg == 'existing'){
                                $('#newBookingDetails').addClass('slds-hide');
                                refreshNewBookingPopup();
                                 $('#toastMsg').html('Cannot create Booking Please Remove Existing Bookings..');
                                 $('.toastclass').removeClass('slds-theme_success');
                                 $('.toastclass').addClass('slds-theme_error');
                                 toastLaunch();
                            }
                        }
                        
                    }
                );
            }else if(origin == 'cancel'){
                $('.confirmModal').addClass('slds-hide');
                bookingId = $('#confirmModalNo').attr('data-id');
                
                var cancelReason = '';
                if($('#confirmModalNo').attr('cancelReason')){
                    cancelReason  = $('#confirmModalNo').attr('cancelReason');
                }
                var makeupReason = '';
                if($('#confirmModalNo').attr('makeupReason')){
                    makeupReason = $('#confirmModalNo').attr('makeupReason');
                }
                var makeupRemark = '';
                if($('#confirmModalNo').attr('makeupRemark')){
                    makeupRemark = $('#confirmModalNo').attr('makeupRemark');
                }
                Visualforce.remoting.Manager.invokeAction(
                    '{!$RemoteAction.AureusCalendarClone.cancelBooking}',
                    bookingId, cancelReason, makeupReason, makeupRemark, 'false', caseId, '',
                    function(result, event){
                        if(result.caseId){
                            redirectToCaseRecord(result.caseId);
                        }else{
                            refreshCalendar();
                        }
                    }, 
                    {escape: true}
                );
            }else if(origin == 'update'){
                let bookingId = '';
                let start = '';
                let end = '';
                let teacherId = '';
                let isplaceholder = '';
                let isFuture = '';
                if($('#confirmModalNo').attr('data-id')){
                    bookingId = $('#confirmModalNo').attr('data-id');
                }
                if($('#confirmModalNo').attr('start')){
                    start = $('#confirmModalNo').attr('start');
                }
                if($('#confirmModalNo').attr('end')){
                    end = $('#confirmModalNo').attr('end')
                }
                if($('#confirmModalNo').attr('teacherId')){
                    teacherId = $('#confirmModalNo').attr('teacherId')
                }
                if($('#confirmModalNo').attr('isplaceholder')){
                    isplaceholder = $('#confirmModalNo').attr('isplaceholder')
                }
                if($('#confirmModalNo').attr('isFuture')){
                    isFuture = $('#confirmModalNo').attr('isFuture')
                }
                if(bookingId && start){
                    Visualforce.remoting.Manager.invokeAction(
                        '{!$RemoteAction.AureusCalendarClone.updateBooking}',
                        bookingId, start, end, teacherId, isplaceholder, isFuture, 'false', caseId, 
                        function(result, event){
                            var msg = '';
                            if (event.status) {
                                $('.editDetails').addClass('slds-hide');
                                isReschedule = false;
                                
                                $('#confirmModalNo').html('No');
                                $('#confirmHeader').parent().removeClass('slds-text-align_left');
                                $('#confirmBody').removeClass('slds-text-align_center');
                                $('#confirmModalYes').removeClass('slds-hide');
                                $("#rescheduleClose").trigger("click");
                                if(bookingReschedule.scheduleType == 'commitEmail'){
                                    $('#confirmModalYes').attr('data-origin', 'email');
                                    $('#confirmModalYes').trigger('click');
                                }else if(bookingReschedule.scheduleType == 'commit'){
                                    if(result.caseId){
                                        redirectToCaseRecord(result.caseId); 
                                    }else{
                                        refreshCalendar();
                                    }
                                }/*else{
                                    $('.confirmModal').removeClass('slds-hide');
                                    $('#confirmBody').html('Do you want to send an email?');
                                    $('#confirmHeader').html('Email Confirmation');
                                    $('#confirmModalYes').attr('data-origin','email');
                                    $('#confirmModalNo').attr('data-origin','email');
                                    $('#confirmModalYes').removeAttr('data-starttime');
                                    $('#confirmModalYes').removeAttr('data-resourceid'); 
                                    $('#confirmModalYes').removeAttr('data-endtime');
                                }*/
                                bookingReschedule.Id = '';
                                bookingReschedule.Type = '';
                                bookingReschedule.resource = '';
                                bookingReschedule.date = '';
                                bookingReschedule.Individual = '';
                                bookingReschedule.isRecurrence = '';
                                bookingReschedule.scheduleType = '';
                                
                                $('#toastMsg').html('Appointment Reschedule successfully');
                                toastLaunch();
                                refreshCalendar();
                            }
                        },
                        {buffer: false, escape: true}
                    );
                }
               
            }else if(origin == 'withdrawal'){
                    
                bookingId = $('#confirmModalNo').attr('data-id');
                var endDateStr = $('#confirmModalNo').attr('data-endDate');
                var lastLessonDate = $('#confirmModalNo').attr('data-lastLessonDate');
                Visualforce.remoting.Manager.invokeAction(
                '{!$RemoteAction.AureusCalendarClone.cancelSubscriptionRequest}',
                 bookingId, endDateStr, lastLessonDate, caseId, 'false',
                    function(result, event){
                        $('#confirmModal').addClass('slds-hide');
                        if(result == 'error'){
                            $('#toastMsg').html('Request failure!');
                            $('.toastclass').removeClass('slds-theme_success');
                            $('.toastclass').addClass('slds-theme_error');
                            toastLaunch();
                        }else{
                            refreshCalendar();
                        }
                        
                    }
                 );
            }else if(origin == 'change'){
                var enrolmentId, newTeacher, newPackage, effectiveDate, newTime;
                enrolmentId = $('#confirmModalNo').attr('data-enrol');
                newTeacher = $('#confirmModalNo').attr('data-teacher');
                newPackage = $('#confirmModalNo').attr('data-package');
                effectiveDate = $('#confirmModalNo').attr('data-date');
                newTime = $('#confirmModalNo').attr('data-time');
                Visualforce.remoting.Manager.invokeAction(
                '{!$RemoteAction.AureusCalendarClone.updateEnrolment}',
                     enrolmentId, newTeacher, newPackage, effectiveDate, newTime, caseId, 'false', 
                     function(result, event){
                         if(!result){
                              $('#enrolmentUpdatePopup').addClass('slds-hide');
                              $('#toastMsg').html('Enrolment Update Successfully');
                              $('.toastclass').removeClass('slds-theme_error');
                              $('.toastclass').addClass('slds-theme_success');
                              toastLaunch();
                              refreshCalendar();
                         }else if(result == 'error'){
                              $('#enrolmentUpdatePopup').addClass('slds-hide');
                              $('#toastMsg').html('Some Error Occurred...');
                              $('.toastclass').removeClass('slds-theme_success');
                              $('.toastclass').addClass('slds-theme_error');
                              toastLaunch();
                              refreshCalendar();
                         }
                     }
                );
            }else if(origin == 'upgrade'){
                var bookingId, effectiveDate, newPackageId, oldPackageId, timeSlot;
                bookingId = $('#confirmModalNo').attr('data-id');
                effectiveDate = $('#confirmModalNo').attr('data-date');
                newPackageId = $('#confirmModalNo').attr('data-newPackage');
                oldPackageId = $('#confirmModalNo').attr('data-oldPackage');
                timeSlot = $('#confirmModalNo').attr('data-timeslot');
                Visualforce.remoting.Manager.invokeAction(
                '{!$RemoteAction.AureusCalendarClone.updatePackageOfCustomer}',
                    bookingId, effectiveDate, newPackageId, oldPackageId,timeSlot, caseId, 'false', 
                    function(result, event){
                        $('#confirmModalYes').css('pointer-events','auto');
                        $('#confirmModalYes').removeAttr('disabled');
                        $('#confirmModalNo').css('pointer-events','auto');
                        $('#confirmModalNo').removeAttr('disabled');
                        
                        if(result == 'error'){                       
                            $('#upgradeDowngradeSummaryModal').addClass('slds-hide');
                             $('#toastMsg').html('Request failure!<br/>Please try again....');
                             $('.toastclass').removeClass('slds-theme_success');
                             $('.toastclass').addClass('slds-theme_error');
                             toastLaunch();
                        }else if(!result){
                             $('#toastMsg').html('Request Logged Successfully...');
                             $('.toastclass').removeClass('slds-theme_error');
                             $('.toastclass').addClass('slds-theme_success');
                             toastLaunch();
                        }else if(result && result != 'error'){
                            $('#confirmModal').addClass('slds-hide');
                            redirectToCaseRecord(result);  
                        }
                        refreshCalendar();
                    }
                );
            }else if(origin == 'downgrade'){
                var bookingId, requestDate, newPackageId, oldPackageId, timeslot;
                bookingId = $('#confirmModalNo').attr('data-id');
                requestDate = $('#confirmModalNo').attr('data-date');
                newPackageId = $('#confirmModalNo').attr('data-newPackage');
                oldPackageId = $('#confirmModalNo').attr('data-oldPackage');
                timeslot = $('#confirmModalNo').attr('data-timeslot');
                Visualforce.remoting.Manager.invokeAction(
                '{!$RemoteAction.AureusCalendarClone.downgradeSubscriptionRequest}',
                    bookingId, requestDate, newPackageId, oldPackageId, timeslot, caseId, 'false', 
                    function(result, event){
                        $('#downgradePopup').addClass('slds-hide');
                        $('#confirmDowngradeEnrolment').css('pointer-events','auto');
                        $('#confirmDowngradeEnrolment').removeAttr('disabled');
                        if(result == 'error'){
                             $('#toastMsg').html('Request failure!<br/>Please try again....');
                             $('.toastclass').removeClass('slds-theme_success');
                             $('.toastclass').addClass('slds-theme_error');
                             toastLaunch();
                        }else if(!result){
                             $('#upgradeDowngradeSummaryModal').addClass('slds-hide');
                             $('#toastMsg').html('Request logged successfully');
                             $('.toastclass').removeClass('slds-theme_error');
                             $('.toastclass').addClass('slds-theme_success');
                             toastLaunch();
                        }else if(result && result != 'error'){
                            redirectToCaseRecord(result); 
                        }
                        refreshCalendar();
                    }
                );
            }    
        });
        function initResources(centerId, teacherId, resourceId, dateOfAppointment, view, instrument){
            $('#statusOnPage').show();
            var listOfResource = [];
            var listOfEvents = [];
            var minTime;
            var maxTime;
            Visualforce.remoting.Manager.invokeAction(
                '{!$RemoteAction.AureusCalendarClone.getCalendarData}',
                centerId, teacherId, resourceId, dateOfAppointment, instrument,
                function(result, event){
                    var msg = '';
                    if (event.status) {
                        if(result != '' && result != null && result != 'undefined'){
                           
                            var calendarResult = JSON.parse(result.replace(/(&quot\;)/g,"\""));
                            listOfResource = calendarResult.listOfResources;
                            listOfEvents = calendarResult.listOfEvents;
                            teacherWorkingHours = calendarResult.teachersWorkingHours;
                            eventsOfCalendar = calendarResult.listOfEvents;
                            console.log('filter.resourc', filter.resource);
                            console.log('calendarResult.listOfTeachersFilters', calendarResult.listOfTeachersFilters);                            
                            if(!filter.resource){
                                getInstruments(calendarResult.listOfTeachersFilters);
                            }else{
                                //$('[id$=teachers]').empty();
                                $('#statusOnPage').hide();
                            }
                            
                                                      
                            if(calendarResult.minTime != '' && calendarResult.minTime != null && calendarResult.minTime != 'undefined'
                               && calendarResult.maxTime != '' && calendarResult.maxTime != null && calendarResult.maxTime != 'undefined'){
                                minTime = calendarResult.minTime;
                                maxTime = calendarResult.maxTime;
                                
                                $('#calendar').html('');
                                
                                initCalendar(listOfResource,listOfEvents,dateOfAppointment,minTime,maxTime,view);
                                
                            }else{
                                msg = 'TODAY IS OFF';
                                $('#calendar').html(msg);
                            }
                        }else{
                            msg = 'TODAY IS OFF';
                            $('#calendar').html(msg);
                        }
                    } else if (event.type === 'exception') {
                        document.getElementById("responseErrors").innerHTML = 
                            event.message + "<br/>\n<pre>" + event.where + "</pre>";
                    } else {
                        document.getElementById("responseErrors").innerHTML = event.message;
                    }
                }, 
                {escape: true}
            );
        }
        
        function getInstruments(filterTeacherList){
            
            $('#instruments').empty();
            Visualforce.remoting.Manager.invokeAction(
                '{!$RemoteAction.AureusCalendarClone.getPickListValues}',
                'Account', 'Major_Instruments_Disciplines__c', 
                function(result, event){
                    if (event.status) {
                        var instrumentsOption = '<option value="">All</option>';
                        $(result).each(function(index, value){
                            instrumentsOption += '<option value="'+value+'">'+value+'</option>';
                        });
                        $('#instruments').append(instrumentsOption);
                        $('#instruments').children().each(function(index, value){
                            if($(this).val() == filter.instrument){
                                $('#instruments').val(filter.instrument);
                            }
                        });
                        fillTeacherAccordingToInstrument(filterTeacherList);
                        $('#statusOnPage').hide();
                    }
                }
            );
        }
        
        function fillTeacherAccordingToInstrument(filterTeacherList){
            $('[id$=teachers]').empty();
            var calView = $('#calendar').fullCalendar('getView').name;
            $('[id$=teachers]').append('<option>Select Teacher</option>');
            if(calView != 'agendaTwoDay'){
               $('[id$=teachers]').append('<option value="AllRosteredStaff">All rostered staff</option><option value="AllStaff">All staff</option>');   
            }
            var teacherList = '';
            $(filterTeacherList).each(function(index, value){
                teacherList += '<option value="'+value.id+'">'+value.title+'</option>';
            });
            $('[id$=teachers]').append(teacherList);
            let flag = false;
            $('[id$=teachers]').children().each(function(index, value){
                if($(this).val() == filter.teacher){
                    flag = true;
                    $('[id$=teachers]').val(filter.teacher);
                }
            });
            if(filterTeacherList.length == 0 && ($('[id$=teachers]').val() != 'Select Teacher' || flag == false)){
                $('[id$=teachers]').val('Select Teacher');
                $('[id$=teachers]').trigger('change');
            }else if(filterTeacherList.length > 0 && $('[id$=teachers]').val() == 'Select Teacher'){
                $('[id$=teachers]').val(filterTeacherList[0].id);
                $('[id$=teachers]').trigger('change');
            }                 
        }
        
        function initEvents(eventId, eventDate){
            resetTabs();
            refreshEditAppointment();
            $('.editBooking').removeAttr('disabled');
            $('#cancelBooking').removeAttr('disabled');
            $('#statusLabelOnEdit').text('');
            $('#noShowBooking').removeAttr('disabled');
            $('#completeBooking').removeAttr('disabled');
            $('#submitUpgradeRequest').attr('data-date', eventDate);
            $('#errorMsgReason').html('');
            $('#errorMsgRemark').html('');
            $('.bookingStatus').empty();
            $('.makeupTitle').addClass('slds-hide');
            $('#reasonPopupText').html('Cancel appointment');
            $('.notMakeupHoursShow').removeClass('slds-hide');
            $('.reasonText').html('Reason for Cancellation');
            $('.reasonSection').removeClass('slds-hide');
            $('.makeupCredit').addClass('slds-hide');
            $('.close-popup').removeClass('slds-hide');
            $('#cancelBookingWithReason').removeClass('slds-hide');
            $('#cancelBookingWithMakeupBtn').addClass('slds-hide');
            $('.studentImg').removeAttr('src');
            $('#selectStudio').removeClass('slds-hide');
            $('#selectTeacher').removeClass('slds-hide');
            $('#advanceDetailsSection').addClass('slds-hide');
            $('#enrolmentDetailSection').addClass('slds-hide');
            Visualforce.remoting.Manager.invokeAction(
                '{!$RemoteAction.AureusCalendarClone.getEventDetails}',
                eventId,
                function(result, event){
                    var msg = '';
                    if (event.status) {
                        if(result != '' && result != null && result != 'undefined'){
                            
                            var eventResult = JSON.parse(result.replace(/(&quot\;)/g,"\""));
                            $('#completeBooking').attr({'data-id':eventResult.Id, 'data-type':eventResult.type, 'data-status':'Completed'});
                            $('#noShowBooking').attr({'data-id':eventResult.Id, 'data-type':eventResult.type, 'data-status':'No-show'});
                            if(eventResult.status == 'Completed' || eventResult.status == 'No-show'){
                                $('#completeBooking').attr('disabled','true');
                                $('#noShowBooking').attr('disabled','true');
                                $('#cancelBooking').attr('disabled','true');
                            }
                            $('#closeOnlyByResourceBooking').remove();
                            if(eventResult.rType == 'Facility'){
                                $('#cancelBooking').addClass('slds-hide');
                                $('#completeBooking').addClass('slds-hide');
                                $('#rescheduleBookingOnlyResource').addClass('slds-hide');
                                $('#noShowBooking').addClass('slds-hide');
                                $('#button_Group_reschedule').append('<button style="width: 110px" class="slds-button slds-button_icon slds-button_icon-border-filled button-shadow" title="Close" aria-pressed="false" onclick="cancelRescheduling();return false;" id="closeOnlyByResourceBooking">Close<svg class="slds-button__icon" aria-hidden="true"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#close')}" /></svg><span class="slds-assistive-text">Close</span></button>');
                            }else if(eventResult.rType == 'Lesson'){
                                $('#cancelBooking').removeClass('slds-hide');
                                $('#completeBooking').removeClass('slds-hide');
                                $('#rescheduleBookingOnlyResource').removeClass('slds-hide');
                                $('#noShowBooking').removeClass('slds-hide');
                            }
                            if(isDateTimeInFuture(eventDate)){
                                $('#completeBooking').attr('disabled','true');
                                $('#noShowBooking').attr('disabled','true');
                            }else{
                                //Commenting this code for temporary basis need to uncomment it later.
                                /*$('#cancelBooking').attr('disabled','true');
                                $('.editBooking').attr('disabled','true');*/
                            }
                            $('#detailPopupTitle').text('Appointment Details '+eventResult.name);
                            $('#statusIconOnEdit').empty();
                            $('#statusLabelOnEdit').text(eventResult.status);
                            if(eventResult.status == 'Scheduled'){
                                $('#statusIconOnEdit').append('<svg class="slds-button__icon" aria-hidden="true"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#clock')}" /></svg>');
                            }else if(eventResult.status == 'Pending'){
                                $('#statusIconOnEdit').append('<svg class="slds-button__icon" aria-hidden="true"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#reminder')}" /></svg>');
                            }else if(eventResult.status == 'Completed'){
                                if(eventResult.type == 'Trial'){        
                                    $('#enrollNowProcess').removeClass('slds-hide');        
                                    $('#enrollNowProcess').attr({'data-id': eventResult.Id, 'enrolment-Id': eventResult.enrolment});        
                                            
                                }
                                $('#statusIconOnEdit').append('<svg class="slds-button__icon" aria-hidden="true"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#check')}" /></svg>');
                            }else if(eventResult.status == 'No-show'){
                                $('#statusIconOnEdit').append('<svg class="slds-button__icon" aria-hidden="true"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#close')}" /></svg>');
                            }else if(eventResult.status == 'Canceled'){
                                $('#statusIconOnEdit').append('<svg class="slds-button__icon" aria-hidden="true"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#clear')}" /></svg>');
                            }
                            
                            if(eventResult.type == 'Trial'){
                                $('#enrolmentDetailSection').removeClass('slds-hide');
                                $('#sendTrialEnrollmentLink').attr({'data-id': eventId});
                            }
                            $('#updateEnrolmentBtn').attr('data-enrol', eventResult.enrolment);
                            $('#submitUpgradeRequest').attr('data-enrolment', eventResult.enrolment);
                            $('#submitDowngradeRequest').attr('data-enrolment', eventResult.enrolment);
                            $('#editBooking').attr('data-id', eventResult.Id);
                            $('.editBooking').attr({'data-id': eventResult.Id, 'data-type': eventResult.type, 'data-individual': eventResult.Individual});
                           
                            if(!eventResult.studentFirstName){
                                eventResult.studentFirstName = '';
                            }
                            if(!eventResult.studentLastName){
                                eventResult.studentLastName = '';
                            }
                            if(!eventResult.parentFirstName){
                                eventResult.parentFirstName = '';
                            }
                            if(!eventResult.parentLastName){
                                eventResult.parentLastName = '';
                            }
                            $('.editCustomerDetails').attr('data-id', eventResult.studentId);
                            if(eventResult.parentId){
                                $('.editCustomerDetails').attr('data-parentId', eventResult.parentId);
                            }else{
                                $('.editCustomerDetails').attr('data-parentId', eventResult.studentId);
                            }
                            
                            $('#cancelBooking').attr('data-id',eventResult.Id);
                            $('#cancelBooking').attr('data-date',eventDate);
                            $('#cancelBooking').attr('data-type',eventResult.type);
                            $('#lesson').text(eventResult.service);
                            $('#teacherName').text(eventResult.staffMember);
                            $('#teacherNameEditPopup').text(eventResult.staffMember);
                            $('#teacherNameEditPopup').attr('href','/'+eventResult.staffMemberId);
                            $('#submitUpgradeRequest').attr('data-teacherId', eventResult.staffMemberId);
                            $('#submitDowngradeRequest').attr('data-teacherId', eventResult.staffMemberId);
                            var centerName = eventResult.centerName;
                            $('#centerName').html(centerName);
                            $('#centerName').attr('href', '/'+eventResult.centerId);
                            $('#submitUpgradeRequest').attr('data-centerId', eventResult.centerId);
                            $('#prePaymentId').attr('data-centerId', eventResult.centerId);
                            $('#prePaymentId').attr('data-enrol', eventResult.enrolment);
                            $('#submitDowngradeRequest').attr('data-centerId', eventResult.centerId);
                            $('#centerNameBusyView').html(centerName);
                            $('#resource').text(eventResult.resource);
                            $('#dateAndTime').text(eventResult.dateAndTime);
                            $('.sendEmail').attr('data-bookingId', eventResult.Id);
                            if(eventResult.parentId){
                                $('.sendEmail').attr('data-parentId', eventResult.parentId);
                            }else{
                                $('.sendEmail').attr('data-parentId', eventResult.studentId);
                                
                            }
                            
                            var dateTime = eventResult.dateAndTime;
                            var res;
                            if(dateTime){
                                res =  dateTime.split("at"); 
                                $('#date').text(res[0]);
                                $('#time').text(res[1]);
                            }
                            
                            if(eventResult.processStatus == 'Pending'){
                                $('#advanceDetailsSection').removeClass('slds-hide');
                                $('#processTypeEdit').html(eventResult.processType);
                                $('#newPackageEdit').attr('href', '/'+eventResult.newPackage);
                                $('#newPackageEdit').html(eventResult.newPackageName);
                                $('#advanceActionRequestedBy').html(eventResult.requestedBy);
                                if(eventResult.processRequestDate){
                                    $('#requestDateEdit').html(convertDateToMoment(eventResult.processRequestDate));
                                }
                                
                                if(eventResult.processEffectiveDate){
                                    $('#effectiveDateEdit').html(convertDateToMoment(eventResult.processEffectiveDate));
                                }
                                
                                if(eventResult.noticeStartDate){
                                    $('#noticeStartEdit').html(convertDateToMoment(eventResult.noticeStartDate));
                                }
                                
                                if(eventResult.noticeEndDate){
                                    $('#noticeEndEdit').html(convertDateToMoment(eventResult.noticeEndDate));
                                }
                                
                                
                            }
                            $('#date').text(convertDateToMoment(eventResult.eventDateTime.split('T')[0]));
                            $('.studentImg').attr('src','/servlet/servlet.FileDownload?file='+eventResult.teacherAttachmentId+'');
                            $('#duration').text(eventResult.duration);
                            $('#price').text(eventResult.price);
                            $('#totalPrice').text('$'+eventResult.price);
                            
                            $('#lessonOnCancel').text(eventResult.service);
                            $('#teacherOnCancel').text(eventResult.staffMember);
                            $('#dateAndTimeOnCancel').text(convertDateToMoment(eventResult.eventDateTime.split('T')[0]) +' '+convertTimeToMoment(eventResult.eventDateTime.split('T')[1].split(':')[0], eventResult.eventDateTime.split('T')[1].split(':')[1]));
                            
                            $('#name').text(eventResult.studentFirstName+' '+eventResult.studentLastName+' - '+eventResult.parentFirstName +' '+eventResult.parentLastName);
                            
                            $('#name1').text(eventResult.studentFirstName+' '+eventResult.studentLastName);
                            $('#name1').attr('href', '/'+eventResult.studentId);
                            $('#parentname1').text(eventResult.parentFirstName +' '+eventResult.parentLastName);
                            $('#parentname1').attr('href', '/'+eventResult.parentId);
                            $('.popupDetails').removeClass('slds-hide');
                            if(eventResult.rType == 'Lesson'){
                                $('#selectStudio').addClass('slds-hide');
                            }else if(eventResult.rType == 'Facility'){
                                $('#selectTeacher').addClass('slds-hide');
                            }
                            
                            $('#fname').val(eventResult.studentFirstName);
                            $('#lname').val(eventResult.studentLastName);
                            $('#telephone').val(eventResult.parentPhone);
                            $('#parentsms').val(eventResult.parentMobile);
                            $('#parentEmail').val(eventResult.parentEmail);
                            
                            $('#parentfname').val(eventResult.parentFirstName);
                            $('#parentlname').val(eventResult.parentLastName);
                            $('#popoverTitle').text(eventResult.studentFirstName+ ' '+eventResult.studentLastName + ' - ' +eventResult.parentFirstName+ ' '+eventResult.parentLastName);
                            
                            $('#phone').text(eventResult.parentMobile);
                            $('#phone').attr('href', 'tel:'+eventResult.parentMobile);
                            $('#email').text(eventResult.parentEmail);
                            
                            $('#studentName').text(eventResult.studentFirstName+ ' '+eventResult.studentLastName);
                            $('#parentName').text(eventResult.parentFirstName+ ' '+eventResult.parentLastName);
                            $('#parentMobile').text(eventResult.parentMobile);
                            $('#parentPhone').text(eventResult.parentPhone);
                            $('#parentEmail').text(eventResult.parentEmail);
                            
                            $('#servicePackagName').text(eventResult.service);
                            $('#serviceStaff').text(eventResult.staffMember);
                            $('#serviceResource').text(eventResult.resource);
                            $('#serviceTime').text(eventResult.timeOfBooking);
                            
                            $('#serviceDuration').text(eventResult.duration);
                            
                            $('#servicePrice').text(eventResult.price);
                            
                            $('.editDetails').removeClass('slds-hide'); 
                            
                            if(eventResult.contentNoteList && eventResult.contentNoteList.length > 0){
                                $('#bookingNotesTBody').html('');
                                for(var i = 0; i < eventResult.contentNoteList.length; i++){
                                    var title = eventResult.contentNoteList[i].Title;
                                    var body = eventResult.contentNoteList[i].TextPreview;
                                    var dateTime = new Date(eventResult.contentNoteList[i].CreatedDate);
                                    createdDate = moment(dateTime).format("D MMM YYYY");
                                    createdTime = moment(dateTime).format("HH:mmA");
                                    ownerName = eventResult.contentNoteList[i].Owner.Name;
                                    
                                    $('#bookingNotesTBody').append('<tr class="slds-line-height_reset"> <th class="" scope="col"> <div class="slds-truncate">Title</div> </th> <th class="" scope="col"> <div class="slds-truncate">Body</div> </th> <th class="" scope="col"> <div class="slds-truncate">Date-Time</div> </th> <th class="" scope="col"> <div class="slds-truncate">Created By</div> </th> </tr> </thead> <tbody> <tr class="slds-hint-parent"> <td scope="row"> <div class="slds-truncate">'+ title +'</div> </td> <td scope="row" title="'+ body +'"> <div class="slds-truncate">'+ body +'</div> </td> <td scope="row"> <div class="slds-truncate">'+ createdDate +' at '+createdTime +'</div> </td> <td scope="row"> <div class="slds-truncate">' +ownerName+ '</div> </td> </tr>');
                                }
                            }else{
                                $('#bookingNotesTBody').html('');
                            }
                            
                            if(eventResult.bookingHistoryList.length > 0){
                                $('#HistoryCount').html(eventResult.bookingHistoryList.length);
                                $('#bookingHistory').html('');
                                for(var i = 0; i < eventResult.bookingHistoryList.length; i++){
                                    
                                    var description = eventResult.bookingHistoryList[i].Description;
                                    var historyDateTime = eventResult.bookingHistoryList[i].DateOfHistory;
                                    var historyBy = eventResult.bookingHistoryList[i].HistoryBy;
                                    if(historyBy){
                                        $('#bookingHistory').append('<div class="eventHistory"><h1><span class="slds-page-header__title slds-truncate headerTitle"> ' +historyDateTime+ '<span class="historyBy"> - by '+ historyBy +'</span></span></h1> '+description+ ' </div>');
                                    }else{
                                        $('#bookingHistory').append('<div class="eventHistory"><h1><span class="slds-page-header__title slds-truncate headerTitle"> ' +historyDateTime+ ' </span></h1> '+description+ ' </div>');
                                    }
                                }
                            }else{
                                $('#HistoryCount').html(eventResult.bookingHistoryList.length);
                                $('#bookingHistory').html('');
                            }
                        }
                    } else if (event.type === 'exception') {
                        document.getElementById("responseErrors").innerHTML = 
                            event.message + "<br/>\n<pre>" + event.where + "</pre>";
                    } else {
                        document.getElementById("responseErrors").innerHTML = event.message;
                    }
                }, 
                {escape: true}
            );
        }
        function saveBookingNote(){
            var title = $('#title').val();
            var note = $('#note').val();
            
            Visualforce.remoting.Manager.invokeAction(
                '{!$RemoteAction.AureusCalendarClone.saveBookingNote}',
                title,note,eventId,
                function(result, event){
                    if (event.status) {
                        if(result != '' && result != null && result != 'undefined'){
                            var bookingNoteResult = JSON.parse(result.replace(/(&quot\;)/g,"\""));
                            if(bookingNoteResult.title){
                                $('#title').val('');
                                $('#note').val('');
                                
                                var title = bookingNoteResult.title;
                                var body = bookingNoteResult.Body;
                                var dateTime = new Date(bookingNoteResult.createdDate);
                                createdDate = moment(dateTime).format("D MMM YYYY");
                                createdTime = moment(dateTime).format("HH:mmA");
                                ownerName = bookingNoteResult.CreatedBy;
                                
                                $('#bookingNotesTBody').append('<tr class="slds-line-height_reset"> <th class="" scope="col"> <div class="slds-truncate">Title</div> </th> <th class="" scope="col"> <div class="slds-truncate">Body</div> </th> <th class="" scope="col"> <div class="slds-truncate">Date-Time</div> </th> <th class="" scope="col"> <div class="slds-truncate">Created By</div> </th> </tr> </thead> <tbody> <tr class="slds-hint-parent"> <td scope="row"> <div class="slds-truncate">'+ title +'</div> </td> <td scope="row"> <div class="slds-truncate">'+ body +'</div> </td> <td scope="row"> <div class="slds-truncate">'+ createdDate +' at '+createdTime +'</div> </td> <td scope="row"> <div class="slds-truncate">' +ownerName+ '</div> </td> </tr>');
                                
                            }
                        }
                    } else if (event.type === 'exception') {
                        document.getElementById("responseErrors").innerHTML = 
                            event.message + "<br/>\n<pre>" + event.where + "</pre>";
                    } else {
                        document.getElementById("responseErrors").innerHTML = event.message;
                    }
                }, 
                {escape: true}
            );
            $('.addNotes').addClass('slds-hide');
        }
        
        function initCalendar(listOfResource,listOfEvents,dateOfAppointment,minTime,maxTime,view){
            $('#confirmModalNo').attr('onclick', "$('.confirmModal').addClass('slds-hide');return false;");
            $('#cancelChanges').attr('onclick','cancelRescheduling();return false;');
            $('#closeRescheduleIconButton').attr('onclick', 'cancelRescheduling();return false;');
            $('#calendar').fullCalendar('destroy');
            $('#calendar').fullCalendar({
                defaultView: view,
                groupByDateAndResource: true,
                schedulerLicenseKey: 'GPL-My-Project-Is-Open-Source',
                editable: true,
                selectable: true,
                defaultDate: dateOfAppointment[0],
                eventLimit: true,
                minTime: minTime,
                maxTime: maxTime,
                
                slotDuration: '00:15:00',
                slotLabelFormat: 'hh:mm a',  //'h(:mm) a',
                slotMinutes: 30,
                titleFormat: 'ddd, MMM DD YYYY',
                header: {
                    left: 'prev,myCustomButton,next today',
                    center: 'title',
                    right: 'agendaDay,agendaTwoDay'
                },
                customButtons:{
                    myCustomButton:{
                        text: new Date().toJSON().slice(0,10).replace(/-/g,'/'),
                        click: function(){
                        }
                    }
                },
                views: {
                    agendaTwoDay: {
                        type: 'agenda',
                        duration: { week: 1 },
                        // groupByResource: true
                        columnFormat: 'ddd D MMM',
                    },
                    week: {
                        titleFormat: 'D MMMM YYYY',
                        titleRangeSeparator: ' to ',
                    }
                },
                allDaySlot: false,
                resources: listOfResource,
                events: listOfEvents,
                timeFormat: 'hh:mm a',
                nowIndicator: true,
                now: moment(),
                eventAfterRender:function( event, element, view ) {
                    $(element).attr("id",event.id);
                },
                eventAfterAllRender: function( view, element ){
                    setTimeout(function(){
                           var calView = $('#calendar').fullCalendar('getView').name;
                           if(calView == 'agendaTwoDay'){
                               showTimeOnResourceColumn(7,'week');
                           }else{
                               showTimeOnResourceColumn(listOfResource.length,'day');
                           }
                        },40);
                        $('.fc-slats tr').each(function(){
                            var time = $(this).attr('data-time');
                            if(time && time.includes('00:00')){
                                $(this).children('td:nth-child(2)').addClass("black");
                            }
                            
                            if(listOfResource.length > 1){
                                var width = '';
                                if(listOfResource.length > 6){
                                    width = (listOfResource.length * 15);
                                    $('.fc-view-container').css({'width': width+'vw', 'overflow-x': 'visible'});
                                }
                            }
                        });
                    
                   
                    $('.fc-resource-cell').click(function(){
                        var isTeacher = false;
                        var isResource = false;
                        var resourceId = $(this).attr('data-resource-id');
                        var calView = $('#calendar').fullCalendar('getView').name;
                        if(calView != 'agendaTwoDay'){
                            $('.teachers').children().each(function(index, value){
                                if($(this).val() == resourceId){
                                    isTeacher = true;
                                }
                            });
                            if(!isTeacher){
                                $('[id$=resources]').children().each(function(index, value){
                                    if($(this).val() == resourceId){
                                        isResource = true;
                                    }
                                });
                            }
                            
                            if(isTeacher){
                                teacher = resourceId;
                                filter.teacher = resourceId;
                                $('.teachers').val(teacher);
                                filter.resource = 'Select Resource';
                                $('.fc-agendaTwoDay-button').trigger('click');
                            }else if(isResource){
                                teacher = '';
                                filter.teacher = '';
                                $('[id$=resources]').val(resourceId);
                                filter.resource = resourceId;
                                $('.fc-agendaTwoDay-button').trigger('click');
                            }   
                        } 
                    });
                    
                    $('.fc-day-header').click(function(){
                        var dateHeader = $(this).attr('data-date');
                        var isTeacher = false;
                        var isResource = false;
                        
                        if(filter.teacher && filter.teacher != 'Select Teacher'){
                            isTeacher = true;
                        }else if(filter.resource && filter.resource != 'Select Resource'){
                            isResource = true;
                        } 
                        
                        $('[id$=teachers]').children().each(function(index, value){
                            if($(this).val() == 'AllRosteredStaff' || $(this).val() == 'AllStaff'){
                                $(this).remove();
                            }
                        });
                        $('[id$=teachers]').children().first().after('<option value="AllRosteredStaff">All rostered staff</option><option value="AllStaff">All staff</option>');
                        
                        $('[id$=resources]').children().each(function(index, value){
                            if($(this).val() == 'AllRosteredResource' || $(this).val() == 'AllResource'){
                                $(this).remove();
                            }
                        });
                        $('[id$=resources]').children().first().after('<option value="AllRosteredResource">All rostered resources</option><option value="AllResource">All Resources</option>');
                        
                        if(isTeacher){
                            
                            teacher = 'AllRosteredStaff';
                            filter.teacher = 'AllRosteredStaff';
                            filter.resource = 'Select Resource';
                            
                            initResources(center, teacher, filter.resource, [dateHeader], 'agendaDay', filter.instrument);
                            $('.teachers').val(filter.teacher);
                        }else if(isResource){
                            
                            filter.resource = 'AllRosteredResource';
                            filter.teacher = 'Select Teacher';
                            
                            initResources(center, teacher, filter.resource, [dateHeader], 'agendaDay', filter.instrument);
                            $('[id$=resources]').val(filter.resource);
                        }
                           
                    });
                },
                viewRender: function( view, element ){
                    $('.fc-slats tr').each(function(){
                        var time = $(this).attr('data-time');
                        if(time && time.includes('00:00')){
                            $(this).children('td:nth-child(2)').addClass("black");
                        }
                        
                        if(listOfResource.length > 1){
                            var width = '';
                            setTimeout(function(){
                                if(listOfResource.length > 6){
                                    width = (listOfResource.length * 15);
                                    $('.fc-view-container').css({'width': width+'vw', 'overflow-x': 'visible'});
                                }
                            }, 30);
                        }
                    });
                },
                eventResize: function(event, delta, revertFunc) {
                    revertFunc();
                },
                dayClick: function(date, jsEvent, view,resourceObj) {
                    bookingReschedule.resource = resourceObj.id;
                    bookingReschedule.date = date.format();
                    var startTime = date.format();
                    var endTime = toJSDate( date.format());
                    var milleseconds = new Date(endTime.getTime() + (30 * 60 * 1000));
                    milleseconds = new Date(milleseconds.getTime() - (milleseconds.getTimezoneOffset() * 60 * 1000));
                    if(milleseconds){
                        milleseconds = milleseconds.toJSON().split('.')[0];
                    }
                    if(bookingReschedule.Id && bookingReschedule.Type == 'Regular' && bookingReschedule.Individual == 'false' && isEventInTeacherWorkingHour(teacherWorkingHours, startTime, milleseconds, bookingReschedule.resource)){
                        isReschedule = false;
                        $('#confirmModalYes').addClass('slds-hide');
                        $('#confirmModalNo').html('Cancel');
                        $('#confirmModalNo').attr('data-origin', 'reschedule');
                        $('#confirmHeader').html('Recurring event');
                        $('#confirmHeader').parent().addClass('slds-text-align_left');
                        $('#confirmBody').addClass('slds-text-align_center');
                        $('#confirmBody').html('<p>Would you like to reschedule this booking?</p><div><button class="slds-button slds-m-around_small slds-p-horizontal_large" style="background: #00b3f0;color:#fff;" id="thisReschedule" onclick="rescheduleThisOnly();return false;">This only</button></div>');
                        //$('#confirmBody').html('<p>Would you like to apply this change to this event only,<br/>or the current and future events in the series?</p><div><button class="slds-button slds-m-around_small slds-p-horizontal_large" style="background: #00b3f0;color:#fff;" id="thisReschedule" onclick="rescheduleThisOnly();return false;">This only</button><button class="slds-button slds-m-around_small slds-p-horizontal_large" style="background: #00b3f0;color:#fff;" id="thisAndFutureReschedule" onclick="rescheduleFutureAlso();return false;">This and future</button></div>');
                        $('#confirmModal').removeClass('slds-hide');
                    }else if(bookingReschedule.Id && isEventInTeacherWorkingHour(teacherWorkingHours, startTime, milleseconds, bookingReschedule.resource)){
                        $('#confirmModalYes').addClass('slds-hide');
                        $('#confirmModalNo').html('Cancel');
                        $('#confirmModalNo').attr('data-origin', 'reschedule');
                        $('#confirmHeader').html('Reschedule Busy Time');
                        $('#confirmHeader').parent().addClass('slds-text-align_left');
                        $('#confirmBody').addClass('slds-text-align_center');
                        $('#confirmBody').html('<p>Would you like to apply this change to this Busy Time only,<br/>or the current and future Busy Time in the series?</p><div><button class="slds-button slds-m-around_small slds-p-horizontal_large" style="background: #00b3f0;color:#fff;" id="thisReschedule" onclick="rescheduleThisOnly();return false;">This only</button><button class="slds-button slds-m-around_small slds-p-horizontal_large" style="background: #00b3f0;color:#fff;" id="thisAndFutureReschedule" onclick="rescheduleFutureAlso();return false;">This and future</button></div>');
                        $('#confirmModal').removeClass('slds-hide');
                        /*console.log('In this case');
                        bookingReschedule.isRecurrence = 'false';
                       
                        if(isDateTimeInFuture(date.format()) && isEventInTeacherWorkingHour(teacherWorkingHours, startTime, milleseconds, bookingReschedule.resource)){
                            reschedule();
                        }*/
                        
                    }else if(!bookingReschedule.Id){
                       // if(isDateTimeInFuture(date.format())){
                            if(filter.resource){
                                $('#addNewBooking').addClass('slds-hide');
                                $('#addNewBooking').attr('data-source', 'resource');
                                $('#addBusyTime').attr('data-source', 'resource');
                            }else{
                                $('#addNewBooking').removeClass('slds-hide');
                                $('#addNewBooking').attr('data-source', 'teacher');
                                $('#addBusyTime').attr('data-source', 'teacher');
                            }
                            if(!isEventInTeacherWorkingHour(teacherWorkingHours, startTime, milleseconds, bookingReschedule.resource)){
                                $('#addNewBooking').addClass('slds-hide');
                            }
                            $('#addNewBooking').attr({'data-centerId' : filter.center, 'data-teacherId' : resourceObj.id, 'data-date' : startTime});
                            $('#addBusyTime').attr({'data-centerId' : filter.center, 'data-teacherId' : resourceObj.id, 'data-date' : startTime});
                            $('#newBookingHeader').html(convertTimeToMoment(startTime.split('T')[1].split(':')[0], startTime.split('T')[1].split(':')[1]));
                            $('#newBookingModal').removeClass('slds-hide');
                            
                       // }
                    }
                },
                eventRender: function(event, element, view) {
                    if(event.className.includes('bookingNotAvailable')){
                        element.find('.fc-time').remove();
                    }else{
                        var spantext = element.find('.fc-time').children('span').text();
                        if(spantext){
                            spantext = spantext.split('-')[0];
                            element.find('.fc-time').children('span').text(spantext);
                        }
                    }
                    if(event.Type == 'Busy'){
                        element.find('.fc-title').css({"text-overflow":"ellipsis","white-space":"nowrap"});
                        element.attr('title', event.title);
                    }
                    
                    if(element.find(".fc-content").text()){
                        element.find(".fc-content").append('<div id="eventIcons"></div>');
                        if(event.Notes > 0){
                            element.find(".fc-content #eventIcons").append("<span class='closeon' id='sms'><a href='javascript:void(0);'><svg class='slds-button__icon slds-icon_xx-small' aria-hidden='true'><use xlink:href='{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#chat')}'></use></svg></a></span>");
                        }
                        if(event.Status === 'Completed'){
                            element.find(".fc-content #eventIcons").append("<span class='closeon'  id='check'><a href='javascript:void(0);'><svg class='slds-button__icon slds-icon_xx-small' aria-hidden='true'><use xlink:href='{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#check')}'></use></svg></a></span>");
                        }
                        if(event.Status === 'No-show'){
                            element.find(".fc-content #eventIcons").append("<span class='closeon'  id='cross'><a href='javascript:void(0);'><svg class='slds-button__icon slds-icon_xx-small' aria-hidden='true'><use xlink:href='{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#close')}'></use></svg></a></span>");
                        }
                        if(event.Type === 'Regular' && event.Individual == 'false'){
                            element.find(".fc-content #eventIcons").append("<span class='closeon' id='retweet'><a href='javascript:void(0);'><svg class='slds-button__icon slds-icon_xx-small' aria-hidden='true'><use xlink:href='{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#retweet')}'></use></svg></a></span>");
                        }
                        
                        element.find("#sms").on('click', function() {
                            $('#blank').html('sms');
                        });
                        element.find("#retweet").on('click', function() {
                            $('#blank').html('retweet');
                        });
                        element.find("#check").on('click', function() {
                            $('#blank').html('check');
                        });
                    }
                        
                },
                eventDragStart: function(event) {
                    var startTime = event.start.format();
                    originalTime = startTime; 
                },
                eventDrop: function(event, delta, revertFunc) {
                    console.log('event',event.start.format());
                    console.log('originalTime', originalTime);
                    bookingReschedule.Id = event.id;
                    bookingReschedule.Type = event.Type;
                    bookingReschedule.resource = event.resourceId;
                    bookingReschedule.date = event.start.format();
                    bookingReschedule.Individual = event.Individual;
                    bookingReschedule.isRecurrence = 'false';
                    $('#closeRescheduleIconButton').attr('onclick', 'cancelRescheduling();closeRescheduleModal();return false;');
                    if(/* Need to uncomment the code later isDateTimeInFuture(originalTime) && */isEventInTeacherWorkingHour(teacherWorkingHours, event.start.format(), event.end.format(), event.resourceId)/* Need to uncomment the code late && isDateTimeInFuture(event.start.format())*/){
                        if(bookingReschedule.Type == 'Regular' && bookingReschedule.Individual == 'false'){
                           
                            isReschedule = false;
                            $('#confirmModalYes').addClass('slds-hide');
                            $('#confirmModalNo').html('Cancel');
                            $('#confirmModalNo').attr('data-origin', 'reschedule');
                            $('#confirmModalNo').attr('onclick', "$('.confirmModal').addClass('slds-hide');closeRescheduleModal(); return false;");
                            $('#confirmHeader').html('Recurring event');
                            $('#confirmHeader').parent().addClass('slds-text-align_left');
                            $('#confirmBody').addClass('slds-text-align_center');
                            $('#confirmBody').html('<p>Would you like to apply this change to this event only,<br/>or the current and future events in the series?</p><div><button class="slds-button slds-m-around_small slds-p-horizontal_large" style="background: #00b3f0;color:#fff;" id="thisReschedule" onclick="rescheduleThisOnly();return false;">This only</button><button class="slds-button slds-m-around_small slds-p-horizontal_large" style="background: #00b3f0;color:#fff;" id="thisAndFutureReschedule" onclick="rescheduleFutureAlso();return false;">This and future</button></div>');
                            $('#confirmModal').removeClass('slds-hide');
                            
                        }else if(bookingReschedule.Type == 'Busy' && bookingReschedule.Individual == 'false'){
                            $('#confirmModalYes').addClass('slds-hide');
                            $('#confirmModalNo').html('Cancel');
                            $('#confirmModalNo').attr('data-origin', 'reschedule');
                            $('#confirmModalNo').attr('onclick', "$('.confirmModal').addClass('slds-hide');$('#confirmModalYes').removeClass('slds-hide');$('#confirmModalNo').html('No');refreshCalendar();return false;"); 
                            $('#confirmHeader').html('Reschedule Busy Time');
                            $('#confirmHeader').parent().addClass('slds-text-align_left');
                            $('#confirmBody').addClass('slds-text-align_center');
                            $('#confirmBody').html('<p>Would you like to apply this change to this Busy Time only,<br/>or the current and future Busy Time in the series?</p><div><button class="slds-button slds-m-around_small slds-p-horizontal_large" style="background: #00b3f0;color:#fff;" id="thisReschedule" onclick="rescheduleThisOnly();return false;">This only</button><button class="slds-button slds-m-around_small slds-p-horizontal_large" style="background: #00b3f0;color:#fff;" id="thisAndFutureReschedule" onclick="rescheduleFutureAlso();return false;">This and future</button></div>');
                            $('#confirmModal').removeClass('slds-hide');
                        }else if(bookingReschedule.Id){
                            bookingReschedule.isRecurrence = 'false';
                            reschedule();
                        }
                    }else{
                        revertFunc();
                    }
                    
                },
                eventClick:  function(event, jsEvent, view,date) {
                    var status = event.Status;
                    $('#advanceOptionsBtn').remove();
                    $('#timeDuration').html(event.start.format('h:mm a')+ ' - '+event.end.format('h:mm a'));
                    eventId = event.id;
                    
                    if(event.Type != 'Regular' && event.Type != 'Busy'){
                        initEvents(eventId, event.start.format());
                    }else if(event.Type != 'Trial' && event.Type == 'Regular'){
                    
                        $('#button_Group_EditDetails').append('<button class="slds-button slds-button_icon slds-button_icon-border-filled button-shadow" style="margin-left: -34px;width:130px;" title="Advance Actions" aria-pressed="false" id="advanceOptionsBtn" onclick="showAdvanceOptions();return false;" data-id="'+eventId+'">Advance Actions <svg class="slds-button__icon" aria-hidden="true"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#settings')}" /></svg><span class="slds-assistive-text">Advance Actions</span></button>');
                        initEvents(eventId, event.start.format());
                    }else if(event.Type == 'Busy' && eventId){
                        $('.addNewBookingFromBusy').addClass('slds-hide');
                        $('#cancelBooking').attr({'data-id': eventId, 'data-date': event.start.format(), 'data-type': event.Type});
                        $('#rescheduleBusyBookingView').attr({'data-id': eventId, 'data-type': event.Type, 'data-individual': event.Individual});
                        $('#rescheduleBusyBookingView').removeClass('slds-hide');
                        $('#rescheduleBusyBookingView').removeAttr('disabled');
                        $('#rescheduleBusyBookingView').css('pointer-events', '');
                        if(event.category == 'Placeholder'){
                            $('.addNewBookingFromBusy').removeClass('slds-hide');    
                        }
                        $('.addNewBookingFromBusy').css('pointer-events', '');
                        $('.addNewBookingFromBusy').removeAttr('disabled');

                        
                        if(!isDateTimeInFuture(event.start.format())){
                            $('#rescheduleBusyBookingView').css('pointer-events', 'none');
                            $('#rescheduleBusyBookingView').attr('disabled', 'true');
                            $('.addNewBookingFromBusy').css('pointer-events', 'none');
                            $('.addNewBookingFromBusy').attr('disabled', 'true');
                        }
                        getBusyBookingDetails(eventId,event.start.format());
                    }
                    
                    
                    if($('#blank').html() === 'sms' || $('#blank').html() == ''){
                        $('body').css('overflow', 'false');
                        
                    }else{
                        $('#blank').html('');
                    }
                    
                    $('#newBookingNote').click(function(){
                        $('.addNotes').removeClass('slds-hide');
                    });
                },
                
            });
            $('#calendar').fullCalendar('rerenderEvents');
            function isEventInTeacherWorkingHour(eventsjson, startTime, endTime, resourceId){
                var timeSlots = [];
                var isReschedulable = false;
                var teacherWorkings = [];
                for(index in eventsjson){
                    if(eventsjson[index].className == 'teacherWorkingHours' && eventsjson[index].resourceId == resourceId){
                        teacherWorkings.push(eventsjson[index]);
                    }
                }
                $(teacherWorkings).each(function(index, value){
                    if(Date.parse(toJSDate(value.start)) <= Date.parse(toJSDate(startTime)) && Date.parse(toJSDate(value.end)) >= Date.parse(toJSDate(endTime))){
                        isReschedulable = true;
                    }
                });
                return isReschedulable;
            }
            
            
            
            $('.fc-next-button').click(function(e){
                refreshCalendar();
            });
            
            $('.fc-prev-button').click(function(e){
               refreshCalendar();
            });
            
            $('.fc-today-button').click(function(e){
                refreshCalendar();
            });
            
            $('.fc-agendaDay-button').click(function(e){
                $('[id$=teachers]').children().each(function(index, value){
                    if($(this).val() == 'AllRosteredStaff' || $(this).val() == 'AllStaff'){
                        $(this).remove();
                    }
                });
                $('[id$=resources]').children().each(function(index, value){
                    if($(this).val() == 'AllRosteredResource' || $(this).val() == 'AllResource'){
                        $(this).remove();
                    }
                });
                $('[id$=teachers]').children().first().after('<option value="AllRosteredStaff">All rostered staff</option><option value="AllStaff">All staff</option>');
                $('[id$=resources]').children().first().after('<option value="AllRosteredResource">All rostered resources</option><option value="AllResource">All Resources</option>');
                
                var b = $('#calendar').fullCalendar('getDate');
                var bookDate = [b.format('YYYY-MM-DD')];
                if(!$(".teachers").val()){
                    teacher = $(".teachers").val();
                }
                if(!teacher){
                    $(".teachers").val('');
                }
                var calView = $('#calendar').fullCalendar('getView').name;
                var calendarDates = isWeekDay();
                initResources(center, teacher, filter.resource, bookDate, calView, filter.instrument);
                $(this).addClass('fc-state-disabled');
            });
            
            $('.fc-agendaTwoDay-button').click(function(e){
                $('[id$=teachers]').children().each(function(index, value){
                    if($(this).val() == 'AllRosteredStaff' || $(this).val() == 'AllStaff'){
                        $(this).remove();
                    }
                });
                $('[id$=resources]').children().each(function(index, value){
                    if($(this).val() == 'AllRosteredResource' || $(this).val() == 'AllResource'){
                        $(this).remove();
                    }
                });
                
                var b = $('#calendar').fullCalendar('getDate');
                var bookDate = [b.format('YYYY-MM-DD')];
                if(filter.resource == 'AllRosteredResource' || filter.resource == 'AllResource'){
                    $('[id$=resources]').val($('[id$=resources]').children().eq(1).val());
                    filter.resource = $('[id$=resources]').val();
                }else if((!$(".teachers").val() || teacher == 'AllRosteredStaff' || teacher == 'AllStaff') && !filter.resource){
                    $(".teachers").val( $('[id$=teachers]').children().eq(1).val());
                    teacher = $(".teachers").val();
                }
                if(!teacher){
                    $(".teachers").val('');
                }
                var calView = $('#calendar').fullCalendar('getView').name;
                var calendarDates = isWeekDay();
                initResources(center, teacher, filter.resource, calendarDates, calView, filter.instrument);
            });
            
            $('.fc-myCustomButton-button').after('<span class="fc-button fc-button-title fc-state-default fc-state-hover"><input class="slds-input" type="text" id="fullCalendarDate" style="padding: 0px;border: 0px;cursor: pointer;text-align: center;" onchange="getDirectDate();return false;" readonly/></span>');
            $('.fc-myCustomButton-button').remove();
            var b = $('#calendar').fullCalendar('getDate');
            var bookDate = [b.format('YYYY-MM-DD')];
             $( "#fullCalendarDate" ).val(bookDate);
           
              $( "#fullCalendarDate" ).datepicker({
                  numberOfMonths: 2,
                  showButtonPanel: false,
                  dateFormat: "yy-mm-dd"
            });
              
        }
              
        function getDirectDate(){
            var b = $('#fullCalendarDate').val();
            var bookDates = [b];
            
            teacher = $(".teachers").val();
            var calView = $('#calendar').fullCalendar('getView').name;
            datesArray = new Array();
            var dt = moment();
            dt.year(b.split('-')[0]).month(b.split('-')[1] - 1).date(b.split('-')[2]);
            var bookDate = dt.format('YYYY-MM-DD');
            
            var beginOfWeek = dt.startOf('week');
            var start = beginOfWeek.format('YYYY-MM-DD');
            
            var endOfWeek = dt.endOf('week');
            var end = endOfWeek.format('YYYY-MM-DD');
            
            datesArray.push(start);
            datesArray.push(end);
            
            var calendarDates = datesArray;
            if(calView == 'agendaTwoDay'){
                initResources(center, teacher, filter.resource, calendarDates, calView, filter.instrument);
            }else{
                initResources(center, teacher, filter.resource, bookDates , calView, filter.instrument);
            }
        }
        
        function getPackage(package){
            $('#makeupHoursSection').addClass('slds-hide');
            if(package != 'Select Package'){
                bookingData.packageId = package.split('-')[0];
                
            }
            $(createBookingResult.packages).each(function(index6, value6){
                if(bookingData.packageId == value6.id){
                    $('#packageSelect').val(value6.name);
                    $('#getPackageId').removeClass('slds-is-open');
                    if(value6.type == 'Trial'){
                        bookingData.type =  value6.type; // value6.duration;
                        bookingData.duration = value6.duration;   //'30';
                    }else if(value6.duration == 'Trial' && value6.type == 'Home'){
                        bookingData.type = 'home-trial';
                        bookingData.duration = '30';
                    }else if(value6.type == 'Makeup'){
                        bookingData.type = 'Makeup';
                        bookingData.duration = value6.duration;
                    }else if(value6.type == 'Adhoc'){
                        bookingData.type = value6.type;
                        bookingData.duration = value6.duration;
                    }    
                    
                }
            });
            var duration = package;
            var type = '';
            if(duration){
                $(createBookingResult.packages).each(function(index2, value2){
                    if(value2.id == duration.split('-')[0]){
                        type = value2.type;
                    }   
                     
                });
            
                if(duration.split('-')[1] == 'Trial'){
                    $('#durationLabel').html('30 min');
                    $('#adhoc_method_section').addClass('slds-hide');
                     $('#makeupHoursSection').addClass('slds-hide');
                     $('#recurringSection').addClass('slds-hide');
                }else if(type  == 'Makeup'){
                    $('#durationLabel').html(duration.split('-')[1] + ' min');
                    $('#makeupHoursSection').removeClass('slds-hide');
                    $('#recurringSection').removeClass('slds-hide');
                }else if(type  == 'Adhoc'){
                    $('#durationLabel').html(duration.split('-')[1] + ' min');
                     $('#recurringSection').removeClass('slds-hide');
                }else{
                     $('#durationLabel').html(duration.split('-')[1] + ' min');
                     $('#adhoc_method_section').addClass('slds-hide');
                     $('#makeupHoursSection').addClass('slds-hide');
                     $('#recurringSection').addClass('slds-hide');
                }
                
            }else{
                $('#durationLabel').html('');
            }
        }        
        
        function newAppointmentPopup(centerid, teacherid, dateOfAppointment){
            $("#busyBookingViewModal").addClass('slds-hide');
            
            Visualforce.remoting.Manager.invokeAction(
                '{!$RemoteAction.AureusCalendarClone.getTeacherAndCenter}',
                centerid, teacherid,
                function(result, event){
                    var msg = '';
                    if (event.status) {
                        $('#newBookingModal').addClass('slds-hide'); 
                        var eventResult = JSON.parse(result.replace(/(&quot\;)/g,"\""));
                        createBookingResult = eventResult;
                        var packages = '';
                        $('#dateLabel').html(convertDateToMoment(dateOfAppointment.split('T')[0]));
                        $('#timeLabel').html(convertTimeToMoment(dateOfAppointment.split('T')[1].split(':')[0], dateOfAppointment.split('T')[1].split(':')[1]));
                        $(eventResult.entities).each(function(index, value){
                            if(value.type == 'Centre'){
                                $('#centerNameLabel').html(value.name);
                            }else if(value.type == 'Teacher'){      
                                $('#saveNewBooking').attr('data-teacher', value.id);        
                            }
                            
                        });
                        $('#saveNewBooking').attr('data-date', dateOfAppointment);
                        
                        var setOfPackageType = new Set();
                        var packageBody = [];
                        $(eventResult.packages).each(function(index1, value1){
                            
                            if(value1.type){
                                setOfPackageType.add(value1.type);
                            }
                            
                        });
                        for(let setValue of setOfPackageType){
                            packageBody[setValue] = '<ul class="slds-listbox slds-listbox_vertical" role="group" aria-label="'+setValue+'"> <li role="presentation" class="slds-listbox__item"><div id="'+setValue+'" class="slds-media slds-listbox__option slds-listbox__option_plain slds-media_small" role="presentation"><h3 class="slds-listbox__option-header" role="presentation">'+setValue+'</h3></div></li>';
                        }
                        
                        $(eventResult.packages).each(function(index1, value1){
                            if(value1.type){
                                packageBody[value1.type] += '<li role="presentation" class="slds-listbox__item"><div id="'+value1.id+'-'+value1.duration+'" onclick="getPackage($(this).attr(\'id\'));return false;" class="slds-media slds-listbox__option slds-listbox__option_plain slds-media_small" role="option"><span class="slds-media__figure slds-listbox__option-icon"></span><span class="slds-media__body"><span class="slds-truncate" title="'+value1.name+'">'+value1.name+'</span></span></div></li>';
                            }
                        });
                        
                        for(let Value of setOfPackageType){
                            packageBody[Value] += '</ul>';
                            packages += packageBody[Value];
                            
                        }
                        $('#selectPackageListSection').append(packages);
                        
                        $('#newBookingDetails').removeClass('slds-hide');
                        
                        
                        $('#studentInput').keyup(function(){
                            var student_name = $(this).val();
                            var studentListItem = '';
                            setTimeout(function(){
                                Visualforce.remoting.Manager.invokeAction(
                                    '{!$RemoteAction.AureusCalendarClone.getStudents}',
                                    student_name,
                                    function(result, event){
                                        var ResultOfEvent = JSON.parse(result.replace(/(&quot\;)/g,"\""));
                                        $(ResultOfEvent).each(function(index3, value3){
                                            studentListItem += '<li role="presentation" class="slds-listbox__item " id="'+value3.id+'"><div id="option'+(index3+1)+'" class="slds-media slds-listbox__option slds-listbox__option_entity slds-listbox__option_has-meta student-list" role="option"><span class="slds-media__body">';
                                            studentListItem += '<span class="slds-listbox__option-text slds-listbox__option-text_entity studentNameLabel">'+value3.label+'</span><span class="slds-listbox__option-meta slds-listbox__option-meta_entity">  '+value3.parentName+'</span></span></div></li>';
                                        });
                                        $('#studentSelectContainer').removeClass('slds-is-open');
                                        $('#studentSelectContainer').attr('aria-expanded', 'false');
                                        $('#studentSearchList').empty();
                                        $('#studentSearchList').append(studentListItem); 
                                        
                                        $('#studentSelectContainer').addClass('slds-is-open');
                                        $('#studentSelectContainer').attr('aria-expanded', 'true');
                                        if(ResultOfEvent.length == 0){
                                            $('#studentSelectContainer').removeClass('slds-is-open');
                                            $('#studentSelectContainer').attr('aria-expanded', 'false');
                                            $('#studentSearchList').empty();
                                            $('#parentInput').removeAttr('disabled');
                                            $('#phoneInput').removeAttr('disabled');
                                            $('#emailInput').removeAttr('disabled');
                                            $('#parentInput').val('');
                                            $('#phoneInput').val('');
                                            $('#emailInput').val('');
                                        }
                                        
                                        $('.student-list').click(function(){
                                            var studentId = $(this).parent().attr('id');
                                            $(ResultOfEvent).each(function(index4, value4){
                                                if(value4.id == studentId){
                                                    bookingData.studentId = value4.id;
                                                    if(value4.label){
                                                        $('#studentInput').val(value4.label);
                                                    }else{
                                                        $('#studentInput').val('');
                                                    }
                                                    
                                                    if(value4.parentName){
                                                        $('#parentInput').val(value4.parentName);
                                                    }else{
                                                        $('#parentInput').val('');
                                                    }
                                                    
                                                    if(value4.phone){
                                                        $('#phoneInput').val(value4.phone);
                                                    }else{
                                                        $('#phoneInput').val('');
                                                    }
                                                    
                                                   if(value4.email){
                                                        $('#emailInput').val(value4.email);
                                                    }else{
                                                        $('#emailInput').val('');
                                                    }
                                                    $('#makeupHoursLabel').html(value4.makeupHours+' min');
                                                    $('#parentInput').attr('disabled', '');
                                                    $('#phoneInput').attr('disabled', '');
                                                    $('#emailInput').attr('disabled', '');
                                                    $('#studentSelectContainer').removeClass('slds-is-open');
                                                    $('#studentSelectContainer').attr('aria-expanded', 'false');
                                                    $('#studentSearchList').empty();
                                                }                                
                                            });
                                            
                                        });
                                        
                                        
                                        
                                    }, 
                                    {escape: true}
                                ); 
                                
                            }, 500);
                        });
                    }
                },
                {escape: true}
            );
            
            
        }
        
        function closeRescheduleModal(){
            $('.editDetails').addClass('slds-hide');
            refreshEditAppointment(); 
            $('.popupDetails').removeClass('slds-hide'); 
            resetTabs();
            refreshCalendar();
        }
        function refreshNewBookingPopup(){
            bookingData = {};
            $('#saveNewBooking').css('pointer-events', '');
        
            $('#centerNameLabel').html('');
            $('#dateLabel').html('');
            $('#timeLabel').html('');
            $('#packageSelect').val('');
            $('#durationLabel').html('');
            $('#parentInput').val('');
            $('#phoneInput').val('');
            $('#emailInput').val(''); 
            $('#studentInput').val('');
            $('#parentInput').removeAttr('disabled');
            $('#phoneInput').removeAttr('disabled');
            $('#emailInput').removeAttr('disabled');
            $('#adhoc_method_section').addClass('slds-hide');
            $('#makeupHoursSection').addClass('slds-hide');
            $('.repeatSelection').addClass('slds-hide');
            $('#recurringSection').addClass('slds-hide');
            $('#makeupHoursErrorMsg').text('');
            $('#recurrenceOccure').empty();
            $('#onSelectedDate').val('');
            $('#totalNoOfBookings').html('');
            $('#afterRadio').prop('checked', true);
            $('#makeupHoursLabel').text('');
            $('#repeatSelect').val('None');
            $('#afterRadio').prop('checked');
            $('#selectPackageListSection').empty();
            $('#getPackageId').removeClass('slds-is-open');
            $('#repeatSelectBusy').val('None');
        }
        
        
         $('#paymentRadio').change(function(index, value){
            if($(paymentRadio).prop( "checked" )){
                $('#makeupHoursSection').addClass('slds-hide');
            }
        });
        
        $('#completeBooking').click(function(){
            if(!$(this).attr('disabled')){
                $('.editDetails').addClass('slds-hide');
                var bookingId = $(this).attr('data-id');
                var type = $(this).attr('data-type');
                var status = $(this).attr('data-status');
                $('#confirmModalYes').attr({'data-id':bookingId, 'data-type':type, 'data-status':status, 'data-origin':'bookingComplete'});
                $('#confirmModalNo').removeAttr('data-origin');
                $('#confirmHeader').html('Complete This Appointment');
                $('#confirmBody').html('Do you want to complete this Appointment?');
                $('#confirmModal').removeClass('slds-hide');
            }
            
        });
        $('#noShowBooking').click(function(){
            if(!$(this).attr('disabled')){
                $('.editDetails').addClass('slds-hide');
                var bookingId = $(this).attr('data-id');
                var type = $(this).attr('data-type');
                var status = $(this).attr('data-status');
                $('#confirmModalNo').removeAttr('data-origin');
                $('#confirmModalYes').attr({'data-id':bookingId, 'data-type':type, 'data-status':status, 'data-origin':'bookingNoShow'});
                $('#confirmHeader').html('No-show This Appointment');
                $('#confirmBody').html('Do you want to No-show this Appointment?');
                $('#confirmModal').removeClass('slds-hide');
            }
        });
        function updateBooking(id, start, end, teacherId, isplaceholder, isFuture){
           if(id && start && bookingReschedule.Type){
                if(bookingReschedule.Type != 'Busy'){
                    $('#confirmHeader').html('Email Confirmation');
                    $('#confirmModalNo').html('No');
                    $('#confirmModalYes').removeClass('slds-hide');
                    $('.editDetails').addClass('slds-hide');
                    $('#confirmBody').html('Do you want to send an email?');
                    $('#confirmModal').removeClass('slds-hide');
                    $('#confirmModalYes').attr({'data-id': id, 'start': start, 'end': end, 'teacherId': teacherId, 'isplaceholder': isplaceholder, 'isFuture': isFuture, 'data-origin': 'update'});
                    $('#confirmModalNo').attr({'data-id': id, 'start': start, 'end': end, 'teacherId': teacherId, 'isplaceholder': isplaceholder, 'isFuture': isFuture, 'data-origin': 'update'});
                }else{
                    Visualforce.remoting.Manager.invokeAction(
                        '{!$RemoteAction.AureusCalendarClone.updateBooking}',
                        id, start, end, teacherId, isplaceholder, isFuture, 'false', caseId, 
                        function(result, event){
                            var msg = '';
                            if (event.status) {
                            
                                $('.editDetails').addClass('slds-hide');
                                isReschedule = false;
                                $('#confirmModalNo').html('No');
                                $('#confirmHeader').parent().removeClass('slds-text-align_left');
                                $('#confirmBody').removeClass('slds-text-align_center');
                                $('#confirmModalYes').removeClass('slds-hide');
                                $("#rescheduleClose").trigger("click");
                                if(bookingReschedule.scheduleType == 'commitEmail'){
                                    $('#confirmModalYes').attr('data-origin', 'email');
                                    $('#confirmModalYes').trigger('click');
                                }else if(bookingReschedule.scheduleType == 'commit'){
                                    if(result.caseId){
                                        redirectToCaseRecord(result.caseId); 
                                    }else{
                                        refreshCalendar();
                                    }
                                }else{
                                    $('.confirmModal').removeClass('slds-hide');
                                    $('#confirmBody').html('Do you want to send an email?');
                                    $('#confirmHeader').html('Email Confirmation');
                                    $('#confirmModalYes').attr('data-origin','email');
                                    $('#confirmModalNo').attr('data-origin','email');
                                    $('#confirmModalYes').removeAttr('data-starttime');
                                    $('#confirmModalYes').removeAttr('data-resourceid'); 
                                    $('#confirmModalYes').removeAttr('data-endtime');
                                }
                                bookingReschedule.Id = '';
                                bookingReschedule.Type = '';
                                bookingReschedule.resource = '';
                                bookingReschedule.date = '';
                                bookingReschedule.Individual = '';
                                bookingReschedule.isRecurrence = '';
                                bookingReschedule.scheduleType = '';
                                
                                
                            }
                        },
                        {buffer: false, escape: true}
                    );
                }
            }
        }
        function rescheduleThisOnly(){
            bookingReschedule.isRecurrence = 'false';
            reschedule();
        }
        function rescheduleFutureAlso(){
            bookingReschedule.isRecurrence = 'true';
            reschedule();
        }
        function reschedule(){
            $('#commitChanges').remove();
            $('#commitEmail').remove(); 
            $('#cancelChanges').remove();
            Visualforce.remoting.Manager.invokeAction(
                '{!$RemoteAction.AureusCalendarClone.showRescheduledBookings}',
                bookingReschedule,
                function(result, event){
                    var msg = '';
                    if (event.status) {
                        if(result){
                            $('#detailPopupTitle').html('Rescheduled Appointment');
                            $('#confirmModal').addClass('slds-hide');
                            var eventResult = JSON.parse(result.replace(/(&quot\;)/g,"\""));
                            $('.editCustomerDetails').attr('data-id', eventResult.studentId);
                            
                            if(eventResult.parentId){
                                $('.editCustomerDetails').attr('data-parentId', eventResult.parentId);
                            }else{
                                $('.editCustomerDetails').attr('data-parentId', eventResult.studentId);
                            }
                            $('#teacherNameEditPopup').html(eventResult.staffMember);
                            $('#teacherNameEditPopup').attr('hrrf','/'+eventResult.staffMember);
                            
                            $('#cancelBooking').attr('data-id',eventResult.Id);
                            $('#cancelBooking').attr('data-type',eventResult.type);
                            $('#lesson').text(eventResult.service);
                            $('#teacherName').text(eventResult.staffMember);
                            $('#resource').text(eventResult.resource);
                            $('#dateAndTime').text(eventResult.dateAndTime);
                            $('.sendEmail').attr('data-bookingId', eventResult.Id);
                            
                            if(eventResult.parentId){
                                $('.sendEmail').attr('data-parentId', eventResult.parentId);
                            }else{
                                $('.sendEmail').attr('data-parentId', eventResult.studentId);
                            }
                            
                            $('#statusIconOnEdit').empty();
                            $('#statusLabelOnEdit').text(eventResult.status);
                            if(eventResult.status == 'Scheduled'){
                                $('#statusIconOnEdit').append('<svg class="slds-button__icon" aria-hidden="true"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#clock')}" /></svg>');
                            }else if(eventResult.status == 'Pending'){
                                $('#statusIconOnEdit').append('<svg class="slds-button__icon" aria-hidden="true"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#reminder')}" /></svg>');
                            }else if(eventResult.status == 'Completed'){
                                $('#statusIconOnEdit').append('<svg class="slds-button__icon" aria-hidden="true"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#check')}" /></svg>');
                            }else if(eventResult.status == 'No-show'){
                                $('#statusIconOnEdit').append('<svg class="slds-button__icon" aria-hidden="true"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#close')}" /></svg>');
                            }else if(eventResult.status == 'Canceled'){
                                $('#statusIconOnEdit').append('<svg class="slds-button__icon" aria-hidden="true"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#clear')}" /></svg>');
                            }
                            
 
                            
                            var dateTime = eventResult.dateAndTime;
                            var res;
                            if(dateTime){
                                res =  dateTime.split("T"); 
                                $('#date').text(convertDateToMoment(res[0]));
                                $('#time').text(convertTimeToMoment(res[1].split(':')[0], res[1].split(':')[1]));
                                $('#serviceTime').text(convertTimeToMoment(res[1].split(':')[0], res[1].split(':')[1]));
                            }
                            $('#tab-default-2__item').addClass('slds-hide');
                            $('#tab-default-3__item').addClass('slds-hide');
                            $('#tab-default-5').addClass('slds-hide');
                            $('#enrolmentDetailSection').addClass('slds-hide');
                            $('#advanceDetailsSection').addClass('slds-hide');
                            $('.studentImg').attr('src','/servlet/servlet.FileDownload?file='+eventResult.teacherAttachmentId+'');
                            $('#duration').text(eventResult.duration);
                            $('#price').text(eventResult.price);
                            $('#totalPrice').text('$'+eventResult.price);
                            
                            $('#lessonOnCancel').text(eventResult.service);
                            $('#teacherOnCancel').text(eventResult.staffMember);
                            $('#dateAndTimeOnCancel').text(eventResult.dateAndTime);
                            $('#name').text(eventResult.studentFirstName+' '+eventResult.studentLastName+' - '+eventResult.parentFirstName +' '+eventResult.parentLastName);                                
                            $('#name1').text(eventResult.studentFirstName+' '+eventResult.studentLastName);
                            $('#parentname1').text(eventResult.parentFirstName +' '+eventResult.parentLastName);
                            $('.popupDetails').removeClass('slds-hide');
                            if(eventResult.rType == 'Lesson'){
                                $('#selectStudio').addClass('slds-hide');
                            }else if(eventResult.rType == 'Facility'){
                                $('#selectTeacher').addClass('slds-hide');
                            }
                            $('#fname').val(eventResult.studentFirstName);
                            $('#lname').val(eventResult.studentLastName);
                            $('#telephone').val(eventResult.parentPhone);
                            $('#parentsms').val(eventResult.parentMobile);
                            $('#parentEmail').val(eventResult.parentEmail);
                            
                            $('#parentfname').val(eventResult.parentFirstName);
                            $('#parentlname').val(eventResult.parentLastName);
                            $('#popoverTitle').text(eventResult.studentFirstName+ ' '+eventResult.studentLastName + ' - ' +eventResult.parentFirstName+ ' '+eventResult.parentLastName);
                            
                            $('#phone').text(eventResult.parentMobile);
                            $('#email').text(eventResult.parentEmail);
                            
                            $('#studentName').text(eventResult.studentFirstName+ ' '+eventResult.studentLastName);
                            $('#parentName').text(eventResult.parentFirstName+ ' '+eventResult.parentLastName);
                            $('#parentMobile').text(eventResult.parentMobile);
                            $('#parentPhone').text(eventResult.parentPhone);
                            $('#parentEmail').text(eventResult.parentEmail);
                            $('#servicePackagName').text(eventResult.service);
                            $('#serviceStaff').text(eventResult.staffMember);
                            $('#serviceResource').text(eventResult.resource);
                            $('#serviceDuration').text(eventResult.duration);
                            
                            $('#servicePrice').text(eventResult.price);
                            $('.editDetails').removeClass('slds-hide');
                            $('.editBooking').addClass('slds-hide');
                            $('#noShowBooking').addClass('slds-hide');
                            $('#completeBooking').addClass('slds-hide');
                            $('#cancelBooking').addClass('slds-hide');
                            var addbuttons = '<button class="slds-button slds-button_icon slds-button_icon-border-filled button-shadow" aria-pressed="false" id="commitChanges" onclick="commit();return false;">Confirm Changes</button>';
                            addbuttons +='<button class="slds-button slds-button_icon slds-button_icon-border-filled button-shadow" aria-pressed="false" id="cancelChanges" onclick="cancelRescheduling();return false;">Cancel</button>';
                            $('#button_Group_reschedule').removeClass('slds-size_5-of-12');
                            $('#button_Group_reschedule').addClass('slds-size_12-of-12');
                            $('#completeBooking').after(addbuttons);
                            $('#cancelChanges').attr('onclick','cancelRescheduling();closeRescheduleModal();return false;');
                        }  
                    }
                },
                {escape: true}
            );
            
        }
        
        function sendTrialEnrollment(bookingId){
            if(bookingId){
                 Visualforce.remoting.Manager.invokeAction(
                '{!$RemoteAction.AureusCalendarClone.sendEnrolmentLinkByCase}',
                caseId, bookingId, 'Trial', 
                    function(result, event){
                        if(result){
                            redirectToCaseRecord(result);  
                        }else{
                              $('#enrolmentUpdatePopup').addClass('slds-hide');
                              $('#toastMsg').html('Some Error Occurred...');
                              $('.toastclass').removeClass('slds-theme_success');
                              $('.toastclass').addClass('slds-theme_error');
                              toastLaunch();
                              refreshCalendar();   
                        }                        
                    }
                 );
                 
                 
               /*  Visualforce.remoting.Manager.invokeAction(
                '{$RemoteAction.AureusCalendarController.getParentId}',
                bookingId,
                    function(result, event){
                        $('.sendEmail').attr({'data-parentId': result, 'data-bookingId': bookingId});
                        $('#trialBookingClickModal').addClass('slds-hide');
                        $('.sendEmail').removeClass('slds-hide');
                        
                    }
                 );*/
            }
            
        }
        
        function commit(){
            bookingReschedule.scheduleType = 'commit';
            if((bookingReschedule.Type == 'Regular' || bookingReschedule.Type == 'Busy') && bookingReschedule.isRecurrence == 'false' && bookingReschedule.Individual == 'true'){
                updateBooking(bookingReschedule.Id, bookingReschedule.date, '', bookingReschedule.resource, 'false', 'false');
            }else if((bookingReschedule.Type == 'Regular' || bookingReschedule.Type == 'Busy') && bookingReschedule.Individual == 'false' && bookingReschedule.isRecurrence == 'false'){
                if(bookingReschedule.Type == 'Regular'){
                    updateBooking(bookingReschedule.Id, bookingReschedule.date, '', bookingReschedule.resource, 'true', 'false');
                }else{
                    updateBooking(bookingReschedule.Id, bookingReschedule.date, '', bookingReschedule.resource, 'false', 'false');
                }
                
            }else if((bookingReschedule.Type == 'Regular' || bookingReschedule.Type == 'Busy') &&  bookingReschedule.isRecurrence == 'true'){
                updateBooking(bookingReschedule.Id, bookingReschedule.date, '', bookingReschedule.resource, 'false', 'true');
            }else if(bookingReschedule.Type != 'Regular'){
                updateBooking(bookingReschedule.Id, bookingReschedule.date, '', bookingReschedule.resource, 'false', 'false');
            }
            
        }
        function commitAndEmail(){
            bookingReschedule.scheduleType = 'commitEmail';
            if(bookingReschedule.Type == 'Regular' && bookingReschedule.isRecurrence == 'false' && bookingReschedule.Individual == 'true'){
                updateBooking(bookingReschedule.Id, bookingReschedule.date, '', bookingReschedule.resource, 'false', 'false');
            }else if(bookingReschedule.Type == 'Regular' && bookingReschedule.Individual == 'false' && bookingReschedule.isRecurrence == 'false'){
                updateBooking(bookingReschedule.Id, bookingReschedule.date, '', bookingReschedule.resource, 'true', 'false');
            }else if(bookingReschedule.Type != 'Regular'){
                updateBooking(bookingReschedule.Id, bookingReschedule.date, '', bookingReschedule.resource, 'false', 'false');
            }else if(bookingReschedule.Type == 'Regular' &&  bookingReschedule.isRecurrence == 'true'){
                updateBooking(bookingReschedule.Id, bookingReschedule.date, '', bookingReschedule.resource, 'false', 'true');
            }
        }
        function cancelRescheduling(){
            $('.editDetails').addClass('slds-hide');
            bookingReschedule.Id = '';
            bookingReschedule.Type = '';
            bookingReschedule.resource = '';
            bookingReschedule.date = '';
            bookingReschedule.Individual = '';
            bookingReschedule.isRecurrence = '';
            bookingReschedule.scheduleType = '';
            isReschedule = false;
            $('#containerMessage').addClass('slds-hide');
            
        }
        function refreshEditAppointment(){
            $('#tab-default-2__item').removeClass('slds-hide');
            $('#tab-default-3__item').removeClass('slds-hide');
            $('.editBooking').removeClass('slds-hide');
            $('#commitChanges').remove();
            $('#commitEmail').remove(); 
            $('#cancelChanges').remove();
            $('#noShowBooking').removeClass('slds-hide');
            $('#cancelBooking').removeClass('slds-hide');
            $('#completeBooking').removeClass('slds-hide');
            $('#detailPopupTitle').html('Appointment Details');
            $('#repeatAppointment').removeClass('slds-hide');
            $('#hr-editAppointment').removeClass('slds-hide');
            $('#completeEnrollment').remove();
            $('.custBtn').css("width", "130px");
            $('#button_Group_reschedule').removeClass('slds-size_12-of-12');
            $('#button_Group_reschedule').addClass('slds-size_5-of-12');
            $('#requestDateEdit').html('');
            $('#effectiveDateEdit').html('');
            $('#noticeStartEdit').html('');
            $('#noticeEndEdit').html('');
            $('#processTypeEdit').html('');
            $('#newPackageEdit').html('');
            $('#newPackageEdit').attr('href','');
        }
        function toastLaunch(){
            if($("#ToastMessage").hasClass('slds-hide')){
                $("#ToastMessage").removeClass('slds-hide');
            }else{
                $("#ToastMessage").addClass('slds-hide');
            }
            setTimeout(function(){
                $("#ToastMessage").addClass('slds-hide');
                $('.toastclass').removeClass('slds-theme_error');
                $('.toastclass').addClass('slds-theme_success');
            }, 6000);
            
        }
        function initChange(){
            var flag = false;
            var teacherId = '';
            $(".teachers").change(function(){
               getTeacher($('[id$=teachers]').val());
               teacherId = $(this).val();
               center = $('.centerList').val();   
               refreshCalendar();
            });
            
            $('[id$=resources]').change(function(){
               var calView = $('#calendar').fullCalendar('getView').name;
               if(calView == 'agendaTwoDay'){
                   if(!filter.resource){
                       getResource(filter.resource);
                   }else if(filter.resource){
                       $('[id$=resources]').children().each(function(index, value){
                           if($(this).val() == filter.resource){
                               flag = true;
                           }
                       }); 
                       if(flag){
                           getResource(filter.resource);
                       }else{
                           $('[id$=resources]').children().each(function(index, value){
                               if($(this).val()){
                                   $('[id$=resources]').val($(this).val());
                                   return false;
                               }
                           });
                            getResource($('[id$=resources]').val());
                            filter.resource = $(this).val();
                       }
                   } 
               }
               center = $('.centerList').val();   
               refreshCalendar();
            });
        }
        
        function showAdvanceOptions(){
            $('#downgradeSubscriptionBtn').removeAttr('disabled');
            $('#downgradeSubscriptionBtn').attr('title', 'Downgrade Subscription');
            $('#downgradeSubscriptionBtn').css('pointer-events', '');
           
            $('#cancelSubscriptionBtn').removeAttr('disabled');
            $('#cancelSubscriptionBtn').attr('title', 'Cancel Subscription');
            $('#cancelSubscriptionBtn').css('pointer-events', '');
            $('.editDetails').addClass('slds-hide');
            var bookingId = $('#advanceOptionsBtn').attr('data-id');
            Visualforce.remoting.Manager.invokeAction(
            '{!$RemoteAction.AureusCalendarClone.getAdvanceDetails}',
            bookingId,
                function(result, event){
                    if (event.status) {
                       if(result){
                           $('#packageNameAdvance').html(result.packageName);
                           if(result.startDate){
                               var arr = result.startDate.split('-');
                               $('#subscriptionDateAdvance').html(convertDateToMoment(arr[2]+'-'+arr[1]+'-'+arr[0]));
                           }
                           if(result.isPackagePromotional){
                               $('#downgradeSubscriptionBtn').attr('disabled', 'true');
                               $('#downgradeSubscriptionBtn').attr('title', 'Current Package is Promotional type');
                               $('#downgradeSubscriptionBtn').css('pointer-events', 'none');
                               
                               $('#cancelSubscriptionBtn').attr('disabled', 'true');
                               $('#cancelSubscriptionBtn').attr('title', 'Current Package is Promotional type');
                               $('#cancelSubscriptionBtn').css('pointer-events', 'none');
                           }
                           
                           $('#frequencyAdvance').html(result.frequency);
                           $('#timeslotAdvance').html(result.timeSlot);
                           $('#confirmWithdrawal').attr('data-id', result.id);
                           $('#cancelSubscriptionBtn').attr({'data-id': result.id, 'data-timeslot': result.timeSlot});
                           $('#upgradeSubscriptionBtn').attr('data-id', result.id);
                           $('#downgradeSubscriptionBtn').attr('data-id', result.id);
                           $('#submitUpgradeRequest').attr({'data-id': result.id, 'data-packageId': result.packageId});
                           $('#submitDowngradeRequest').attr({'data-id': result.id, 'data-packageId': result.packageId});
                           $('#advanceOptionPopup').removeClass('slds-hide');
                       }
                    }
                },
                {escape: true}
            );
            
        }
        
        function refreshAdvancePopup(){
            $('#packageNameAdvance').html('');
            $('#subscriptionDateAdvance').html('');
            $('#frequencyAdvance').html('');
            $('#timeslotAdvance').html('');
        }
        
        function upgradeSubscription(){
            $('#confirmUpgradeEnrolment').css('pointer-events', 'auto');
            $('#confirmUpgradeEnrolment').removeAttr('disabled');
            
            $('#availableTimeSlots').empty();
            $('#availableTimeSlots').append('<option>Select Time Slot</option>');
            $('#availableTimeSlots').attr('disabled', true);
            $('#selectRequestedPackage').empty();
            $('#effectiveDateInput').val('');
            $('#upgradePackageSelectError').html('');
            $('#effectiveDateError').html('');
            $('#submitUpgradeRequest').css('pointer-events','');
            $('#submitUpgradeRequest').removeAttr('disabled');
            $('#advanceOptionPopup').addClass('slds-hide');
             $('#availableTimeSlotsError').html('');
             $('#effectiveDateInput').empty();
            var bookingId = $('#upgradeSubscriptionBtn').attr('data-id');
            Visualforce.remoting.Manager.invokeAction(
            '{!$RemoteAction.AureusCalendarClone.getUpgradedDetails}',
            bookingId,
                function(result, event){
                    if (event.status) {
                       if(result){
                           $('#submitUpgradeRequest').attr('data-enrolDay', result.LessonDay);
                           $('#currentPackageName').html(result.packageName);
                           if(result.LessonDay){
                               var dates = [];
                               var week = result.LessonDay.substring(0, 3);
                               dates = getWeekDayDates(week, 2);
                               var selectDate = '<option value="">Select an Option</option>';
                               $(dates).each(function(inex, value){
                                   selectDate += '<option value="'+value.value+'">'+value.label+'</option>';
                               });
                               $('#effectiveDateInput').append(selectDate);
                           }
                           var str = '<option>Select an Option</option>';
                           $(result.packages).each(function(index, value){
                               str += '<option value="'+value.id+'">'+value.name+'</option>';
                           });
                           $('#selectRequestedPackage').append(str);
                           
                           $('#gradeSubscriptionPopup').removeClass('slds-hide');
                       }
                    }
                },
                {escape: true}
            );
        }
        
        function downgradeSubscription(){
            $('#confirmDowngradeEnrolment').css('pointer-events', 'auto');
            $('#confirmDowngradeEnrolment').removeAttr('disabled');
            $('#availableTimeSlotsDowngrade').empty();
            $('#availableTimeSlotsDowngrade').append('<option>Select Time Slot</option>');
            $('#availableTimeSlotsDowngrade').attr('disabled', true);
            $('#selectRequestedPackageDowngrade').empty();
            $('#advanceOptionPopup').addClass('slds-hide');
            $('#effectiveDateInputDowngrade').val('');
            //$('#noticePeriodDowngradeStart').html('');
            //$('#noticePeriodDowngradeEnd').html('');
            $('#effectiveDateInputDowngrade').empty();
            $('#submitDowngradeRequest').css('pointer-events','');
            $('#submitDowngradeRequest').removeAttr('disabled');
            $('#downgradePackageSelectError').html('');
            $('#effectiveDateErrorDowngrade').html('');
            $('#availableTimeSlotsDowngradeError').html('');
            var bookingId = $('#downgradeSubscriptionBtn').attr('data-id');
            Visualforce.remoting.Manager.invokeAction(
            '{!$RemoteAction.AureusCalendarClone.getDowngradedDetails}',
            bookingId,
                function(result, event){
                    if (event.status) {
                       if(result){
                           console.log('Result...',result);
                           $('#submitDowngradeRequest').attr('data-enrolDay', result.LessonDay);
                           $('#currentPackageNameDowngrade').html(result.packageName);
                           if(result.LessonDay){
                               var dates = [];
                               var week = result.LessonDay.substring(0, 3);
                               var add30 = moment();
                               if(userDetail.Designation__c != 'Regional Manager'){
                                   add30.add(30, 'days');  
                               }else{
                                    add30.add(1, 'days');   
                               }
                               
                               dates = getWeekDayDates(week, 3);
                               var selectDate = '<option value="">Select an Option</option>';
                               $(dates).each(function(index, value){
                                   if(moment(value.value) > add30){
                                       selectDate += '<option value="'+value.value+'">'+value.label+'</option>';
                                   }
                                   
                               });
                               $('#effectiveDateInputDowngrade').append(selectDate);
                           }
                           var str = '<option value="Downgrade Subscription">Select an Option</option>';
                           $(result.packages).each(function(index, value){
                               str += '<option value="'+value.id+'">'+value.name+'</option>';
                           });
                           $('#selectRequestedPackageDowngrade').append(str);
                           $('#downgradePopup').removeClass('slds-hide');
                       }
                    }
                },
                {escape: true}
            );
        }         
        
        function teacherChange(){
            window.setTimeout(function(){
                var calView = $('#calendar').fullCalendar('getView').name;
                if(calView == 'agendaDay'){
                    if(filter.teacher){
                        $("[id$=teachers]").val('AllRosteredStaff'); 
                    }else if(filter.resource){
                        $("[id$=resources]").val('AllRosteredResource');
                    }
                   
                }else if(calView == 'agendaTwoDay'){
                   $("[id$=teachers] option[value='AllRosteredStaff']").remove();
                   $("[id$=teachers] option[value='AllStaff']").remove();
                   $("[id$=resources] option[value='AllRosteredResource']").remove();
                   $("[id$=resources] option[value='AllResource']").remove();
                } 
                if(filter.teacher){
                    $(".teachers").change(); 
                }else if(filter.resource){
                    $("[id$=resources]").change();
                }
             
                 
            },10);
        }
        
        function getCenter(centerVal){
            filter.center = centerVal;
        }
        function getTeacher(teacherVal){
            //filter.instrument = '';
            filter.teacher = teacherVal;
            
            if(filter.teacher){
                teacherResourceToggler('teacher');
            }
        }
        function getResource(resourceVal){
            filter.resource = resourceVal;
            if(filter.resource){
                teacherResourceToggler('resource');
            }
            refreshCalendar();
        } 
        
        function getInstrument(ins){
            filter.instrument = ins;
            instruments = ins;
            $('.confirmModal').addClass('slds-hide');
            refreshCalendar();
        }
        
        function teacherResourceToggler(toggle){
            if(toggle == 'teacher'){
                $('[id$=resources]').val('');
            }else if(toggle == 'resource'){
                $('[id$=teachers]').val(''); 
            } 
            filter.teacher = $('[id$=teachers]').val(); 
            filter.resource = $('[id$=resources]').val();
        }
        
        function isWeekDay(datesArray){
            datesArray = new Array();
            var currentDate = $('#calendar').fullCalendar('getDate');
            var bookDate = currentDate.format('YYYY-MM-DD');
            
            var beginOfWeek = currentDate.startOf('week');
            var start = beginOfWeek.format('YYYY-MM-DD');
            
            var endOfWeek = currentDate.endOf('week');
            var end = endOfWeek.format('YYYY-MM-DD');
            
            datesArray.push(start);
            datesArray.push(end);
            return datesArray;
        }
        
        function completedOrNoShow(bookingId, type, status){
            if(status && bookingId && type){
                Visualforce.remoting.Manager.invokeAction(
                    '{!$RemoteAction.AureusCalendarClone.completedOrNoShow}',
                    bookingId, type, status, 
                    function(result, event){
                        if (event.status) {
                            if(result){
                                $('.confirmModal').addClass('slds-hide');
                                refreshCalendar();
                            }
                        }
                    }, 
                    {escape: true}
                );
            }
        }  
        
         //Use to create new bookings
        function createBooking(){
            var dateOfBooking = $('#saveNewBooking').attr('data-date');
            bookingData.Repeat = $('#repeatSelect').val();
            if(bookingData.Repeat == 'None'){
                bookingData.isRecurring = 'false';
            }else{
                bookingData.isRecurring = 'true';
            }
             
            bookingData.RepeatEvery = $('#repeatWeek').val();
            if($('#afterRadio').prop('checked')){
                bookingData.EndsAfter = $('#recurrenceOccure').val();
            }else if($('#onRadio').prop('checked')){
                bookingData.EndsOn = $('#onSelectedDate').val();
            }
            
            $('#saveNewBooking').css('pointer-events','none');
            bookingData.date = dateOfBooking;
            $(createBookingResult.entities).each(function(index5, value5){
                if(value5.type == 'Centre' && value5.name == $('#centerNameLabel').text()){
                    bookingData.centerId = value5.id;
                }else if(value5.type == 'Teacher' && value5.name){
                    bookingData.teacherId = value5.id;
                }
            });
            bookingData.availableHours = $('#makeupHoursLabel').text().split(' ')[0];
            if(bookingData.type == 'home-trial'){
            
                validationOnCreationOfHomeTrialBookings(bookingData);
            }else if(bookingData.type == 'Makeup' && bookingData.isRecurring == 'false'){
                if(parseInt(bookingData.duration) > parseInt($('#makeupHoursLabel').text().split(' ')[0])){
                    $('#saveNewBooking').css('pointer-events','');
                    $('#makeupHoursErrorMsg').text('Insufficient Makup minutes');
                }else{
                    createBookingProceed();  
                }
            }else if(bookingData.type == 'Adhoc'){
                $('#newBookingDetails').addClass('slds-hide');
                if(bookingData.isRecurring == 'false'){
                    showAdhocBookings(bookingData.studentId, bookingData.packageId, bookingData.date.split('T')[0], bookingData.date.split('T')[1], 1);
                }else if(bookingData.isRecurring == 'true'){
                    countOfBookings(bookingData);
                }
                
            }else{
                createBookingProceed();
            }
           
        }
        
        function showAdhocBookings(student, package, dateOfAppointment, timeOfAppointment, recurring){
            $('#countOfBookingTableBody').empty();
            var teacherId = $('#saveNewBooking').attr('data-teacher');
             Visualforce.remoting.Manager.invokeAction(
                    '{!$RemoteAction.AureusCalendarClone.getPackageDetail}',
                    student, package, teacherId, 
                    function(result, event){
                        if (event.status) {
                            var trRow = '';
                            var total = 0;
                            var gstTotal = 0;       
                            if(timeOfAppointment){      
                                var formmatedTime = convertTimeToMoment(timeOfAppointment.split(':')[0], timeOfAppointment.split(':')[1]);      
                            }
                            $('#studentNameadhoc').html(result.studentFirstName + ' ' + result.studentLastName);
                            $('#teacherNameAdhoc').html(result.teacherName);
                            $('#centerNameadhoc').html(result.centerName);
                            $('#packageDurationadhoc').html(result.duration + ' min');
                            $('#createAdhocBookingBtn').attr({'data-package': result.packageId, 'data-centerId': filter.center, 'data-teacherId': result.teacherId, 'data-studentId': result.studentId, 'data-count': recurring, 'data-date': dateOfAppointment+'T'+timeOfAppointment});
                            
                            for(var i=1; i<=recurring; i++){
                                total += result.unitFee;
                                trRow += '<tr class="slds-hint-parent"><td data-label="Sr.No"><div class="slds-truncate" title="Sr.No">'+i+'</div></td><td data-label="Package Name"><div class="slds-truncate" title="Package Name">'+result.packageName+'</div></td><td data-label="Package Time"><div class="slds-truncate" title="Package Time">'+formmatedTime+'</div></td><td data-label="Package Price"><div class="slds-truncate" title="Package Price">$'+result.unitFee+'</div></td></tr>';
                            } 
                            
                            gstTotal = (total * {!$Label.GST_Tax_Rate} / 100);
                                                       
                            trRow += '<tr class="slds-hint-parent"><td  colspan="2"></td><td data-label="GST"><b>GST({!$Label.GST_Tax_Rate}%)</b></td><td>$'+gstTotal.toFixed(2)+'</td></tr><tr class="slds-hint-parent"><td colspan="2"></td><td data-label="total"><b>Total</b></td><td>$'+(total + gstTotal).toFixed(2)+'</td></tr>';
                            $('#countOfBookingTableBody').append(trRow);
                            $('#newAdhocDetailPopup').removeClass('slds-hide');
                        }
                    }, 
                    {escape: true}
                );
        }
        
        function createAdhocBookings(){
            $('#createAdhocBookingBtn').attr('disabled', 'true');
            $('#createAdhocBookingBtn').css('pointer-events', 'none');
            var packageId = $('#createAdhocBookingBtn').attr('data-package');
            var teacherId = $('#createAdhocBookingBtn').attr('data-teacherId');
            var studentId = $('#createAdhocBookingBtn').attr('data-studentId');
            var recurring = $('#createAdhocBookingBtn').attr('data-count');
            var bookDate = $('#createAdhocBookingBtn').attr('data-date');
            var center = $('#createAdhocBookingBtn').attr('data-centerId');
            Visualforce.remoting.Manager.invokeAction(
                '{!$RemoteAction.AureusCalendarClone.createAdhocBookings}',
                packageId, center,teacherId, studentId, recurring, bookDate,    
                function(result, event){
                    if (event.status) {
                        if(result){
                             $('#newAdhocDetailPopup').addClass('slds-hide');
                             $('#createAdhocBookingBtn').removeAttr('disabled');
                            $('#createAdhocBookingBtn').css('pointer-events', '');
                             $('#toastMsg').html('Ad-hoc Bookings are successfully created...');
                             toastLaunch();
                             refreshCalendar();
                             refreshNewBookingPopup();
                        }else{
                             $('#newAdhocDetailPopup').addClass('slds-hide');
                             $('#createAdhocBookingBtn').removeAttr('disabled');
                             $('#createAdhocBookingBtn').css('pointer-events', '');
                             $('#toastMsg').html('Cannot create Bookings Payment process unsucceeded..');
                             $('.toastclass').removeClass('slds-theme_success');
                             $('.toastclass').addClass('slds-theme_error');
                             toastLaunch();
                             refreshNewBookingPopup();
                        }
                       
                    }
                }, 
                {escape: true}
            );
        }
        
        function countOfBookings(bookingObj){
            if(bookingObj.isRecurring == 'false'){
                showAdhocBookings(bookingObj.studentId, bookingObj.packageId, bookingObj.date.split('T')[0], bookingObj.date.split('T')[1]);
            }else if(bookingObj.isRecurring == 'true'){
                Visualforce.remoting.Manager.invokeAction(
                    '{!$RemoteAction.AureusCalendarClone.getCountOfBookings}',
                    bookingObj,
                    function(result, event){
                        if (event.status) {
                            showAdhocBookings(bookingData.studentId, bookingData.packageId, bookingData.date.split('T')[0], bookingData.date.split('T')[1], result);
                             
                        }
                    }, 
                    {escape: true}
                );
            }
        }
        
        function validationOnCreationOfHomeTrialBookings(bookingObj){
            if(bookingObj.duration == 30 && bookingObj.type == 'home-trial'){
                Visualforce.remoting.Manager.invokeAction(
                    '{!$RemoteAction.AureusCalendarClone.getEventsRealTime}',
                    teacher, filter.resource, center, bookingObj.date.split('T')[0], filter.instrument,
                    function(result, event){
                        if (event.status) {
                            var canCreate = false;
                            eventsOfCalendar = JSON.parse(result.replace(/(&quot\;)/g,"\""));
                            canCreate = checkAnyBusyBookings(bookingObj);
                            if(canCreate == true){
                                createBookingProceed();
                            }else{
                                $('#newBookingDetails').addClass('slds-hide');
                                refreshNewBookingPopup();
                                 $('#toastMsg').html('Cannot create Booking Please Remove Existing Booking..');
                                 $('.toastclass').removeClass('slds-theme_success');
                                 $('.toastclass').addClass('slds-theme_error');
                                 toastLaunch();
                            }
                        }
                    }, 
                    {escape: true}
                );
                               
            }
        }
        
        function checkAnyBusyBookings(bookingObj){
            
            var iscorrect = true;
            var startJsDate = toJSDate(bookingObj.date);
            startJsDate.setMinutes(startJsDate.getMinutes() - 30);
            var jsDate = Date.parse(startJsDate);
            startJsDate.setMinutes(startJsDate.getMinutes() + 60);
            var jsDateEnd = Date.parse(startJsDate);
            
            $(eventsOfCalendar).each(function(i, v){
                var start = Date.parse(toJSDate(v.start));
                var end = Date.parse(toJSDate(v.end));
                if((start <= jsDate && end >= jsDateEnd) || (jsDate <= start && jsDateEnd >= end) || (jsDate > start && jsDateEnd > end && jsDate < end) || (jsDate < start && jsDateEnd < end && jsDateEnd > start)){
                    iscorrect = false;
                    return false;
                }
            });
            return iscorrect;
        }
        
        function createBookingProceed(){ 
            $('.confirmModal').removeClass('slds-hide');
            $('#confirmBody').html('Do you want to send an email?');
            $('#confirmHeader').html('Email Confirmation');
            $('#confirmModalYes').attr('data-origin','createBooking');
            $('#confirmModalNo').attr('data-origin','createBooking');
            $('#newBookingDetails').addClass('slds-hide');
            //$('#confirmModalYes').attr('data-id', bookingId);
            //$('#confirmModalNo').attr('data-id', bookingId);
            //$('#confirmModalYes').attr('cancelReason', $('#cancelReason').val());
            //$('#confirmModalNo').attr('cancelReason', $('#cancelReason').val());
            /*var bookingDataStr = JSON.stringify(bookingData);
            
            Visualforce.remoting.Manager.invokeAction(
                '{$RemoteAction.AureusCalendarClone.createBooking}',
                bookingDataStr, caseId,
                function(result, event){
                    console.log('@@@result', result);
                    if (event.status) {
                        if('caseId' in result){
                            redirectToCaseRecord(result.caseId);    
                        }else if(result.msg == 'false'){
                            $('#newBookingDetails').addClass('slds-hide');
                            refreshNewBookingPopup();
                            $('.confirmModal').removeClass('slds-hide');
                            $('#confirmBody').html('Do you want to send an email?');
                            $('#confirmHeader').html('Email Confirmation');
                            $('#confirmModalYes').attr('data-origin','email');
                            $('#confirmModalNo').attr('data-origin','email');
                        }else if(result.msg == 'duration'){
                            $('#saveNewBooking').css('pointer-events','');
                            $('#makeupHoursErrorMsg').text('Insufficient Makup minutes');
                        }else if(result.msg == 'existing'){
                            $('#newBookingDetails').addClass('slds-hide');
                            refreshNewBookingPopup();
                             $('#toastMsg').html('Cannot create Booking Please Remove Existing Bookings..');
                             $('.toastclass').removeClass('slds-theme_success');
                             $('.toastclass').addClass('slds-theme_error');
                             toastLaunch();
                        }
                    }
                    
                }
            );*/
        
        }
        
        function sendEmail(){
            var subject = $('#emailSubject').html();
            var body = $('#templateOutput').html();
            var parentId = $('.sendEmail').attr('data-parentId');
            /*Visualforce.remoting.Manager.invokeAction(
                '{$RemoteAction.AureusCalendarClone.sendEmail}',
                subject,body, parentId, 
                function(result, event){
                    if (event.status) {
                    } else if (event.type === 'exception') {
                        document.getElementById("responseErrors").innerHTML = 
                            event.message + "<br/>\n<pre>" + event.where + "</pre>";
                    } else {
                        document.getElementById("responseErrors").innerHTML = event.message;
                    }
                }, 
                {escape: true}
            );*/
        }
        
        function resetTabs(){
            bookingReschedule.Id = '';
            bookingReschedule.Type = '';
            bookingReschedule.resource = '';
            bookingReschedule.date = '';
            bookingReschedule.Individual = '';
            bookingReschedule.isRecurrence = '';
            bookingReschedule.scheduleType = '';
            $('.customTabs li').removeClass('slds-active');
            $('.customTabs li').first().addClass('slds-active');
            $('.slds-tabs--default__content').addClass('slds-hide');
            $('.slds-tabs--default__content').first().removeClass('slds-hide');
        }
        
        function showTimeOnResourceColumn(listOfResource, view){
            if(!$("tr .fc-widget-content:nth-child(2)").html()){
                var width = Number($('.fc-day-header').width())+3;
                var width1 = Number($('.fc-day').width())+3;
                
                for(var i = 0; i < listOfResource; i++){
                    var left = $("tr .fc-widget-content:nth-child(2)").parent().parent().find('.fc-time').width() + 10;
                    if(view == 'week'){
                        $( "tr .fc-widget-content:nth-child(2)").append('<td class="temp-cell" style="border: 0px; width:'+(width)+'px; text-align: right; position: relative; right:0px;"></td>');
                    }else{
                       $( "tr .fc-widget-content:nth-child(2)").append('<td class="temp-cell" style="border: 0px; width:'+(width1)+'px; text-align: right; padding-right: 10px; position: relative; right:0px;height:50x;"></td>');
                    }
                }
                $("tr .fc-widget-content:nth-child(2)").children('.temp-cell').each(function(){
                    if($(this).parent().parent().find('.fc-time span').html()){
                        $(this).html($(this).parent().parent().find('.fc-time span').html());
                    }
                });
                
            }
        }
        function closeUpDownSummary(){
            let origin = $('#updownsummaryclose').attr('data-origin');
            if(origin == 'upgrade'){
                $('#summaryPopForUpDown').addClass('slds-hide');
                $('#gradeSubscriptionPopup').removeClass('slds-hide');
            }else if(origin == 'downgrade'){
                
                $('#downgradeDetailsSection').addClass('slds-hide');
                $('#summaryPopForUpDown').addClass('slds-hide');
                $('#downgradePopup').removeClass('slds-hide');
            }
        }
        /*function upgradeSummary (origin){
            var error = false;
            if(origin == 'upgrade'){
                var bookingId = $('#submitUpgradeRequest').attr('data-id');
                var oldPackageId = $('#submitUpgradeRequest').attr('data-packageid');
                var newPackageId = $('#selectRequestedPackage').val();
                var effectiveDate = $('#effectiveDateInput').val();
                var today = moment();
                if(bookingId && oldPackageId){
                    if(newPackageId == "Select an Option"){
                        $('#upgradePackageSelectError').html('Please select the package...');
                        error = true;
                    }else{
                        $('#upgradePackageSelectError').html('');
                    }
                    
                    if(!effectiveDate){
                        $('#effectiveDateError').html('Select the effective date....');
                        error = true;
                    }else{
                        var effectiveDateMoment = moment();
                        effectiveDateMoment.year(effectiveDate.split('/')[2]).month(effectiveDate.split('/')[0] - 1).date(effectiveDate.split('/')[1]);
                        if(today.diff(effectiveDateMoment) > 0){
                            $('#effectiveDateError').html('Select Future effective date....');
                            error = true;
                        }else{
                            $('#effectiveDateError').html('');
                        }
                    }
                }
            }else if(origin == 'downgrade'){
                var bookingId = $('#submitDowngradeRequest').attr('data-id');
                
                var startDate = $('#submitDowngradeRequest').attr('startDate');
                var endDate = $('#submitDowngradeRequest').attr('endDate'); // this is last lesson date
                var newPackageId = $('#selectRequestedPackageDowngrade').val();
                var oldPackageId =  $('#submitDowngradeRequest').attr('data-packageid');
                var requestDate = $('#effectiveDateInputDowngrade').val();
                var effectiveDate = $('#submitDowngradeRequest').attr('effectiveDate');
                
                $('#summaryRequestDate1').html(convertDateToMoment(new Date(requestDate)));
                $('#summaryEffectiveLessonDate').html(convertDateToMoment(new Date(effectiveDate)));
                $('#summaryNoticeStartDate1').html(convertDateToMoment(new Date(startDate)));
                $('#summaryNoticeEndDate1').html(convertDateToMoment(new Date(endDate)));
                                
                if(newPackageId == 'Downgrade Subscription'){
                    $('#downgradePackageSelectError').html('Please select any package!');
                    isError = true;
                }else{
                    $('#downgradePackageSelectError').html('');
                }
            
                if(!requestDate){
                    $('#effectiveDateErrorDowngrade').html('Please select the date!');
                    isError = true;
                }
                if(!startDate || !effectiveDate){
                    $('#effectiveDateErrorDowngrade').html('Please define Notice Period!');
                    isError = true;
                }
            }
            
            if(!error){
               $('#updownsummaryclose').attr('data-origin',origin);
               Visualforce.remoting.Manager.invokeAction(
                '{$RemoteAction.AureusCalendarClone.getUpgradeDowngradeSummary}',
                    bookingId,oldPackageId,newPackageId,effectiveDate,
                    function(result, event){
                        if(result){
                            $('#oldPackageName').html(result.oldPack.Name);
                            $('#newPackageName').html(result.newPack.Name);
                            $('#lessonWithOldPackage').html(result.noOfBookingWithOldPack);
                            $('#lessonWithNewPackage').html(result.noOfBookingWithNewPack);
                                
                            if(origin == 'upgrade'){
                                $('#summaryPopForUpDown').removeClass('slds-hide');
                                $('#gradeSubscriptionPopup').addClass('slds-hide');
                            }else if(origin == 'downgrade'){
                                $('#downgradeDetailsSection').removeClass('slds-hide');
                                $('#summaryPopForUpDown').removeClass('slds-hide');
                                $('#downgradePopup').addClass('slds-hide');
                            }
                        }
                    });  
            }
            
        }*/
        function submitUpgradePackageRequest(){
            var error = false;
            var bookingId = $('#submitUpgradeRequest').attr('data-id');
            var oldPackageId = $('#submitUpgradeRequest').attr('data-packageid');
            var newPackageId = $('#selectRequestedPackage').val();
            var effectiveDate = $('#effectiveDateInput').val();
            var availableTimeSlot = $('#availableTimeSlots').val();
            var today = moment();
            if(bookingId && oldPackageId){
                if(newPackageId == "Select an Option"){
                    //$('#upgradePackageSelectError').html('Please select the package...');
                    error = true;
                }else{
                    $('#upgradePackageSelectError').html('');
                }
                
                if(!effectiveDate){
                    //$('#effectiveDateError').html('Select the effective date....');
                    error = true;
                }else{
                    var effectiveDateMoment = moment();
                    effectiveDateMoment.year(effectiveDate.split('/')[2]).month(effectiveDate.split('/')[0] - 1).date(effectiveDate.split('/')[1]);
                    if(today.diff(effectiveDateMoment) > 0){
                       // $('#effectiveDateError').html('Select Future effective date....');
                        error = true;
                    }else{
                        $('#effectiveDateError').html('');
                    }
                    
                }
                
                if(availableTimeSlot == "Select Time Slot"){
                    error = true;
                }else{
                    $('#availableTimeSlotsError').html('');
                }
                if(!error){
                    $('#gradeSubscriptionPopup').addClass('slds-hide');
                    $('#upgradeDowngradeSummaryModal').addClass('slds-hide');
                    $('#confirmUpgradeEnrolment').css('pointer-events','none');
                    $('#confirmUpgradeEnrolment').attr('disabled','true');
                    /*$('.confirmModal').removeClass('slds-hide');
                    $('#confirmBody').html('Do you want to send an email?');
                    $('#confirmHeader').html('Email Confirmation');*/
                    
                    $('#confirmModalYes').attr({'data-origin': 'upgrade', 'data-id': bookingId, 'data-date': effectiveDate, 'data-newPackage': newPackageId, 'data-oldPackage': oldPackageId, 'data-timeslot' :availableTimeSlot});
                    //$('#confirmModalNo').attr({'data-origin': 'upgrade', 'data-id': bookingId, 'data-date': effectiveDate, 'data-newPackage': newPackageId, 'data-oldPackage': oldPackageId, 'data-timeslot' :availableTimeSlot});
                    $('#confirmModalYes').trigger('click');
                } 
            }
        }
        
        /*function updatePackageCallout(bookingId, effectiveDate, newPackageId, oldPackageId, caseRedirect){
            Visualforce.remoting.Manager.invokeAction(
            '{$RemoteAction.AureusCalendarClone.updatePackageRequestCallout}',
                bookingId, effectiveDate, newPackageId, oldPackageId, caseId, caseRedirect, 
                function(result, event){
                    $('#upgradeDowngradeSummaryModal').addClass('slds-hide');
                    if(!result && result != 'error'){
                         $('#toastMsg').html('Request logged successfully');
                         $('.toastclass').addClass('slds-theme_success');
                         $('.toastclass').removeClass('slds-theme_error');
                         toastLaunch();
                    }else if(!result){
                        redirectToCaseRecord(result);
                    }else if(result == 'error'){
                         $('#toastMsg').html('Request failure!<br/>Please try again....');
                         $('.toastclass').removeClass('slds-theme_success');
                         $('.toastclass').addClass('slds-theme_error');
                         toastLaunch();
                    }
                    refreshCalendar();
                }
            );
        }*/
        
        function addBusyTimeFunc(){
            $('#descriptionErrorBusyCreate').html('');
            $('#categorySelectBusyCreateError').html('');
            $('#repeatSelectBusy').val('None');
            $('#repeatSelectBusy').change();
            $('#descriptionBusyCreate').val('');
            $('#newBookingModal').addClass('slds-hide');
            $('#durationSelectBusyCreate').empty();
            var centerId = $('#addBusyTime').attr('data-centerid');
            var source = $('#addBusyTime').attr('data-source');
            var centerName = $('.centerList option:selected').text();
            var teacherId =  $('#addBusyTime').attr('data-teacherid');
            var teacherName;
            if(source == 'teacher'){
                $('.teachers option').each(function(index, value){
                    if(value.value == teacherId){
                        teacherName = $(this).text();
                    }
                });
                $('#staffResourceBusyCreate').html('Staff');
            }else if(source == 'resource'){
                $('[id$=resources] option').each(function(index, value){
                    if(value.value == teacherId){
                        teacherName = $(this).text();
                    }
                });
                $('#staffResourceBusyCreate').html('Resource');
            }
            
            
            var time = $('#addBusyTime').attr('data-date');
            var selectDuration = '';
            for(var i=15;i<=120;i=i+15){
                selectDuration += '<option value="'+i+'">'+i+' Mins</option>';
            }
            selectDuration += '<option value="180">'+'180 Mins</option>';
            selectDuration += '<option value="240">'+'240 Mins</option>';
            selectDuration += '<option value="300">'+'300 Mins</option>';
            selectDuration += '<option value="360">'+'360 Mins</option>';
            selectDuration += '<option value="420">'+'420 Mins</option>';
            selectDuration += '<option value="480">'+'480 Mins</option>';
            selectDuration += '<option value="540">'+'540 Mins</option>';
            selectDuration += '<option value="600">'+'600 Mins</option>';
            
            
            $('#centerNameBusyCreate').html(centerName);
            $('#durationSelectBusyCreate').append(selectDuration);
            $('#staffBusyCreate').html(teacherName);
            $('#timeSlotBusyCreate').html(convertDateToMoment(time.split('T')[0]) + ' '+ convertTimeToMoment(time.split('T')[1].split(':')[0], time.split('T')[1].split(':')[1]));
            
            
            $('#saveBusyBookingCreate').attr({'data-centerId': centerId, 'data-teacherId': teacherId, 'data-date': time, 'data-source': source});
            $('#categorySelectBusyCreate').empty();
            var categoryStr = '<option value="">Select Category</option>';
            if(source == 'teacher'){
                Visualforce.remoting.Manager.invokeAction(
                    '{!$RemoteAction.AureusCalendarClone.getPickListValues}',
                    'Booking__c', 'Category__c', 
                    function(result, event){
                        if(result){
                            $(result).each(function(index, value){
                                categoryStr += '<option value="'+value+'">'+value+'</option>'
                            });
                            $('#categorySelectBusyCreate').append(categoryStr);
                            $('#busyBookingCreateModal').removeClass('slds-hide');
                        }
                    }, 
                    {escape: true}
                );
            }else if(source == 'resource'){
                Visualforce.remoting.Manager.invokeAction(
                    '{!$RemoteAction.AureusCalendarClone.getPickListValues}',
                    'Booking__c', 'Resource_Category__c', 
                    function(result, event){
                        if(result){
                            $(result).each(function(index, value){
                                categoryStr += '<option value="'+value+'">'+value+'</option>'
                            });
                            $('#categorySelectBusyCreate').append(categoryStr);
                            $('#busyBookingCreateModal').removeClass('slds-hide');
                        }
                    }, 
                    {escape: true}
                );
            }
                        
        }
        
        
        function getCancelRequestDateFunc(){
            var timeslot = $('#cancelSubscriptionBtn').attr('data-timeslot');
            var bookingId = $('#cancelSubscriptionBtn').attr('data-id');
            $('#confirmWithdrawal').attr('data-id', bookingId );
            var effectiveDate = $('#cancelRequestEndDate').val();
            var endDate;
            var lastLessonDate;
            if(effectiveDate){
               endDate = new moment(effectiveDate.split('/')[2]+'-'+effectiveDate.split('/')[0]+'-'+effectiveDate.split('/')[1]);
            }else{
                $('#submitCancelRequest').attr('disabled', 'true');
                $('#lastLessonDate').html('');
            }
            if(timeslot){
                timeslot = timeslot.split(' ')[1];
                timeslot = timeslot.substr(0,3);
            }
            for(;;){
                if(endDate.format('ddd').toUpperCase() == timeslot){                   
                    lastLessonDate = convertDateToMoment(endDate.format('YYYY-MM-DD'));
                    $('#submitCancelRequest').attr('lastLessonDate', endDate.format('YYYY-MM-DD'));
                    $('#confirmWithdrawal').attr('lastLessonDate', endDate.format('YYYY-MM-DD'));
                    break;
                }
                endDate.subtract(1, 'days');
            }
            $('#lastLessonDate').html(lastLessonDate);
            $('#submitCancelRequest').removeAttr('disabled');
            
            //yyyy-mm-dd
            
            
            /*if($('#cancelByRequestDate').prop('checked') && bookingId && effectiveDate){
                Visualforce.remoting.Manager.invokeAction(
                '{$RemoteAction.AureusCalendarClone.getNoticePeriod}',
                 bookingId, effectiveDate, 
                    function(result, event){
                        if(result){
                            if('startDate' in result && 'endDate' in result && 'effectiveDate' in result){
                                var startDate = moment(result.startDate);
                                var endDate = moment(result.endDate);
                                var effectiveDate = moment(result.effectiveDate);
                                $('#noticePeriodStart').html(startDate.format('ddd, MMM DD YYYY'));
                                $('#noticePeriodEnd').html(endDate.format('ddd, MMM DD YYYY'));
                                $('#lastLessonDate').val(endDate.format('MM/DD/YYYY'));
                                $('#submitCancelRequest').attr({'startDate' : startDate.format('YYYY-MM-DD'), 'endDate' : endDate.format('YYYY-MM-DD'), 'effectiveDate': effectiveDate.format('YYYY-MM-DD')});                               
                            }else if('error' in result){
                            }
                        }
                    }    
                );
            }*/
        }
        
        /*function getLastLessonDateFunc(){
            var bookingId = $('#cancelSubscriptionBtn').attr('data-id');
            var effectiveDate = $('#lastLessonDate').val();   
            if($('#cancelByLessonEndDate').prop('checked')){
                Visualforce.remoting.Manager.invokeAction(
                '{$RemoteAction.AureusCalendarClone.getNoticePeriodByEndDate}',
                 bookingId, effectiveDate, 
                    function(result, event){
                        if(result){
                            if('startDate' in result && 'endDate' in result && 'requestDate' in result && 'effectiveDate' in result){
                                var startDate = moment(result.startDate);
                                var endDate = moment(result.endDate);
                                var effectivDate = moment(result.effectiveDate);
                                var requestDate = moment(result.requestDate);
                                $('#noticePeriodStart').html(startDate.format('ddd, MMM DD YYYY'));
                                $('#noticePeriodEnd').html(endDate.format('ddd, MMM DD YYYY'));
                                $('#cancelRequestEndDate').val(requestDate.format('MM/DD/YYYY'));
                                $('#submitCancelRequest').attr({'startDate' : startDate.format('YYYY-MM-DD'), 'endDate' : endDate.format('YYYY-MM-DD'), 'effectivDate' : effectivDate.format('YYYY-MM-DD')});                               
                            }else if('error' in result){
                            }
                        }
                    }    
                );
            }
        }*/
        
        function saveBusyBookingFunc(){
            $('#busyBookingCreateModal').addClass('slds-hide');
            var centerId = $('#saveBusyBookingCreate').attr('data-centerid');
            var teacherId =  $('#saveBusyBookingCreate').attr('data-teacherid');
            var time = $('#saveBusyBookingCreate').attr('data-date');
            var source = $('#saveBusyBookingCreate').attr('data-source');
            var countOfOccurence = 0;
            $('#descriptionErrorBusyCreate').html('');
            $('#categorySelectBusyCreateError').html('');
            var errorFlag = false;
            if($('#repeatSelectBusy').val() == 'None'){
                countOfOccurence = 1;
            }else if($('#repeatSelectBusy').val() == 'Weeks'){
                if($('#afterRadioBusy').prop('checked')){
                    countOfOccurence = $('#recurrenceOccureBusy').val();
                }else if($('#onRadioBusy').prop('checked')){
                    var dt = $('#onSelectedDateBusy').val();
                    var startDate = moment(time.split('T')[0]);
                    var duplicate = moment(time.split('T')[0]);
                    var enddate = moment();
                    if(dt){
                        enddate.year(dt.split('/')[2]).month(dt.split('/')[0] - 1).date(dt.split('/')[1]);
                        while(startDate <= enddate){
                            if(startDate.format('ddd') == duplicate.format('ddd')){
                                countOfOccurence++;
                            }
                            startDate.add(1, 'days');
                        }
                    }
                    
                    
                }
            }
            
            if($('#categorySelectBusyCreate').val() == 'Others' && !$('#descriptionBusyCreate').val()){
                errorFlag = true;
                $('#descriptionErrorBusyCreate').html('Please Fill The Description. If Reason Is Other...');
            }
            
            if(!$('#categorySelectBusyCreate').val()){
                errorFlag = true;
                $('#categorySelectBusyCreateError').html('Please Select The Category....');
            }
            if(!errorFlag){
                Visualforce.remoting.Manager.invokeAction(
                '{!$RemoteAction.AureusCalendarClone.createBusyAppointments}',
                    centerId, teacherId, time, $('#durationSelectBusyCreate').val(), $('#descriptionBusyCreate').val(), $('#categorySelectBusyCreate').val(), countOfOccurence, source, 
                    function(result, event){
                        if(!result){
                            
                            $('#descriptionBusyCreate').val('');
                            refreshCalendar();
                        }
                    }
                );
            }
            
        }
        
        /*function cancelBy(){
            if($('#cancelByRequestDate').prop('checked')){
                $('#cancelRequestDate').removeAttr('disabled');
                $('#lastLessonDate').attr('disabled',true);
                $('#lastLessonDate').val('');
            }else if($('#cancelByLessonEndDate').prop('checked')){
                $('#cancelRequestDate').attr('disabled',true);
                $('#lastLessonDate').removeAttr('disabled');
                $('#cancelRequestDate').val('');
            }
            if($('#lastLessonDate').val() == '' && $('#cancelRequestDate').val() == ''){
                $('#noticePeriodStart').text('');
                $('#noticePeriodEnd').text('');
            }
        }*/
        
        function getBusyBookingDetails(bookingId, startTime){
            $('#centerNameBusyView').html('');
            $('#timeSlotBusyView').html('');
            $('#durationBusyView').html('');
            $('#staffBusyView').html('');
            $('#descriptionBusyView').val('');
            $('#categoryBusyView').html('');
            if(bookingId){
                 Visualforce.remoting.Manager.invokeAction(
                '{!$RemoteAction.AureusCalendarClone.getBusyBookingDetails}',
                 bookingId,
                    function(result, event){
                        if(result){
                            if(result.origin == 'teacher'){
                                $('#staffResourceBusyView').html('Staff');
                            }else if(result.origin == 'resource'){
                                $('#staffResourceBusyView').html('Resource');
                            }
                            $('#centerNameBusyView').html(result.center);
                            $('#categoryBusyView').html(result.category);
                            if(result.timeOfBooking){
                                $('#timeSlotBusyView').html(convertDateToMoment(result.timeOfBooking.split(' ')[0])+ ' '+result.timeOfBooking.split(' ')[1]);
                            }
                            
                            $('#durationBusyView').html(result.duration + ' mins');
                            $('#staffBusyView').html(result.teacher);
                            $('#descriptionBusyView').val(result.discription);
                            
                            $('.addNewBookingFromBusy').attr({'data-centerId' : result.centerId, 'data-teacherId' : result.teacherId, 'data-date' : startTime});
                            
                            $('#busyBookingViewModal').removeClass('slds-hide');
                        }
                    }    
                );
            }
        }
        
        function cancelBusyAppointment(){
            $('#busyBookingViewModal').addClass('slds-hide');
            //$('#confirmModalYes').removeClass('slds-hide');
            /*$('#busyBookingViewModal').addClass('slds-hide');
            $('#cancelBooking').trigger( "click" );*/
            $('#confirmModalYes').addClass('slds-hide');
            $('#confirmModalNo').html('Cancel');
            $('#confirmModalNo').attr('data-origin', 'cancelBusy');
            $('#confirmHeader').html('Cancel Busy Time');
            $('#confirmHeader').parent().addClass('slds-text-align_left');
            $('#confirmBody').addClass('slds-text-align_center');
            $('#confirmBody').html('<p>Would you like to apply this changes to this Time only,<br/>or the current and future Time in the series?</p><div><button class="slds-button slds-m-around_small slds-p-horizontal_large" style="background: #00b3f0;color:#fff;" id="thisCancelBusy" onclick="cancelBusyBooking(false);return false;">This only</button><button class="slds-button slds-m-around_small slds-p-horizontal_large" style="background: #00b3f0;color:#fff;" id="thisAndFutureCancelBusy" onclick="cancelBusyBooking(true);return false;">This and future</button></div>');
            $('#confirmModal').removeClass('slds-hide');
        }
        
        /*function getNoticePeriod(){
            $('#noticePeriodDowngradeStart').html('');
            $('#noticePeriodDowngradeEnd').html('');
            $('#effectiveDateErrorDowngrade').html('');
            $('#submitDowngradeRequest').removeAttr('startDate');
            $('#submitDowngradeRequest').removeAttr('endDate');
            $('#submitDowngradeRequest').removeAttr('effectiveDate');
            
            var bookingId = $('#downgradeSubscriptionBtn').attr('data-id');
            var effectiveDate = $('#effectiveDateInputDowngrade').val();
            if(effectiveDate){
                var today = moment();
                var dt = moment();
                dt.year(effectiveDate.split('/')[2]).month(effectiveDate.split('/')[0] - 1).date(effectiveDate.split('/')[1]);
                if(today.diff(dt) > 0){
                }
            }
            if(bookingId && effectiveDate){
                 Visualforce.remoting.Manager.invokeAction(
                '{$RemoteAction.AureusCalendarClone.getNoticePeriod}',
                 bookingId, effectiveDate, 
                    function(result, event){
                        if(result){
                            if('startDate' in result && 'endDate' in result && 'effectiveDate' in result){
                                var startDate = moment(result.startDate);
                                var endDate = moment(result.endDate);
                                var effectiveDate = moment(result.effectiveDate);
                                $('#noticePeriodDowngradeStart').html(startDate.format('ddd, MMM DD YYYY'));
                                $('#noticePeriodDowngradeEnd').html(endDate.format('ddd, MMM DD YYYY'));
                                $('#submitDowngradeRequest').attr({'startDate' : startDate.format('YYYY-MM-DD'), 'endDate' : endDate.format('YYYY-MM-DD'), 'effectiveDate' : effectiveDate.format('YYYY-MM-DD')});                               
                            }else if('error' in result){
                                $('#effectiveDateErrorDowngrade').html(result.error);
                            }
                        }
                    }    
                );
             }
             
        }*/
        
        function submitDowngradePackageRequest(){
            var isError = false;
            var bookingId = $('#submitDowngradeRequest').attr('data-id');
            var newPackageId = $('#selectRequestedPackageDowngrade').val();
            var requestDate = $('#effectiveDateInputDowngrade').val();
            var oldPackageId = $('#submitDowngradeRequest').attr('data-packageid');
            var timeslot = $('#availableTimeSlotsDowngrade').val();
            if(newPackageId == 'Downgrade Subscription'){
                //$('#downgradePackageSelectError').html('Please select any package!');
                isError = true;
            }
            
            if(!requestDate){
                //$('#effectiveDateErrorDowngrade').html('Please select the date!');
                isError = true;
            }
            
            if(timeslot == 'Select Time Slot'){
                isError = true;
            }
            
            if(!isError){
                $('#confirmDowngradeEnrolment').css('pointer-events','none');
                $('#confirmDowngradeEnrolment').attr('disabled','true');
                /*$('.confirmModal').removeClass('slds-hide');
                $('#confirmBody').html('Do you want to send an email?');
                $('#confirmHeader').html('Email Confirmation');*/
                $('#confirmModalYes').attr({'data-origin':'downgrade', 'data-id':bookingId, 'data-date': requestDate, 'data-newPackage': newPackageId, 'data-oldPackage': oldPackageId, 'data-timeslot': timeslot});
                //$('#confirmModalNo').attr({'data-origin':'downgrade', 'data-id':bookingId, 'data-date': requestDate, 'data-newPackage': newPackageId, 'data-oldPackage': oldPackageId, 'data-timeslot': timeslot});
                $('#downgradePopup').addClass('slds-hide');
                $('#upgradeDowngradeSummaryModal').addClass('slds-hide');
                $('#confirmModalYes').trigger('click');
                
            }
            
        }
        
        function cancelSubscription(){
            //$('#cancelByRequestDate').prop('checked', false);
            //$('#cancelByLessonEndDate').prop('checked', false);
            //$('#lastLessonDate').attr('disabled',true);
            $('#lastLessonDate').html('');
            //$('#cancelRequestEndDate').attr('disabled',true);
            $('#cancelRequestEndDate').val('');
            $('#advanceOptionPopup').addClass('slds-hide');
            $('#noticePeriodStart').html('');
            $('#noticePeriodEnd').html('');
            $('#canelSubscriptionPopup').removeClass('slds-hide');
            $('#submitCancelRequest').attr('disabled', 'true');
            
        }
        /*function withdrawSummary(){
            var isError = false;
            var bookingId = $('#cancelSubscriptionBtn').attr('data-id');
            var startDate = $('#submitCancelRequest').attr('startDate');
            var endDate = $('#submitCancelRequest').attr('endDate');
            var requestDate = $('#cancelRequestEndDate').val();
            var effectiveDate = $('#submitCancelRequest').attr('effectivedate');
            if(!bookingId || !requestDate || !effectiveDate || !startDate || !endDate){
                isError = true;
            }
            if(!isError){
                Visualforce.remoting.Manager.invokeAction(
                '{$RemoteAction.AureusCalendarClone.getCancellationDetails}',
                 bookingId, endDate, 
                    function(result, event){
                        if(result){
                            $('#summaryRequestDate').html(convertDateToMoment(new Date(requestDate)));
                            $('#summaryLastLessonDate').html(convertDateToMoment(new Date(endDate)));
                            $('#summaryNoticeStartDate').html(convertDateToMoment(new Date(startDate)));
                            $('#summaryNoticeEndDate').html(convertDateToMoment(new Date(endDate)));
                            $('#summaryNoOfLessonFromDeposit').html(result);
                            $('#summaryPopForAdvanceAction').removeClass('slds-hide');
                            $('#canelSubscriptionPopup').addClass('slds-hide');
                        }
                    });
            }
        }*/
       
        
        function submitCancelPackageRequest(){
            var isError = false;
            var bookingId = $('#confirmWithdrawal').attr('data-id');
            var endDate = $('#cancelRequestEndDate').val();
            var lastLessonDate = $('#confirmWithdrawal').attr('lastLessonDate');
            
            if(!bookingId){
                isError = true;
            }
            
            if(!endDate){
                isError = true;
            }
             if(!isError){    
                 var endDateMoment = moment();
                 endDateMoment.year(endDate.split('/')[2]).month(endDate.split('/')[0] - 1).date(endDate.split('/')[1]);
                 $('.canelSubscriptionPopup').addClass('slds-hide');
                 $('#withdrawEnrolSummaryModal').addClass('slds-hide');
                 //$('.confirmModal').removeClass('slds-hide');
                 
                 //$('#confirmBody').html('Do you want to send an email?');
                 //$('#confirmHeader').html('Email Confirmation');
                 $('#confirmModalYes').attr({'data-origin': 'withdrawal', 'data-id': bookingId, 'data-endDate':endDateMoment.format('YYYY-MM-DD'), 'data-lastLessonDate': lastLessonDate});
                 //$('#confirmModalNo').attr({'data-origin': 'withdrawal', 'data-id': bookingId, 'data-endDate':endDateMoment.format('YYYY-MM-DD'), 'data-lastLessonDate': lastLessonDate});
                 $('#confirmModalYes').trigger('click');
                 /*var endDateMoment = moment();
                 endDateMoment.year(endDate.split('/')[2]).month(endDate.split('/')[0] - 1).date(endDate.split('/')[1]);
                 console.log(bookingId, endDateMoment.format('YYYY-MM-DD'), lastLessonDate );
                  Visualforce.remoting.Manager.invokeAction(
                '{$RemoteAction.AureusCalendarClone.cancelSubscriptionRequest}',
                 bookingId, endDateMoment.format('YYYY-MM-DD'), lastLessonDate,  
                    function(result, event){
                        $('#canelSubscriptionPopup').addClass('slds-hide');
                        
                        $('#withdrawEnrolSummaryModal').addClass('slds-hide');
                        if(result){
                             $('#toastMsg').html('Request logged successfully');
                             $('.toastclass').addClass('slds-theme_success');
                             $('.toastclass').removeClass('slds-theme_error');
                             toastLaunch();
                        }else if(!result){
                             $('#toastMsg').html('Request failure!');
                             $('.toastclass').removeClass('slds-theme_success');
                             $('.toastclass').addClass('slds-theme_error');
                             toastLaunch();
                        }
                        refreshCalendar();
                    }
                 );*/
             }
        }
        // get the string date in yyyy-mm-dd
        
        //Get the date in yyyy-mm-dd format 
        // and return in ddd, MMM DD YYYY
        function convertDateToMoment(date){
            var dd = moment(date);
            return dd.format('ddd, MMM DD YYYY');
        }
        
        //Get the time in  hh:mm AM/PM
        function convertTimeToMoment(hour, minute){
            var tt = moment();
            tt.minute(minute).hours(hour);
            return tt.format('hh:mm A');
        }
        
        //Refresh the calendar with existing dates
        function refreshCalendar(){
            var b = $('#calendar').fullCalendar('getDate');
            var bookDate = [b.format('YYYY-MM-DD')];
            teacher = $(".teachers").val();
            
            var calView = $('#calendar').fullCalendar('getView').name;
            var calendarDates = isWeekDay();
            if(calView == 'agendaTwoDay'){
                initResources(center, teacher, filter.resource, calendarDates, calView, filter.instrument);
            }else{
                initResources(center, teacher, filter.resource, bookDate, calView, filter.instrument);
            } 
        }
        // show/Hide menu
        function showHideMenu(){
              var x = parent.document.getElementsByClassName('oneHeader')[0];
              if (x.style.display === "none") {
                x.style.display = "block";
              } else {
                x.style.display = "none";
              }
        }
        //Show case details on blue bar
        function getCaseDetails(caseid){
            if(caseid){
                Visualforce.remoting.Manager.invokeAction(
                '{!$RemoteAction.AureusCalendarClone.getCaseDetails}',
                 caseid,
                    function(result, event){
                        if(result){
                            if('Id' in result && 'CaseNumber' in result){
                                $('#caseNo').attr('href', '/'+result.Id);
                                $('#caseNo').text(result.CaseNumber);
                            }
                            if('Type' in result){
                                $('#caseType').text(result.Type);
                            }   
                            if('Contact' in result){
                                if('Name' in result.Contact && 'Id' in result.Contact){
                                    $('#caseParentName').attr('href', '/'+result.Contact.Id);
                                    $('#caseParentName').text(result.Contact.Name);
                                }
                            } 
                            $('#caseContainerMessage').removeClass('slds-hide');
                        }
                    }
                 );
            }
        }
        
        function getUserDetails(){
            var cancelRequestDate = new Date();
            cancelRequestDate.setDate(cancelRequestDate.getDate() + 30 );
            Visualforce.remoting.Manager.invokeAction(
                '{!$RemoteAction.AureusCalendarClone.getCenterUsers}',
                    function(result, event){
                        if(result){
                            userDetail  = result;
                            if('Designation__c' in result){
                                if(result.Designation__c== 'Centre Admin'){
                                    
                                    $('#cancelRequestEndDate').datepicker({
                                        initDate: moment(), //Today Date
                                        format: 'YYYY-MM-DD', //Date Format Of Datepicker Input Field
                                        minDate: cancelRequestDate,
                                        onChange: function(datepicker) {
                                        $('#cancelRequestEndDate').html('Selected Date: <strong>'+moment(datepicker.selectedFullDate._d).format('YYYY-MM-DD')+'</strong>');
                                       }
                                    });
                                }else if(result.Designation__c== 'Regional Manager'){
                                    cancelRequestDate = new Date();
                                    cancelRequestDate.setDate(cancelRequestDate.getDate() + 1 );
                                     $('#cancelRequestEndDate').datepicker({
                                        initDate: moment(), //Today Date
                                        format: 'YYYY-MM-DD', //Date Format Of Datepicker Input Field
                                        minDate: cancelRequestDate,
                                        onChange: function(datepicker) {
                                        $('#cancelRequestEndDate').html('Selected Date: <strong>'+moment(datepicker.selectedFullDate._d).format('YYYY-MM-DD')+'</strong>');
                                       }
                                    });
                                }else{
                                   $('#cancelRequestEndDate').datepicker({
                                        initDate: moment(), //Today Date
                                        format: 'YYYY-MM-DD', //Date Format Of Datepicker Input Field
                                        minDate: cancelRequestDate,
                                        onChange: function(datepicker) {
                                        $('#cancelRequestEndDate').html('Selected Date: <strong>'+moment(datepicker.selectedFullDate._d).format('YYYY-MM-DD')+'</strong>');
                                       }
                                    });
                                }
                            }else{
                                $('#cancelRequestEndDate').datepicker({
                                    initDate: moment(), //Today Date
                                    format: 'YYYY-MM-DD', //Date Format Of Datepicker Input Field
                                    minDate: cancelRequestDate,
                                    onChange: function(datepicker) {
                                    $('#cancelRequestEndDate').html('Selected Date: <strong>'+moment(datepicker.selectedFullDate._d).format('YYYY-MM-DD')+'</strong>');
                                   }
                                });
                            }
                        }else{
                            $('#cancelRequestEndDate').datepicker({
                                initDate: moment(), //Today Date
                                format: 'YYYY-MM-DD', //Date Format Of Datepicker Input Field
                                minDate: cancelRequestDate,
                                onChange: function(datepicker) {
                                $('#cancelRequestEndDate').html('Selected Date: <strong>'+moment(datepicker.selectedFullDate._d).format('YYYY-MM-DD')+'</strong>');
                               }
                            });
                        }
                    }
                 );
        }
        
        //Close Case container
        function closeCaseContainer(){
            $('#caseContainerMessage').addClass('slds-hide');
            caseId = '';
        }
        function redirectToCaseRecord(caseIdToRedirect){
            window.open("/"+caseIdToRedirect, '_blank');
            //window.location.href = "/"+caseIdToRedirect;
        }
        
        function showMessageForCancellation(){
            $('#errorMsgReason').html('');
            $('#errorMsgRemark').html('');
            let reason = $('#cancelReason').val();
            if(reason == 'Student MC'){
                $('#errorMsgReason').html('To avail makeup credits student needs to submit MC with in 7 days.');
            }
        }
        
        function enrollNowProcessFunc(){        
                    
            $("#datepicker").datepicker({       
                initDate: moment(), //Today Date        
                minDate: 0,     
                onSelect: function(dateText, inst) {        
                    fillTimeSlotSection(dateText);      
                }       
                        
            });     
                    
            $('#enrollNowCenterSelect').empty();        
            $('#enrollNowLessonSelect').empty();        
            $('#enrollNowTeacherSelect').empty();       
                    
            var bookId = $('#enrollNowProcess').attr('data-id');        
            $('.editDetails').addClass('slds-hide');        
            if(bookId){     
                Visualforce.remoting.Manager.invokeAction(      
                '{!$RemoteAction.AureusCalendarClone.getEnrolmentProcessData}',        
                    bookId,         
                    function(result, event){        
                        var centerList = '<option>None</option>';       
                        if('centersList' in result){        
                            $(result.centersList).each(function(index, value){      
                                centerList += '<option value="'+value.Id+'">'+value.Name+'</option>';       
                            });     
                            $('#enrollNowCenterSelect').append(centerList);     
                        }       
                            
                            
                                
                        if('currentCenter' in result){      
                            $('#enrollNowCenterSelect').val(result.currentCenter.Id);       
                            getAllTeachersAccordingToCenter(bookId, result.currentCenter.Id)        
                        }       
                                
                        $('#enrolProcessModal').removeClass('slds-hide');       
                                
                    }       
                 );     
            }       
        }           
                
        function getAllTeachersAccordingToCenter(bookId, centerId){     
            $('#enrollNowTeacherSelect').empty();       
            $('#enrollNowLessonSelect').empty();        
            if(centerId){       
                var teacherList = '<option>None</option>';      
                 Visualforce.remoting.Manager.invokeAction(     
                '{!$RemoteAction.AureusCalendarClone.getAllTeachersAccordingToCenter}',        
                    bookId, centerId,       
                    function(result, event){        
                        if('teachersList' in result){       
                            $(result.teachersList).each(function(index, value){     
                                teacherList += '<option value="'+value.Id+'">'+value.Name+'</option>';      
                            });     
                            $('#enrollNowTeacherSelect').append(teacherList);       
                                    
                        }       
                         if('hoursList' in result){     
                            availableSlotsWorking = result.hoursList;       
                         }      
                        if(bookId && 'currentTeacher' in result && centerId){       
                            $('#enrollNowTeacherSelect').val(result.currentTeacher.Id);     
                            if($('#enrollNowTeacherSelect').val()){     
                                getAllPlansAccordingToTeachers(bookId, centerId, $('#enrollNowTeacherSelect').val());       
                            }           
                                    
                        }       
                            
                    }       
                 );     
            }       
        }
        
        function getAllPlansAccordingToTeachers(bookId, centerId, teacherId){       
            timeSlotsOfTeacher = new Set();     
            $('#enrollNowLessonSelect').empty();        
            if(centerId && teacherId){      
                var plansList = '<option>None</option>';        
                 Visualforce.remoting.Manager.invokeAction(     
                '{!$RemoteAction.AureusCalendarClone.getPlans}',       
                    bookId, centerId, teacherId,        
                    function(result, event){        
                        if('planList' in result){       
                            $(result.planList).each(function(index, value){     
                                plansList += '<option value="'+value.Id+'">'+value.Name+'</option>';        
                            });     
                            $('#enrollNowLessonSelect').append(plansList);      
                                    
                        }       
                        if(bookId && 'currentPlan' in result){      
                            $('#enrollNowLessonSelect').val(result.currentPlan.Id);     
                        }       
                    }       
                 );     
                 if(availableSlotsWorking && teacherId && centerId){        
                     $(availableSlotsWorking).each(function(index, value){      
                         if(value.Teacher_Name__c == teacherId && value.Center_Name__c == centerId && value.Start_Time__c && value.End_Time__c){        
                             var start = value.Start_Time__c;       
                             start = moment.duration(start);        
                                    
                             var end = value.End_Time__c;       
                             end = moment.duration(end);        
                             for (let item of getTimeSlots(value, value.Start_Time__c, value.End_Time__c)) {        
                                 timeSlotsOfTeacher.add(item);          
                             }      
                         }                      
                     });        
                 }      
            }       
        }
        
        function getTimeSlots(Obj, start, end){     
            var startTime = moment.utc(start, 'x');     
            var endTime = moment.utc(end, 'x');     
            if( endTime.isBefore(startTime) ){      
               endTime.add(1, 'day');       
            }       
            var timeStops = new Set();      
            while(startTime <= endTime){        
               var timeslot = Obj.Working_Day__c;       
               if(new moment(startTime).hours() >= 12){     
                   timeslot += '-A-';       
               }else{       
                   timeslot += '-M-';       
               }        
               timeslot += new moment(startTime).format('HH:mm');       
               timeStops.add(timeslot);     
               startTime.add(15, 'minutes');        
            }       
            return timeStops;       
        }       
        function fillTimeSlotSection(dateTxt){      
            $('.morning').empty();      
            $('.afternoon').empty();        
            var dateObj = moment(dateTxt, "MM-DD-YYYY");        
            var morningSlots = '';      
            var afternoonSlots = '';        
            for (let item of timeSlotsOfTeacher) {      
                 if(item && item.split('-')[0] == dateObj.format('ddd')){       
                     if(item.split('-')[1] == 'M'){     
                         morningSlots += '<span class="slds-button slds-radio_button"><input id="'+item.split('-')[2]+'" name="radio" type="radio" value="'+item.split('-')[2]+'"> <label class="slds-radio_button__label" for="'+item.split('-')[2]+'"><span class="slds-radio_faux">'+item.split('-')[2]+'</span></label></span>';        
                     }else if(item.split('-')[1] == 'A'){       
                         afternoonSlots += '<span class="slds-button slds-radio_button"><input id="'+item.split('-')[2]+'" name="radio" type="radio" value="'+item.split('-')[2]+'"> <label class="slds-radio_button__label" for="'+item.split('-')[2]+'"><span class="slds-radio_faux">'+item.split('-')[2]+'</span></label></span>';      
                     }      
                 }              
            }       
            if(morningSlots){       
                $('.morning').append(morningSlots);     
            }       
                    
            if(afternoonSlots){     
                $('.afternoon').append(afternoonSlots);     
            }       
                    
        }       
        function sendEnrolToIpad(){     
            refreshEnrolProcessModal();     
            let errFlag = false;        
            var enrolData = new Object();       
            enrolData.centreId = $('#enrollNowCenterSelect').val();     
            enrolData.centreName = $('#enrollNowCenterSelect option:selected').text();      
            enrolData.teacherId = $('#enrollNowTeacherSelect').val();       
            enrolData.teacherName = $('#enrollNowTeacherSelect option:selected').text();        
            enrolData.planId = $('#enrollNowLessonSelect').val();       
            enrolData.planName = $('#enrollNowLessonSelect option:selected').text();        
            enrolData.enrolment = $('#enrollNowProcess').attr('enrolment-Id');      
            var dateStr = $( "#datepicker" ).datepicker( "getDate" ).toString();        
            if(dateStr){        
                var dateObj = moment(new Date(dateStr.substr(0, 16)));      
                enrolData.enrolDate = dateObj.format('ddd, MMM DD YYYY');       
            }       
            if($('.date-list').find("input[type='radio']:checked").val()){      
                enrolData.enrolSlot = $('.date-list').find("input[type='radio']:checked").val();        
            }       
                
            if(!enrolData.centreId || enrolData.centreId == 'None'){        
                errFlag = true;     
                $('#centerEnrolError').removeClass('slds-hide');        
            }       
                    
            if(!enrolData.teacherId || enrolData.teacherId == 'None'){      
                errFlag = true;     
                $('#teacherEnrolError').removeClass('slds-hide');       
            }       
                    
            if(!enrolData.planId || enrolData.planId == 'None'){        
                errFlag = true;     
                $('#planEnrolError').removeClass('slds-hide');      
            }       
                    
            if(!enrolData.enrolSlot){       
                errFlag = true;     
                $('#slotEnrolError').removeClass('slds-hide');      
            }       
            var jsonStr = JSON.stringify(enrolData);        
            if(jsonStr && errFlag == false){        
                Visualforce.remoting.Manager.invokeAction(      
                '{!$RemoteAction.AureusCalendarClone.sendEnrolToIpad}',        
                    jsonStr,        
                    function(result, event){        
                        $('#enrolProcessLoader').removeClass('slds-hide');          
                        $('#enrolProcessModal').addClass('slds-hide');      
                    }       
                 );         
            }       
        }       
                
        function refreshEnrolProcessModal(){        
            $('#centerEnrolError').addClass('slds-hide');       
            $('#teacherEnrolError').addClass('slds-hide');      
            $('#planEnrolError').addClass('slds-hide');     
            $('#slotEnrolError').addClass('slds-hide');     
        }
        
        
        function getWithdrawSummary(){
            $('#submitCancelRequest').attr('disabled', 'true');
            $('#submitCancelRequest').css('pointer-events', 'none');
            $('#makeupSectionSummary').removeClass('slds-hide');
            $('#finalLessonsTblBody').empty();
            $('#makeupLessonsTblBody').empty();
            $('#depositBalanceTblBody').empty();
            $('#withdrawSummaryStudentName').html('');
            $('#withdrawSummaryPackage').html('');            
            $('#withdrawSummaryCentre').html('');  
            $('#withdrawSummaryLessonDay').html('');  
            $('#withdrawSummaryNoticeDate').html('');  
            $('#withdrawSummaryFinalDate').html('');
            var bookId = $('#cancelSubscriptionBtn').attr('data-id');
            var lastLessonDate = $('#submitCancelRequest').attr('lastlessondate');
            var endDate = $('#cancelRequestEndDate').val();
            var dtObj = moment();
            if(endDate){
                dtObj.year(endDate.split('/')[2]).month(endDate.split('/')[0] - 1).date(endDate.split('/')[1]);
            }
            
            if(endDate && bookId && lastLessonDate){
                Visualforce.remoting.Manager.invokeAction(
                '{!$RemoteAction.AureusCalendarClone.getWithrawalSummary}',
                 bookId, dtObj.format('YYYY-MM-DD'), lastLessonDate, 
                    function(result, event){
                        if(result){
                            $('#canelSubscriptionPopup').addClass('slds-hide');
                            $('#withdrawEnrolSummaryModal').removeClass('slds-hide');
                            $('#submitCancelRequest').removeAttr('disabled');
                            $('#submitCancelRequest').css('pointer-events', '');
                            var tableRow = '';
                            if('lastLessons' in result){
                                $(result.lastLessons).each(function(index, value){
                                    tableRow += '<tr id="'+value.bookingId+'"><td>'+value.Lesson+'</td><td>'+value.bookingDate+'</td><td>'+value.bookingTime+'</td><td>'+value.duration+' mins</td>';
                                    if(value.status != 'Billed' && value.status != 'Deposit' && value.status){
                                        tableRow += '<td><a href="/'+value.status.split(':')[0]+'" target="_blank">'+value.status.split(':')[1]+'</a></td></tr>';
                                    }else{
                                        tableRow += '<td>'+value.status+'</td></tr>';
                                    }
                                });
                                $('#finalLessonsTblBody').append(tableRow);
                            }
                            if('makeupLessons' in result){
                                tableRow = '';
                                $(result.makeupLessons).each(function(index, value){
                                    tableRow += '<tr id="'+value.bookingId+'"><td>'+value.student+'</td><td>'+value.cancelDate+'</td><td>'+value.duration+'</td><td>'+value.expiryDate+'</td><td>'+value.nextExpiryDate+'</td></tr>';
                                });
                                $('#makeupLessonsTblBody').append(tableRow);
                                if(result.makeupLessons.length < 1){
                                    $('#makeupSectionSummary').addClass('slds-hide');
                                }
                            }
                            if('finalDeposits' in result){
                                tableRow = '';
                                $(result.finalDeposits).each(function(index, value){
                                    tableRow += '<tr id="'+value.bookingId+'"><td>'+value.Lesson+'</td><td>'+value.student+'</td><td>'+value.qty+'</td><td>$'+value.unitPrice.toFixed(2)+'</td><td>$'+value.total.toFixed(2) +'</td></tr>';
                                });
                                if('gst' in result){
                                    tableRow += '<tr><td style="border: 0px;"></td><td style="border: 0px;"></td><td style="border: 0px;"></td><td><b>GST</b></td><td>$'+result.gst.toFixed(2) +'</td></tr>';
                                }
                                if('total' in result){
                                    tableRow += '<tr><td style="border: 0px;"></td><td style="border: 0px;"></td><td style="border: 0px;"></td><td><b>Total</b></td><td>$'+result.total.toFixed(2) +'</td></tr>';
                                }
                                if('deposit' in result){
                                    tableRow += '<tr><td style="border: 0px;"></td><td style="border: 0px;"></td><td style="border: 0px;"></td><td><b>Deposit</b></td><td>$'+result.deposit.toFixed(2) +'</td></tr>';
                                }
                                if('refund' in result && result.refund && result.refund > 0){
                                
                                    tableRow += '<tr><td style="border: 0px;"></td><td style="border: 0px;"></td><td style="border: 0px;"></td><td><b>Refund</b></td><td>$'+Math.abs(result.refund).toFixed(2) +'</td></tr>';
                                }
                                $('#depositBalanceTblBody').append(tableRow);
                            }
                            if('student' in result){
                                $('#withdrawSummaryStudentName').html(result.student);
                            }
                            if('packageName' in result){
                                $('#withdrawSummaryPackage').html(result.packageName);
                            }    
                            if('centre' in result){
                                $('#withdrawSummaryCentre').html(result.centre);
                            }
                            if('LessonDay' in result){
                                $('#withdrawSummaryLessonDay').html(result.LessonDay);
                            }
                            
                            if('noticeDate' in result){
                                $('#withdrawSummaryNoticeDate').html(result.noticeDate);
                            }
                            
                            if('lastDate' in result){
                                $('#withdrawSummaryFinalDate').html(result.lastDate);
                            }
                        }
                    }
                );
            }
        }
        
        function availTimeSlots(grade){
            var effectiveDate, selectedPackage, bookingId, centerId, teacherId, enrolmentId, enrolweek, weekDayError;
            var dtObj = moment();
            weekDayError = false;
            if(grade == 'upgrade'){
                $('#availableTimeSlots').attr('disabled', 'true');
                $('#availableTimeSlots').empty();
                $('#availableTimeSlots').append('<option>Select Time Slot</option>');
                
                enrolweek = $('#submitUpgradeRequest').attr('data-enrolday');
                bookingId = $('#submitUpgradeRequest').attr('data-id');
                enrolmentId = $('#submitUpgradeRequest').attr('data-enrolment');
                effectiveDate = $('#effectiveDateInput').val();
                selectedPackage = $('#selectRequestedPackage').val();
                centerId = $('#submitUpgradeRequest').attr('data-centerid');
                teacherId = $('#submitUpgradeRequest').attr('data-teacherid');
                
                if(effectiveDate){
                    dtObj.year(effectiveDate.split('/')[2]).month(effectiveDate.split('/')[0] - 1).date(effectiveDate.split('/')[1]);
                }
                
                if(!effectiveDate || selectedPackage == 'Select an Option'){
                    $('#availableTimeSlots').attr('disabled', 'true');
                } 
                
                if(dtObj.format('dddd') != enrolweek){
                    weekDayError = true;
                    //$('#effectiveDateError').html('Please select a valid lesson date i.e. any subsequent '+enrolweek);
                }else{
                    $('#effectiveDateError').html('');
                }  
            }else if(grade == 'downgrade'){
                $('#availableTimeSlotsDowngrade').attr('disabled', 'true');
                $('#availableTimeSlotsDowngrade').empty();
                $('#availableTimeSlotsDowngrade').append('<option>Select Time Slot</option>');
                
                enrolweek = $('#submitDowngradeRequest').attr('data-enrolday');
                bookingId = $('#submitDowngradeRequest').attr('data-id');
                enrolmentId = $('#submitDowngradeRequest').attr('data-enrolment');
                effectiveDate = $('#effectiveDateInputDowngrade').val();
                selectedPackage = $('#selectRequestedPackageDowngrade').val();
                centerId = $('#submitDowngradeRequest').attr('data-centerid');
                teacherId = $('#submitDowngradeRequest').attr('data-teacherid');
                
                if(effectiveDate){
                    dtObj.year(effectiveDate.split('/')[2]).month(effectiveDate.split('/')[0] - 1).date(effectiveDate.split('/')[1]);
                }
                
                if(!effectiveDate || selectedPackage == 'Downgrade Subscription'){
                    $('#availableTimeSlotsDowngrade').attr('disabled', 'true');
                }
                
                if(dtObj.format('dddd') != enrolweek){
                    weekDayError = true;
                    //$('#effectiveDateErrorDowngrade').html('Please select a valid lesson date i.e. any subsequent '+enrolweek);
                }else{
                    $('#effectiveDateErrorDowngrade').html('');
                }
            }else if(grade == 'update'){
                $('#availableTimeSlotsUpdateEnrolment').attr('disabled', 'true');
                $('#availableTimeSlotsUpdateEnrolment').empty();
                $('#availableTimeSlotsUpdateEnrolment').append('<option>Select Time Slot</option>');
                enrolmentId = $('#updateEnrolmentBtn').attr('data-enrol');
                effectiveDate = $('#selectEffectiveDateEnrolUpdate').val();
                selectedPackage = $('#selectPackageEnrolUpdate').val();
                centerId = $('#selectTeacherEnrolUpdate').attr('data-center');
                teacherId = $('#selectTeacherEnrolUpdate').val();
                if(effectiveDate != 'Select Effective Date'){
                    dtObj.year(effectiveDate.split('/')[2]).month(effectiveDate.split('/')[0] - 1).date(effectiveDate.split('/')[1]);
                }
                if(effectiveDate == 'Select Effective Date' || (selectedPackage == 'Select Package' || !selectedPackage)  || teacherId == 'Select Teacher'){
                    $('#availableTimeSlotsDowngrade').attr('disabled', 'true');
                }
            }
            console.log('@@@@effectiveDate '+effectiveDate);
            console.log('@@@@selectedPackage '+selectedPackage);
            console.log('@@@@centerId '+centerId);
            console.log('@@@@teacherId '+teacherId);
            console.log('@@@@enrolmentId '+enrolmentId);
            if((effectiveDate && effectiveDate != 'Select Effective Date') && ((selectedPackage != 'Select an Option' && selectedPackage) && selectedPackage != 'Downgrade Subscription' && selectedPackage != 'Select Package') && centerId && (teacherId && teacherId != 'Select Teacher') && enrolmentId){
                if(dtObj){
                    if(!weekDayError){
                        Visualforce.remoting.Manager.invokeAction(
                        '{!$RemoteAction.AureusCalendarClone.getTimeSlotsAccordingly}',
                         centerId, teacherId, selectedPackage, enrolmentId, dtObj.format('YYYY-MM-DD'), 
                            function(result, event){
                                var availSlots = '';
                                $(result).each(function(index, value){
                                     availSlots += '<option value="'+value+'">'+value+'</option>';   
                                });
                                if(grade == 'upgrade'){
                                    $('#availableTimeSlots').append(availSlots);
                                    $('#availableTimeSlots').removeAttr('disabled');
                                }else if(grade == 'downgrade'){
                                    $('#availableTimeSlotsDowngrade').append(availSlots);
                                    $('#availableTimeSlotsDowngrade').removeAttr('disabled');
                                }else if(grade == 'update'){
                                    $('#availableTimeSlotsUpdateEnrolment').append(availSlots);
                                    $('#availableTimeSlotsUpdateEnrolment').removeAttr('disabled');
                                }
                                
                            }
                        );
                    }else{
                        $('#availableTimeSlotsUpdateEnrolment').attr('disabled', 'true');
                        $('#availableTimeSlotsDowngrade').attr('disabled', 'true');
                        $('#availableTimeSlots').attr('disabled', 'true');
                    }
                }
            }
        }
        
        function showUpgradeDowngradeSummary(grade){
            
            if(grade == 'upgrade'){
                var bookingId = $('#submitUpgradeRequest').attr('data-id');
                var oldPackageId = $('#submitUpgradeRequest').attr('data-packageid');
                var newPackageId = $('#selectRequestedPackage').val();
                var effectiveDate = $('#effectiveDateInput').val();
                var availableTimeSlots = $('#availableTimeSlots').val();
                var enrolmentId = $('#submitUpgradeRequest').attr('data-enrolment');
            }else if(grade == 'downgrade'){
                var bookingId = $('#submitDowngradeRequest').attr('data-id');
                var oldPackageId = $('#submitDowngradeRequest').attr('data-packageid');
                var newPackageId = $('#selectRequestedPackageDowngrade').val();
                var effectiveDate = $('#effectiveDateInputDowngrade').val();
                var availableTimeSlots = $('#availableTimeSlotsDowngrade').val();
                var enrolmentId = $('#submitDowngradeRequest').attr('data-enrolment');
            }
            
            $('.invoiceTopupItem').addClass('slds-hide');
            $('#nextInvoiceItem').addClass('slds-hide');
            
            $('#upgradeDowngradeSummaryHeader').html('');
            $('#confirmUpgradeEnrolment').addClass('slds-hide');
            $('#confirmDowngradeEnrolment').addClass('slds-hide');
            var error = false;
            
            var today = moment();
            if(bookingId && oldPackageId && enrolmentId){
                if(grade == 'upgrade'){
                    if(newPackageId == "Select an Option"){
                        $('#upgradePackageSelectError').html('Please select the package...');
                        error = true;
                    }else{
                        $('#upgradePackageSelectError').html('');
                    }
                    
                    if(!effectiveDate){
                        $('#effectiveDateError').html('Select the effective date....');
                        error = true;
                    }else{
                        var effectiveDateMoment = moment();
                        effectiveDateMoment.year(effectiveDate.split('/')[2]).month(effectiveDate.split('/')[0] - 1).date(effectiveDate.split('/')[1]);
                        if(today.diff(effectiveDateMoment) > 0){
                            $('#effectiveDateError').html('Select Future effective date....');
                            error = true;
                        }else{
                            $('#effectiveDateError').html('');
                        }
                    }
                    
                    if(availableTimeSlots == 'Select Time Slot'){
                        $('#availableTimeSlotsError').html('Select the Time Slot....');
                        error = true;
                    }else{
                        $('#availableTimeSlotsError').html('');
                    }
                }else if(grade == 'downgrade'){
                    if(newPackageId == "Downgrade Subscription"){
                        $('#downgradePackageSelectError').html('Please select the package...');
                        error = true;
                    }else{
                        $('#downgradePackageSelectError').html('');
                    }
                    
                    if(!effectiveDate){
                        $('#effectiveDateErrorDowngrade').html('Select the effective date....');
                        error = true;
                    }else{
                        var effectiveDateMoment = moment();
                        effectiveDateMoment.year(effectiveDate.split('/')[2]).month(effectiveDate.split('/')[0] - 1).date(effectiveDate.split('/')[1]);
                        if(today.diff(effectiveDateMoment) > 0){
                            $('#effectiveDateErrorDowngrade').html('Select Future effective date....');
                            error = true;
                        }else{
                            $('#effectiveDateErrorDowngrade').html('');
                        }
                    }
                    
                    if(availableTimeSlots == 'Select Time Slot'){
                        $('#availableTimeSlotsDowngradeError').html('Select the Time Slot....');
                        error = true;
                    }else{
                        $('#availableTimeSlotsDowngradeError').html('');
                    }
                }
                
                
                
                if(!error){
                    
                    var dtObj = moment();
                     if(effectiveDate){
                        dtObj.year(effectiveDate.split('/')[2]).month(effectiveDate.split('/')[0] - 1).date(effectiveDate.split('/')[1]);
                     }
                    Visualforce.remoting.Manager.invokeAction(
                    '{!$RemoteAction.AureusCalendarClone.getUpgradeDowngradePackageSummary}',
                     oldPackageId, newPackageId, dtObj.format('YYYY-MM-DD'), availableTimeSlots, enrolmentId, grade,  
                        function(result, event){
                            console.log('Result', result);
                            if(grade == 'upgrade'){
                                $('#upgradeDowngradeSummaryHeader').html('Upgrade Summary');
                                $('#confirmUpgradeEnrolment').removeClass('slds-hide');
                                $('.invoiceTopupItem').removeClass('slds-hide');
                                if('invoiceTopup' in result){
                                    if(result.invoiceTopup >= 0){
                                            $('#invoiceTopUpSummary').html('$'+result.invoiceTopup.toFixed(2));
                                        
                                    }
                                    
                                }
                            }else if(grade == 'downgrade'){
                                $('#upgradeDowngradeSummaryHeader').html('Downgrade Summary');
                                $('#confirmDowngradeEnrolment').removeClass('slds-hide');
                                $('#nextInvoiceItem').removeClass('slds-hide');
                                 $('.invoiceTopupItem').removeClass('slds-hide');
                                $('#invoiceTopupItem').addClass('slds-hide');
                                 if('invoiceTopup' in result){
                                    $('#confirmModalYes').attr('data-amount', result.invoiceTopup.toFixed(2));
                                     //$('#nextInvoiceItemSummary').html('$'+result.invoiceTopup.toFixed(2));
                                     if(result.invoiceTopup >= 0){
                                        $('#nextInvoiceItemSummary').html('$'+result.invoiceTopup.toFixed(2));
                                    }else{
                                        $('#nextInvoiceItemSummary').html('-$'+Math.abs(result.invoiceTopup).toFixed(2));
                                    } 
                                }
                                if('positiveInvoiceAmount' in result){
                                    $('#confirmModalYes').attr('data-positiveInvoiceAmount', result.positiveInvoiceAmount.toFixed(2));
                                }
                                if('negativeInvoiceAmount' in result){
                                    $('#confirmModalYes').attr('data-negativeInvoiceAmount', result.negativeInvoiceAmount.toFixed(2));
                                }
                            }
                            
                            //$('#gradeSubscriptionPopup').addClass('slds-hide');
                            if('newPackageName' in result){
                                $('#newPackageNameSummary').html(result.newPackageName);
                                $('#confirmModalYes').attr('data-newPackageName', result.newPackageName);
                            }
                            if('oldPackageName' in result){
                                $('#oldPackageNameSummary').html(result.oldPackageName);
                                $('#confirmModalYes').attr('data-previousPackage', result.oldPackageName);
                            } 
                            if('currentPackageDeposit' in result){
                                if(result.currentPackageDeposit  || result.currentPackageDeposit == 0){
                                    $('#currentDepositFileSummary').html('$'+result.currentPackageDeposit.toFixed(2));
                                    $('#confirmModalYes').attr('data-currentDepositonFile', result.currentPackageDeposit);
                                }
                                
                            }
                            if('newPackageDeposit' in result){
                                if(result.newPackageDeposit){
                                    $('#newPackageDepositSummmary').html('$'+result.newPackageDeposit.toFixed(2));
                                    $('#confirmModalYes').attr('data-newPackageDeposit', result.newPackageDeposit);
                                }
                            }
                            if('currentDayAndTime' in result){
                                $('#previousLessonDTSummary').html(result.currentDayAndTime);
                                $('#confirmModalYes').attr('data-previousLessonDayTime', result.currentDayAndTime);
                            }
                            if('invoiceForCurrentMonth' in result){
                                if(result.invoiceForCurrentMonth){
                                    $('#invoiceForCurrentMonthSummary').html('$'+result.invoiceForCurrentMonth.toFixed(2));
                                    $('#confirmModalYes').attr('data-invoiceForCurrentMonth', result.invoiceForCurrentMonth);
                                }
                            }
                            if('newDayAndTime' in result){
                                $('#newLessonDTSummary').html(result.newDayAndTime);
                                $('#confirmModalYes').attr('data-newLessonDayTime', result.newDayAndTime);
                            }
                            
                            if('effectiveDate' in result){
                                $('#invoiceEffectiveDate').html(result.effectiveDate);
                            }
                            
                            if('invoiceDepositLessonTopup' in result){
                                if(result.invoiceDepositLessonTopup >= 0){
                                    $('#invoiceLessonDepositTopupSummary').html('$'+result.invoiceDepositLessonTopup.toFixed(2));
                                }else{
                                    $('#invoiceLessonDepositTopupSummary').html('-$'+Math.abs(result.invoiceDepositLessonTopup).toFixed(2));
                                }
                                
                                $('#confirmModalYes').attr('data-lessonCharge', result.invoiceDepositLessonTopup.toFixed(2));
                            }
                            
                            if('invoiceDepositTopup' in result){
                                if(result.invoiceDepositTopup >= 0){
                                    $('#invoiceDepositTopupSummary').html('$'+result.invoiceDepositTopup.toFixed(2));
                                }else{
                                    $('#invoiceDepositTopupSummary').html('-$'+Math.abs(result.invoiceDepositTopup).toFixed(2));
                                }
                                $('#confirmModalYes').attr('data-deposit', result.invoiceDepositTopup.toFixed(2));
                            }
                                $('#upgradeDowngradeSummaryModal').removeClass('slds-hide');
                        }
                    );
                }
            }
        }
        function updateEnrolment(){
            $('#teacherSelectErrorMsg').html('');
            $('#packageSelectErrorMsg').html('');
            $('#effectiveDateErrorMsg').html('');
            $('#timeSlotErrorMsg').html('');
            $('#currentTeacherEnrolUpdate').html('');
            $('#currentDateTimeEnrolUpdate').html('');
            $('#currentPackageEnrolUpdate').html('');
            $('#selectTeacherEnrolUpdate').empty();
            $('#selectPackageEnrolUpdate').empty();
            $('#selectPackageEnrolUpdate').attr('disabled', 'true');
            $('#advanceOptionPopup').addClass('slds-hide');
            //$('#selectEffectiveDateEnrolUpdate').val('');
            $('#selectEffectiveDateEnrolUpdate').empty();
            var enrolmentId = $('#updateEnrolmentBtn').attr('data-enrol');
             Visualforce.remoting.Manager.invokeAction(
                '{!$RemoteAction.AureusCalendarClone.getEnrolmentUpdateDetails}',
                 enrolmentId,  
                 function(result, event){
                    $('#currentTeacherEnrolUpdate').html(result.currentTeacher);
                    console.log('result '+result); 
                    $('#currentTeacherEnrolUpdate').attr('data-currentTeacherId',result.currentTeacherId);
                    $('#currentDateTimeEnrolUpdate').html(result.currentDayTimeSlot);
                    $('#currentPackageEnrolUpdate').html(result.currentPackage);
                    $('#currentPackageEnrolUpdate').attr('data-currentPackageId',result.currentPackageId);
                     $('#selectTeacherEnrolUpdate').attr({'data-duration': result.duration, 'data-center': result.center});
                    if('teachers' in result){
                        var teachersEnrol = '<option>Select Teacher</option>';
                        $(result.teachers).each(function(index, value){
                            teachersEnrol += '<option value="'+value.Id+'">'+value.Name+'</option>';
                        });
                        $('#selectTeacherEnrolUpdate').append(teachersEnrol);
                    }
                    $('#enrolmentUpdatePopup').removeClass('slds-hide');   
                    var weekDatesList = getWeekDayDates(result.currentWeekDay, 1);
                    if(weekDatesList.length > 0){
                        var effectiveDateStr = '<option>Select Effective Date</option>';
                        $(weekDatesList).each(function(index, value){
                            effectiveDateStr += '<option value="'+value.value+'">'+value.label+'</option>';
                        });
                        $('#selectEffectiveDateEnrolUpdate').append(effectiveDateStr);
                    }
                 }
             );
        }
        function getPackageByTeacher(){
            $('#selectPackageEnrolUpdate').empty();
            $('#selectPackageEnrolUpdate').attr('disabled', 'true');
            var teacherId = $('#selectTeacherEnrolUpdate').val();
            var duration = $('#selectTeacherEnrolUpdate').attr('data-duration');
            var centerId = $('#selectTeacherEnrolUpdate').attr('data-center');
            if(teacherId != 'Select Teacher' && centerId && duration){
                Visualforce.remoting.Manager.invokeAction(
                '{!$RemoteAction.AureusCalendarClone.getPackageAccordingToTeacher}',
                 centerId, teacherId, duration,   
                 function(result, event){
                       var packageEnrol = '<option value="Select Package">Select an Option</option>';
                        $(result).each(function(index, value){
                            packageEnrol += '<option value="'+value.Id+'">'+value.Name+'</option>';
                        });
                        $('#selectPackageEnrolUpdate').append(packageEnrol);
                        $('#selectPackageEnrolUpdate').removeAttr('disabled');
                 }
                 );
            }
        }
        
        
            function getWeekDayDates(weekDay, noOfMonths){
            var weekDayList = [];
            var weekDateObj = {};
            var momentDateAfterMonths = new moment();
            var momentDate = new moment();
            if(momentDate.format('ddd') != weekDay){
                while(momentDate.format('ddd') != weekDay){
                    momentDate.add(1, 'days');
                    momentDateAfterMonths.add(1, 'days');
                }
            }
            momentDateAfterMonths.add(noOfMonths, 'M');
            while(momentDate <= momentDateAfterMonths){
                    weekDateObj = {};
                    weekDateObj.value = momentDate.format('MM/DD/YYYY');
                    weekDateObj.label = momentDate.format('ddd, MMM DD YYYY');
                    weekDayList.push(weekDateObj);
                    momentDate.add(7, 'days');
                    
            }
            return weekDayList;
        }
        
        function updateEnrolmentClick(){
            $('#teacherSelectErrorMsg').html('');
            $('#packageSelectErrorMsg').html('');
            $('#effectiveDateErrorMsg').html('');
            $('#timeSlotErrorMsg').html('');
            var errorFlag = false;
            var enrolmentId, newPackage, newTeacher, newTime, newDate,oldTeacher,oldPackage, oldTime, newPackageName, oldPackageName;
            enrolmentId = $('#updateEnrolmentBtn').attr('data-enrol');
            newPackage = $('#selectPackageEnrolUpdate').val();
            
            newTeacher = $('#selectTeacherEnrolUpdate').val();
            newDate = $('#selectEffectiveDateEnrolUpdate').val();
            newTime = $('#availableTimeSlotsUpdateEnrolment').val();
            oldTeacher = $('#currentTeacherEnrolUpdate').data('currentteacherid');
            oldPackage = $('#currentPackageEnrolUpdate').data('currentpackageid');
            oldTime = $('#currentDateTimeEnrolUpdate').text();
            newPackageName = $('#selectPackageEnrolUpdate option:selected').text();
            oldPackageName = $('#currentPackageEnrolUpdate').text();
            if(!newPackage || newPackage == 'Select Package'){
                $('#packageSelectErrorMsg').html('Please Select the Package...');
                errorFlag = true;           
            }
            if(!newTeacher || newTeacher == 'Select Teacher'){
                $('#teacherSelectErrorMsg').html('Please Select the Teacher...');
                errorFlag = true;
            }
            if(!newDate || newDate == 'Select Effective Date'){
                $('#effectiveDateErrorMsg').html('Please Select Date...');
                errorFlag = true;
            }    
            if(!newTime || newTime == 'Select Time Slot'){
                $('#timeSlotErrorMsg').html('Please Select Time Slot...');
                errorFlag = true;
            }
            if(enrolmentId && (newPackage && newPackage != 'Select Package') && (newTeacher && newTeacher != 'Select Teacher') && (newDate && newDate != 'Select Effective Date') && (newTime && newTime != 'Select Time Slot') && !errorFlag){
                $('#updateEnrolmentonClick').removeAttr('disabled');
                    var dtObj = new moment();
                if(newDate){
                    dtObj.year(newDate.split('/')[2]).month(newDate.split('/')[0] - 1).date(newDate.split('/')[1]);
                }
                $('#enrolmentUpdatePopup').addClass('slds-hide');
                $('#confirmModalYes').attr({'data-origin': 'change', 'data-enrol': enrolmentId, 'data-teacher':newTeacher, 
                                            'data-package': newPackage, 'data-date': dtObj.format('YYYY-MM-DD'), 'data-time': newTime,
                                           'data-oldteacher': oldTeacher,'data-oldPackage':oldPackage, 'data-oldTime': oldTime, 'data-oldPackageName': oldPackageName, 'data-newPackageName': newPackageName});
                $('#confirmModalYes').trigger('click');
            }
        }
                                
        function cancelBusyBooking(flag){
            $('#confirmModalYes').removeClass('slds-hide');
            $('#busyBookingViewModal').addClass('slds-hide');
            $('#cancelBooking').trigger( "click" );
            $('#confirmModalYes').attr('data-future', flag);
            $('#confirmModalNo').attr('data-future', flag);
        }
        
        function showPrePaymentModal(){
            var enrolId = $('#prePaymentId').attr('data-enrol');
            $('#prePaymentEffectiveDate').html('');
            $('#prePaymentPackages').val('');
            $('#advanceOptionPopup').addClass('slds-hide');
            
            $('#prePaymentPackages').empty();
            if(enrolId ){
                Visualforce.remoting.Manager.invokeAction(
                '{!$RemoteAction.AureusCalendarClone.getPrePaymentPackage}',
                     enrolId,    
                     function(result, event){
                         var selectBody = '<option value="">Select Package</option>';
                         for(var index in result){
                             if(index != 'nextBillDate'){
                                 selectBody += '<option value="'+index+'">'+result[index]+'</option>';
                             }else if(index == 'nextBillDate'){
                                 $('#prePaymentEffectiveDate').html(result[index]);
                             }
                                                          
                         }
                         $('#prePaymentPackages').append(selectBody);
                         $('#prePaymentPopup').removeClass('slds-hide');
                     }
                 );
            }
            
        }
        function prePaymentFunc(){
            $('#prePaymentPopup').addClass('slds-hide');
            window.open("{!$Label.Aureus_Site}/apex/PrePaymentSummaryPage?enrolId="+$('#prePaymentId').attr('data-enrol')+"&packageId="+$('#prePaymentPackages').val(), '_blank');
        }
           
        </script>
        
    </html>
</apex:component>